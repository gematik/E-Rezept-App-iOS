<!DOCTYPE html>
<html lang="en">
  <head>
    <title>requirements  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset="utf-8">
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
    <script src="js/lunr.min.js" defer></script>
    <script src="js/typeahead.jquery.js" defer></script>
    <script src="js/jazzy.search.js" defer></script>
  </head>
  <body>


    <a title="requirements  Reference"></a>

    <header class="header">
      <p class="header-col header-col--primary">
        <a class="header-link" href="index.html">
           1.12.0 Docs
        </a>
         (100% documented)
      </p>
    
      <div class="header-col--secondary">
        <form role="search" action="search.json">
          <input type="text" placeholder="Search documentation" data-typeahead>
        </form>
      </div>
    
        <p class="header-col header-col--secondary">
          <a class="header-link" href="https://github.com/gematik/E-Rezept-App-iOS">
            <img class="header-icon" src="img/gh.png" alt="GitHub"/>
            View on GitHub
          </a>
        </p>
    
    </header>

    <p class="breadcrumbs">
      <a class="breadcrumb" href="index.html"> Reference</a>
      <img class="carat" src="img/carat.png" alt=""/>
      requirements  Reference
    </p>

    <div class="content-wrapper">
      <nav class="navigation">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Guides.html">Guides</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="modules.html">Modules</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="error_handling.html">error_handling</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="requirement-notes.html">requirement-notes</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="requirements.html">requirements</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Classes.html">Classes</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes.html#/s:6eRpApp33DefaultErxTaskMatrixCodeGeneratorC">DefaultErxTaskMatrixCodeGenerator</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Enums.html">Enumerations</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/Colors.html">Colors</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/ProfilePicture.html">ProfilePicture</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/SFSymbolName.html">SFSymbolName</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/UnicodeCharacter.html">UnicodeCharacter</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/Validity.html">Validity</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Extensions.html">Extensions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/APDU.html">APDU</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/APDU/Error.html">– Error</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/AVSError.html">AVSError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/AVSError/InternalError.html">– InternalError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/AVSMessage.html">AVSMessage</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/AVSMessage.html#/s:3AVS10AVSMessageV6eRpAppE9ValidatorV">– Validator</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions.html#/s:6eRpApp16AVSRedeemServiceV">AVSRedeemService</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions.html#/AVSTransactionCoreDataStore">AVSTransactionCoreDataStore</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions.html#/c:@M@eRpApp@objc(cs)AVScannerViewController">AVScannerViewController</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/AccessibilityAnnouncementReceiver.html">AccessibilityAnnouncementReceiver</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions.html#/s:6eRpApp0B7VersionV">AppVersion</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/ApplicationIdentifier.html">ApplicationIdentifier</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/ApplicationIdentifier/Error.html">– Error</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/Array.html">Array</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/BarcodeDetection.html">BarcodeDetection</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions.html#/BiometricsSHA256Signer">BiometricsSHA256Signer</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions.html#/c:@M@eRpApp@objc(cs)CANCameraScannerViewController">CANCameraScannerViewController</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/CardError.html">CardError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/CardVersion2.html">CardVersion2</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/CardVersion2/Error.html">– Error</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/CardWallExtAuthConfirmationDomain.html">CardWallExtAuthConfirmationDomain</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/CardWallExtAuthConfirmationDomain.html#/s:6eRpApp33CardWallExtAuthConfirmationDomainV5ErrorO">– Error</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/CardWallReadCardDomain.html">CardWallReadCardDomain</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/CardWallReadCardDomain/State.html">– State</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions.html#/ChargeItemDomainServiceAuthenticateResult">ChargeItemDomainServiceAuthenticateResult</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions.html#/ChargeItemDomainServiceDeleteResult">ChargeItemDomainServiceDeleteResult</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions.html#/ChargeItemDomainServiceFetchResult">ChargeItemDomainServiceFetchResult</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions.html#/ChargeItemListDomainServiceGrantResult">ChargeItemListDomainServiceGrantResult</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions.html#/ChargeItemListDomainServiceRevokeResult">ChargeItemListDomainServiceRevokeResult</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions.html#/CoreDataController">CoreDataController</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/CoreNFCError.html">CoreNFCError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions.html#/s:6eRpApp23DebugDeviceCapabilitiesC">DebugDeviceCapabilities</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions.html#/ErxConsent">ErxConsent</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/ErxTask.html">ErxTask</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/ErxTask.html#/Status">– Status</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/ErxTaskOrder.html">ErxTaskOrder</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/ErxTaskOrder.html#/s:6eRpKit12ErxTaskOrderV01eA3AppE9ValidatorV">– Validator</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions.html#/s:6eRpApp30ErxTaskRepositoryRedeemServiceV">ErxTaskRepositoryRedeemService</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/ExtAuthPendingDomain.html">ExtAuthPendingDomain</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/ExtAuthPendingDomain.html#/s:6eRpApp20ExtAuthPendingDomainV5ErrorO">– Error</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions.html#/FHIRClient">FHIRClient</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/FHIRDateFormatter.html">FHIRDateFormatter</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/FileControlParameter.html">FileControlParameter</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/FileControlParameter/Error.html">– Error</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/FileIdentifier.html">FileIdentifier</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/FileIdentifier/Error.html">– Error</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions.html#/FileManager">FileManager</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/Format2Pin.html">Format2Pin</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/Format2Pin/Error.html">– Error</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/GemCvCertificate.html">GemCvCertificate</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/GemCvCertificate/Error.html">– Error</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/HealthCard.html">HealthCard</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/HealthCard/Error.html">– Error</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/HealthCardCommandBuilder.html">HealthCardCommandBuilder</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/HealthCardCommandBuilder/InvalidArgument.html">– InvalidArgument</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/IDPError.html">IDPError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions.html#/JWE">JWE</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions.html#/JWT">JWT</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/KKAppDirectory.html">KKAppDirectory</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/KKAppDirectory/Entry.html">– Entry</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/Key.html">Key</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/Key/Error.html">– Error</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/KeyAgreement.html">KeyAgreement</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/KeyAgreement/Error.html">– Error</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions.html#/KeyVerifier">KeyVerifier</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/LocationManager.html">LocationManager</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/MainDomain.html">MainDomain</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/MainDomain.html#/s:6eRpApp10MainDomainV5ErrorO">– Error</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/NFCCardError.html">NFCCardError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/NFCHealthCardPasswordControllerError.html">NFCHealthCardPasswordControllerError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions.html#/s:6eRpApp25NFCSignatureProviderErrorO">NFCSignatureProviderError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/NFCTagReaderSession.html">NFCTagReaderSession</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/NFCTagReaderSession/Error.html">– Error</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions.html#/s:6eRpApp19OrderCommunicationsV">OrderCommunications</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/Password.html">Password</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/Password/Error.html">– Error</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions.html#/PharmacyCoreDataStore">PharmacyCoreDataStore</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/PharmacyFHIRDataSource.html">PharmacyFHIRDataSource</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/PharmacyFHIRDataSource/Error.html">– Error</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/PharmacyFilterBar.html">PharmacyFilterBar</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/PharmacyFilterBar.html#/s:6eRpApp17PharmacyFilterBarV0D0V">– Filter</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/PharmacyRepositoryError.html">PharmacyRepositoryError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions.html#/s:6eRpApp12PrescriptionV">Prescription</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions.html#/PrescriptionDetailDomain">PrescriptionDetailDomain</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions.html#/PrivateKeyContainer">PrivateKeyContainer</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/ProfileCoreDataStore.html">ProfileCoreDataStore</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions.html#/RedeemMatrixCodeDomain">RedeemMatrixCodeDomain</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions.html#/s:6eRpApp18RedeemServiceErrorO">RedeemServiceError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions.html#/RegisteredDevicesDomain">RegisteredDevicesDomain</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/ScanCAN.html">ScanCAN</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions.html#/ScannedErxTask">ScannedErxTask</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions.html#/ScannerDomain">ScannerDomain</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions.html#/s:6eRpApp10SchedulersV">Schedulers</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions.html#/s:6eRpApp14ServiceLocatorC">ServiceLocator</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions.html#/s:6eRpApp25ServiceLocatorDebugAccessC">ServiceLocatorDebugAccess</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions.html#/SharedTask">SharedTask</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions.html#/ShipmentInfoCoreDataStore">ShipmentInfoCoreDataStore</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/ShortFileIdentifier.html">ShortFileIdentifier</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/ShortFileIdentifier/Error.html">– Error</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions.html#/TokenPayload">TokenPayload</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions.html#/TrustAnchor">TrustAnchor</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions.html#/s:10TrustStore0aB5ErrorO">TrustStoreError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions.html#/s:6eRpApp15UIDateFormatterV">UIDateFormatter</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/UserDefaults.html">UserDefaults</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions.html#/s:6eRpApp23UserProfileServiceErrorO">UserProfileServiceError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/ZXDataMatrixWriter.html">ZXDataMatrixWriter</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Protocols.html">Protocols</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/MatrixCodeGenerator.html">MatrixCodeGenerator</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Structs.html">Structures</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/ErxTaskRepositoryDependency.html">ErxTaskRepositoryDependency</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/OrdersRepositoryDependency.html">OrdersRepositoryDependency</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/ProfileImageView.html">ProfileImageView</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/ProfileImageView/Size.html">– Size</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Typealiases.html">Type Aliases</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Typealiases.html#/s:6eRpApp7ScanCANa">ScanCAN</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">

        <section class="section">
          <div class="section-content top-matter">
            
            <h1 id='requirements' class='heading'>Requirements</h1>
<h2 id='bsi-erp-epa' class='heading'>BSI-eRp-ePA</h2>
<h3 id='o-arch_2' class='heading'>O.Arch_2</h3>
<h4 id='code-doc-manual-requirement-notes-md-32-code-data-storage-is-divided-into-service-driven-data-that-is-stored-within-a-database-user-driven-data-that-must-be-secured-such-as-the-egk-can-or-the-egk-certificate-and-user-specific-data-that-is-not-critical-such-as-already-seen-tooltips-or-preferences' class='heading'><code>../doc/manual/requirement-notes.md:32</code>:  Data storage is divided into service driven data that is stored within a database, user driven data that must be secured, such as the eGK CAN or the eGK Certificate and user specific data that is not critical, such as already seen tooltips or preferences.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Arch_2#0] Data storage is divided into service driven data that is stored within a database, user driven data that must be secured, such as the eGK CAN or the eGK Certificate and user specific data that is not critical, such as already seen tooltips or preferences.
</code></pre>
<h4 id='code-sources-erplocalstorage-coredatacontrollerfactory-swift-32-code-coredata-databases-are-protected' class='heading'><code>../Sources/eRpLocalStorage/CoreDataControllerFactory.swift:32</code>:  CoreData databases are protected</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Purp_8#2,O.Arch_2#1] CoreData databases are protected
self.fileProtection = fileProtection
</code></pre>
<h4 id='code-sources-erplocalstorage-coredatacontroller-swift-60-code-actual-protection-setting-on-file-system-level' class='heading'><code>../Sources/eRpLocalStorage/CoreDataController.swift:60</code>:  actual protection setting on file system level</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Purp_8#3,O.Arch_2#2] actual protection setting on file system level
protectedStoreDescription.setOption(
</code></pre>
<h4 id='code-sources-erplocalstorage-coredatacontroller-swift-84-code-database-backup-exclusion' class='heading'><code>../Sources/eRpLocalStorage/CoreDataController.swift:84</code>:  Database backup exclusion</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Purp_8#4,O.Arch_2#3,O.Arch_4#2] Database backup exclusion
if excludeFromBackup, let storeUrl = store.url {
</code></pre>
<h4 id='code-sources-erpapp-session-keychainstorage-swift-23-code-implementation-of-data-storage-that-is' class='heading'><code>../Sources/eRpApp/Session/KeychainStorage.swift:23</code>:  Implementation of data storage that is</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_eRp_FdV:A_19186]
// [REQ:gemSpec_eRp_FdV:A_19188] Deletion of data saved here is managed by the OS.
// [REQ:gemSpec_IDP_Frontend:A_21322] Storage implementation uses iOS Keychain
// [REQ:gemF_Tokenverschlüsselung:A_21322] Storage implementation uses iOS Keychain
// [REQ:gemSpec_IDP_Frontend:A_21595] Storage Implementation
// [REQ:BSI-eRp-ePA:O.Purp_8#1,O.Arch_2#4,O.Arch_4#3,O.Source_7#2,O.Data_2#2] Implementation of data storage that is
// persisted via keychain
class KeychainStorage: SecureUserDataStore, IDPStorage, SecureEGKCertificateStorage {
</code></pre>
<h4 id='code-sources-erplocalstorage-userstore-userdefaultsstore-swift-12-code-user-data-that-has-no-password-character' class='heading'><code>../Sources/eRpLocalStorage/UserStore/UserDefaultsStore.swift:12</code>:  User data that has no password character</h4>

<p>code</p>
<pre class="highlight plaintext"><code>/// Interface to access user specific data
/// [REQ:BSI-eRp-ePA:O.Arch_2#5] User data that has no password character
public class UserDefaultsStore: UserDataStore {
</code></pre>
<h3 id='o-arch_3' class='heading'>O.Arch_3</h3>
<h4 id='code-doc-manual-requirement-notes-md-33-code-all-cryptography-is-specified-by-gemspec_krypt-in-corporation-with-bsi' class='heading'><code>../doc/manual/requirement-notes.md:33</code>:  All cryptography is specified by gemSpec_Krypt in corporation with BSI</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Arch_3] All cryptography is specified by gemSpec_Krypt in corporation with BSI
</code></pre>
<h3 id='o-arch_4' class='heading'>O.Arch_4</h3>
<h4 id='code-doc-manual-requirement-notes-md-34-code-all-data-is-either-stored-encrypted-within-the-keychain-or-excluded-from-system-backup-which-also-excludes-files-from-cloud-backup' class='heading'><code>../doc/manual/requirement-notes.md:34</code>:  All data is either stored encrypted within the keychain or excluded from system backup, which also excludes files from cloud backup.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Arch_4#1] All data is either stored encrypted within the keychain or excluded from system backup, which also excludes files from cloud backup.
</code></pre>
<h4 id='code-sources-erplocalstorage-coredatacontroller-swift-84-code-database-backup-exclusion' class='heading'><code>../Sources/eRpLocalStorage/CoreDataController.swift:84</code>:  Database backup exclusion</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Purp_8#4,O.Arch_2#3,O.Arch_4#2] Database backup exclusion
if excludeFromBackup, let storeUrl = store.url {
</code></pre>
<h4 id='code-sources-erpapp-session-keychainstorage-swift-23-code-implementation-of-data-storage-that-is' class='heading'><code>../Sources/eRpApp/Session/KeychainStorage.swift:23</code>:  Implementation of data storage that is</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_eRp_FdV:A_19186]
// [REQ:gemSpec_eRp_FdV:A_19188] Deletion of data saved here is managed by the OS.
// [REQ:gemSpec_IDP_Frontend:A_21322] Storage implementation uses iOS Keychain
// [REQ:gemF_Tokenverschlüsselung:A_21322] Storage implementation uses iOS Keychain
// [REQ:gemSpec_IDP_Frontend:A_21595] Storage Implementation
// [REQ:BSI-eRp-ePA:O.Purp_8#1,O.Arch_2#4,O.Arch_4#3,O.Source_7#2,O.Data_2#2] Implementation of data storage that is
// persisted via keychain
class KeychainStorage: SecureUserDataStore, IDPStorage, SecureEGKCertificateStorage {
</code></pre>
<h3 id='o-arch_5' class='heading'>O.Arch_5</h3>
<h4 id='code-doc-manual-requirement-notes-md-35-code-see-server-audit-for-verification' class='heading'><code>../doc/manual/requirement-notes.md:35</code>:  See server audit for verification.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Arch_5#1] See server audit for verification.
</code></pre>
<h3 id='o-arch_6' class='heading'>O.Arch_6</h3>
<h4 id='code-doc-manual-requirement-notes-md-36-code-apple-already-implements-this-with-a-signed-binary-delivered-to-customers-an-altered-application-can-only-run-on-a-jailbroken-device-if-a-user-is-using-a-jailbroken-device-may-it-be-known-or-unknown-we-display-a-security-alert-so-a-user-can-make-an-informed-decision-to-use-or-not-use-the-application' class='heading'><code>../doc/manual/requirement-notes.md:36</code>:  Apple already implements this with a signed binary delivered to customers. An altered application can only run on a jailbroken device. If a user is using a jailbroken device, may it be known or unknown, we display a security alert so a user can make an informed decision to use or not use the application.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Arch_6#1] Apple already implements this with a signed binary delivered to customers. An altered application can only run on a jailbroken device. If a user is using a jailbroken device, may it be known or unknown, we display a security alert so a user can make an informed decision to use or not use the application.
</code></pre>
<h4 id='code-sources-erpapp-screens-main-mainview-swift-97-code-triggger-device-security-check' class='heading'><code>../Sources/eRpApp/Screens/Main/MainView.swift:97</code>:  triggger device security check</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Arch_6#2,O.Resi_2#2,O.Plat_1#2] triggger device security check
viewStore.send(.loadDeviceSecurityView)
</code></pre>
<h4 id='code-sources-erpapp-session-helper-devicesecuritymanager-swift-58-code-calculate-system-risk-for-jailbreak-and-missing-device-pin' class='heading'><code>../Sources/eRpApp/Session/Helper/DeviceSecurityManager.swift:58</code>:  calculate system risk for jailbreak and missing device pin</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Arch_6#3,O.Resi_2#3,O.Plat_1#3] calculate system risk for jailbreak and missing device pin
var showSystemSecurityWarning: AnyPublisher&lt;DeviceSecurityWarningType, Never&gt; {
</code></pre>
<h4 id='code-sources-erpapp-session-helper-devicesecuritymanager-swift-114-code-jailbreak-detection' class='heading'><code>../Sources/eRpApp/Session/Helper/DeviceSecurityManager.swift:114</code>:  Jailbreak detection</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_BSI_FdV:A_20937] Jailbreak detection
// [REQ:BSI-eRp-ePA:O.Arch_6#4,O.Resi_2#4] Jailbreak detection
func informJailbreakDetected() -&gt; Bool {
</code></pre>
<h3 id='o-arch_7' class='heading'>O.Arch_7</h3>
<h4 id='code-doc-manual-requirement-notes-md-37-code-we-use-oss-where-no-guarantees-are-made-besides-openssl-and-xzing-we-screen-the-whole-code-and-know-prette-good-what-the-libraries-are-doing-most-dependencies-have-a-very-narrow-use-case-and-are-ui-related' class='heading'><code>../doc/manual/requirement-notes.md:37</code>:  We use OSS where no guarantees are made. Besides OpenSSL and XZING we screen the whole code and know prette good what the libraries are doing. Most dependencies have a very narrow use case and are UI related.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Arch_7#1] We use OSS where no guarantees are made. Besides OpenSSL and XZING we screen the whole code and know prette good what the libraries are doing. Most dependencies have a very narrow use case and are UI related.
</code></pre>
<h3 id='o-arch_8' class='heading'>O.Arch_8</h3>
<h4 id='code-sources-erpapp-screens-settings-termsofuse-termsofuseview-swift-12-code-webview-containint-local-html-without-javascript' class='heading'><code>../Sources/eRpApp/Screens/Settings/TermsOfUse/TermsOfUseView.swift:12</code>:  Webview containint local html without javascript</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Purp_3#2] Actual view for the Terms of Use display
// [REQ:BSI-eRp-ePA:O.Arch_8#1] Webview containint local html without javascript
struct TermsOfUseView: View {
</code></pre>
<h4 id='code-sources-erpapp-screens-settings-foss-fossview-swift-10-code-webview-containint-local-html-without-javascript' class='heading'><code>../Sources/eRpApp/Screens/Settings/FOSS/FOSSView.swift:10</code>:  Webview containint local html without javascript</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Arch_8#2] Webview containint local html without javascript
struct FOSSView: View {
</code></pre>
<h4 id='code-sources-erpapp-screens-settings-dataprivacy-dataprivacyview-swift-12-code-webview-containint-local-html-without-javascript' class='heading'><code>../Sources/eRpApp/Screens/Settings/DataPrivacy/DataPrivacyView.swift:12</code>:  Webview containint local html without javascript</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Purp_1#2] Actual View driving the display of `DataPrivacy.html`
// [REQ:BSI-eRp-ePA:O.Arch_8#3] Webview containint local html without javascript
struct DataPrivacyView: View {
</code></pre>
<h3 id='o-arch_9' class='heading'>O.Arch_9</h3>
<h4 id='code-doc-manual-requirement-notes-md-38-code-link-within-dataprivacy-html-to-a-href-https-www-gematik-de-datensicherheit-https-www-gematik-de-datensicherheit-a' class='heading'><code>../doc/manual/requirement-notes.md:38</code>:  Link within DataPrivacy.html to <a href="https://www.gematik.de/datensicherheit">https://www.gematik.de/datensicherheit</a></h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Arch_9#1] Link within DataPrivacy.html to https://www.gematik.de/datensicherheit
</code></pre>
<h4 id='code-sources-erpapp-screens-onboarding-onboardinglegalinfoview-swift-162-code-dataprivacy-display-within-onboarding' class='heading'><code>../Sources/eRpApp/Screens/Onboarding/OnboardingLegalInfoView.swift:162</code>:  DataPrivacy display within Onboarding</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Arch_9#2] DataPrivacy display within Onboarding
.sheet(isPresented: $showTermsOfPrivacy) {
</code></pre>
<h4 id='code-sources-erpapp-screens-settings-settingslegalinfoview-swift-52-code-dataprivacy-display-within-settings' class='heading'><code>../Sources/eRpApp/Screens/Settings/SettingsLegalInfoView.swift:52</code>:  DataPrivacy display within Settings</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Arch_9#3] DataPrivacy display within Settings
NavigationLink(
</code></pre>
<h3 id='o-arch_10' class='heading'>O.Arch_10</h3>
<h4 id='code-doc-manual-requirement-notes-md-39-code-currently-only-implemented-via-apikey-usage-against-apovzd-and-fd-all-requests-against-the-backends-may-respond-with-an-403-status-code-the-app-stays-usable-but-only-without-any-server-connection' class='heading'><code>../doc/manual/requirement-notes.md:39</code>:  Currently only implemented via APIKey usage against APOVZD and FD. All requests against the backends may respond with an 403 status code. The App stays usable, but only without any server connection.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Arch_10#1] Currently only implemented via APIKey usage against APOVZD and FD. All requests against the backends may respond with an 403 status code. The App stays usable, but only without any server connection.
</code></pre>
<h3 id='o-arch_11' class='heading'>O.Arch_11</h3>
<h4 id='code-doc-manual-requirement-notes-md-40-code-not-implemented' class='heading'><code>../doc/manual/requirement-notes.md:40</code>:  Not implemented</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Arch_11#1] Not implemented
</code></pre>
<h3 id='o-arch_12' class='heading'>O.Arch_12</h3>
<h4 id='code-doc-manual-requirement-notes-md-41-code-not-necessary-due-to-o-arch_11-not-being-implemented' class='heading'><code>../doc/manual/requirement-notes.md:41</code>:  Not necessary due to O.Arch_11 not being implemented.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Arch_12#1] Not necessary due to O.Arch_11 not being implemented.
</code></pre>
<h3 id='o-auth_1' class='heading'>O.Auth_1</h3>
<h4 id='code-doc-manual-requirement-notes-md-70-code' class='heading'><code>../doc/manual/requirement-notes.md:70</code>:</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Auth_1#1]
</code></pre>
<h3 id='o-auth_2' class='heading'>O.Auth_2</h3>
<h4 id='code-doc-manual-requirement-notes-md-71-code-there-is-no-client-side-separation-of-authentication-and-authorization' class='heading'><code>../doc/manual/requirement-notes.md:71</code>:  There is no client side separation of authentication and authorization.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Auth_2#1] There is no client side separation of authentication and authorization.
</code></pre>
<h3 id='o-auth_3' class='heading'>O.Auth_3</h3>
<h4 id='code-doc-manual-requirement-notes-md-72-code-one-way-to-connect-to-the-fd-ist-to-login-by-using-the-egk-to-login-with-the-egk-the-card-a-can-and-a-pin-is-needed-the-other-way-is-to-use-a-insurance-company-provided-app-these-apps-must-implement-a-second-factor-as-well-see-all-code-cardwall-code-prefixed-files-for-all-implementation-details' class='heading'><code>../doc/manual/requirement-notes.md:72</code>:  One way to connect to the FD ist to login by using the eGK. To login with the eGK, the card, a CAN and a PIN is needed. The other way is to use a insurance company provided app. These apps must implement a second factor as well. See all <code>CardWall</code> prefixed files for all implementation details.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Auth_3#1] One way to connect to the FD ist to login by using the eGK. To login with the eGK, the card, a CAN and a PIN is needed. The other way is to use a insurance company provided app. These apps must implement a second factor as well. See all `CardWall` prefixed files for all implementation details.
</code></pre>
<h4 id='code-sources-erpapp-screens-cardwall-extauth-cardwallextauthconfirmationdomain-swift-86-code-start-login-with-kk' class='heading'><code>../Sources/eRpApp/Screens/CardWall/ExtAuth/CardWallExtAuthConfirmationDomain.swift:86</code>:  Start login with KK</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Sek:A_22294] Start login with KK
// [REQ:BSI-eRp-ePA:O.Auth_3#2,O.Plat_10#2] Start login with KK
return environment.idpSession.startExtAuth(entry: state.selectedKK)
</code></pre>
<h4 id='code-sources-erpapp-screens-cardwall-readcard-cardwallreadcarddomain-swift-196-code-implementation-of-egk-connection' class='heading'><code>../Sources/eRpApp/Screens/CardWall/ReadCard/CardWallReadCardDomain.swift:196</code>:  Implementation of eGK connection</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Auth_3#2] Implementation of eGK connection
case let .signChallenge(challenge):
</code></pre>
<h3 id='o-auth_4' class='heading'>O.Auth_4</h3>
<h4 id='code-doc-manual-requirement-notes-md-73-code-there-is-no-step-up-from-always-using-2nd-factor-authentication-tokens-have-short-lifetimes-of-12h-server-defined-sso-tokens-and-5m-access-tokens' class='heading'><code>../doc/manual/requirement-notes.md:73</code>:  There is no step up from always using 2nd factor authentication. Tokens have short lifetimes of 12h (server defined) SSO-Tokens and 5m Access-Tokens.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Auth_4#1] There is no step up from always using 2nd factor authentication. Tokens have short lifetimes of 12h (server defined) SSO-Tokens and 5m Access-Tokens.
</code></pre>
<h3 id='o-auth_5' class='heading'>O.Auth_5</h3>
<h4 id='code-doc-manual-requirement-notes-md-74-code-a-audit-log-for-every-fd-access-is-available-in-each-user-profile' class='heading'><code>../doc/manual/requirement-notes.md:74</code>:  A Audit Log for every FD access is available in each user profile.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Auth_5#1] A Audit Log for every FD access is available in each user profile.
</code></pre>
<h4 id='code-sources-erpapp-screens-settings-profiles-edit-editprofileview-swift-494-code-actual-button-to-open-the-audit-events' class='heading'><code>../Sources/eRpApp/Screens/Settings/Profiles/Edit/EditProfileView.swift:494</code>:  Actual Button to open the audit events</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_eRp_FdV:A_19177#2] Actual Button to open the audit events
// [REQ:BSI-eRp-ePA:O.Auth_5#2] Actual Button to open the audit events
NavigationLink(
</code></pre>
<h4 id='code-sources-erpapp-screens-settings-profiles-protocol-auditeventsview-swift-11-code-view-displaying-the-audit-events' class='heading'><code>../Sources/eRpApp/Screens/Settings/Profiles/Protocol/AuditEventsView.swift:11</code>:  View displaying the audit events</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_eRp_FdV:A_19177#1] View displaying the audit events
// [REQ:BSI-eRp-ePA:O.Auth_5#3] View displaying the audit events
struct AuditEventsView: View {
</code></pre>
<h3 id='o-auth_6' class='heading'>O.Auth_6</h3>
<h4 id='code-doc-manual-requirement-notes-md-75-code-there-are-not-passwords-to-guess-for-server-login-within-our-application-only-egk-login-is-directly-available-within-the-application-the-users-applicaiton-password-is-not-delayed-as-any-user-with-pin-access-would-have-access-to-the-unencrypted-file-system-as-well' class='heading'><code>../doc/manual/requirement-notes.md:75</code>:  There are not passwords to guess for server login within our application. Only eGK login is directly available within the application. The users applicaiton password is not delayed, as any user with PIN access would have access to the unencrypted file system as well.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Auth_6#1] There are not passwords to guess for server login within our application. Only eGK login is directly available within the application. The users applicaiton password is not delayed, as any user with PIN access would have access to the unencrypted file system as well.
</code></pre>
<h4 id='code-sources-erpapp-screens-appauthentication-appauthenticationpassword-appauthenticationpassworddomain-swift-8-code-domain-handling-app-authentication' class='heading'><code>../Sources/eRpApp/Screens/AppAuthentication/AppAuthenticationPassword/AppAuthenticationPasswordDomain.swift:8</code>:  Domain handling App Authentication</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Auth_6#2] Domain handling App Authentication
struct AppAuthenticationPasswordDomain: ReducerProtocol {
</code></pre>
<h4 id='code-sources-erpapp-session-helper-appsecuritymanager-swift-41-code-actual-password-check' class='heading'><code>../Sources/eRpApp/Session/Helper/AppSecurityManager.swift:41</code>:  Actual password check</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Auth_6#3] Actual password check
func matches(password: String) throws -&gt; Bool {
</code></pre>
<h3 id='o-auth_7' class='heading'>O.Auth_7</h3>
<h4 id='code-doc-manual-requirement-notes-md-76-code-the-scenedelegate-exchanges-the-active-window-with-an-authentication-window-every-time-the-app-gains-focus' class='heading'><code>../doc/manual/requirement-notes.md:76</code>:  The SceneDelegate exchanges the active window with an authentication window every time the app gains focus</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Auth_7#1] The SceneDelegate exchanges the active window with an authentication window every time the app gains focus
</code></pre>
<h4 id='code-sources-erpapp-scenedelegate-swift-119-code-present-the-authentication-window' class='heading'><code>../Sources/eRpApp/SceneDelegate.swift:119</code>:  Present the authentication window</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Auth_7#2] Present the authentication window
// dispatching necessary to prevents keyboard not showing on iOS 16
DispatchQueue.main.async { [weak self] in
</code></pre>
<h3 id='o-auth_8' class='heading'>O.Auth_8</h3>
<h4 id='code-doc-manual-requirement-notes-md-77-code-a-timer-is-used-to-measure-the-time-a-user-is-inactive-every-user-interaction-resets-the-timer' class='heading'><code>../doc/manual/requirement-notes.md:77</code>:  A Timer is used to measure the time a user is inactive. Every user interaction resets the timer.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Auth_8#1] A Timer is used to measure the time a user is inactive. Every user interaction resets the timer.
</code></pre>
<h4 id='code-sources-erpapp-scenedelegate-swift-258-code-a-timer-is-used-to-determine-inactive-users' class='heading'><code>../Sources/eRpApp/SceneDelegate.swift:258</code>:  A timer is used to determine inactive users</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Auth_8#2] A timer is used to determine inactive users
self?.presentAppAuthenticationDomain(scene: scene)
</code></pre>
<h4 id='code-sources-erpapp-scenedelegate-swift-239-code-the-timer-is-reset-on-user-interaction' class='heading'><code>../Sources/eRpApp/SceneDelegate.swift:239</code>:  the timer is reset on user interaction</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Auth_8#3] the timer is reset on user interaction
self?.setupTimer(scene: scene)
</code></pre>
<h4 id='code-sources-erpapp-scenedelegate-swift-268-code-user-interaction-is-determined-by-using-a-higher-order-reducer-watching-all' class='heading'><code>../Sources/eRpApp/SceneDelegate.swift:268</code>:  User interaction is determined by using a higher order reducer watching all</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Auth_8#4] User interaction is determined by using a higher order reducer watching all
// actions
NotificationCenter.default.post(name: .userInteractionDetected, object: nil, userInfo: nil)
</code></pre>
<h4 id='code-sources-erpapp-scenedelegate-swift-25-code-concat-the-user-interaction-reducer-to-the-normal-application-reducer' class='heading'><code>../Sources/eRpApp/SceneDelegate.swift:25</code>:  Concat the user interaction reducer to the normal application reducer</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Auth_8#5] Concat the user interaction reducer to the normal application reducer
reducer: AppStartDomain().analytics().notifyUserInteraction(),
</code></pre>
<h3 id='o-auth_9' class='heading'>O.Auth_9</h3>
<h4 id='code-doc-manual-requirement-notes-md-78-code-token-invalidation-happens-after-12-hours-if-a-user-is-still-active-a-reauthentication-via-egk-biometrics-or-insurance-app-is-necessary-each-meaning-the-posession-and-or-knowledge-of-the-needed-user-input' class='heading'><code>../doc/manual/requirement-notes.md:78</code>:  Token invalidation happens after 12 hours. If a user is still active, a reauthentication via eGK, Biometrics or Insurance App is necessary. Each meaning the posession and or knowledge of the needed user input.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Auth_9#1] Token invalidation happens after 12 hours. If a user is still active, a reauthentication via eGK, Biometrics or Insurance App is necessary. Each meaning the posession and or knowledge of the needed user input.
</code></pre>
<h3 id='o-auth_10' class='heading'>O.Auth_10</h3>
<h4 id='code-doc-manual-requirement-notes-md-79-code-authentication-via-egk-cannot-be-altered-as-the-physical-card-cannot-be-modified-without-authentication-e-g-pin-change-see-gemspec_cos-for-details-adding-a-authentication-key-that-is-secured-via-biometrics-labeld-as-quot-save-login-quot-within-the-cardwall-enforces-a-new-authentication-via-egk-on-server-side' class='heading'><code>../doc/manual/requirement-notes.md:79</code>:  Authentication via eGK cannot be altered, as the physical card cannot be modified without authentication (e.g. PIN change). See gemSpec_COS for details. Adding a authentication key that is secured via biometrics (labeld as &ldquo;save login&rdquo; within the cardwall) enforces a new authentication via eGK on server side.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Auth_10#1] Authentication via eGK cannot be altered, as the physical card cannot be modified without authentication (e.g. PIN change). See gemSpec_COS for details. Adding a authentication key that is secured via biometrics (labeld as "save login" within the cardwall) enforces a new authentication via eGK on server side.
</code></pre>
<h3 id='o-auth_11' class='heading'>O.Auth_11</h3>
<h4 id='code-doc-manual-requirement-notes-md-80-code-we-use-tls-pinning-and-a-trust-store-for-vau-communication-see-truststore-and-vau-module-for-implementation' class='heading'><code>../doc/manual/requirement-notes.md:80</code>:  We use TLS Pinning and a Trust Store for VAU communication. See TrustStore and VAU Module for implementation.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Auth_11#1] We use TLS Pinning and a Trust Store for VAU communication. See TrustStore and VAU Module for implementation.
</code></pre>
<h3 id='o-auth_12' class='heading'>O.Auth_12</h3>
<h4 id='code-doc-manual-requirement-notes-md-81-code-unused' class='heading'><code>../doc/manual/requirement-notes.md:81</code>:  unused</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Auth_12#1] unused
</code></pre>
<h3 id='o-biom_1' class='heading'>O.Biom_1</h3>
<h4 id='code-doc-manual-requirement-notes-md-88-code-the-authentication-via-biometric-is-only-available-upon-successfull-authentication-via-egk-pin' class='heading'><code>../doc/manual/requirement-notes.md:88</code>:  The authentication via biometric is only available upon successfull authentication via eGK + PIN.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Biom_1#1] The authentication via biometric is only available upon successfull authentication via eGK + PIN.
</code></pre>
<h3 id='o-biom_2' class='heading'>O.Biom_2</h3>
<h4 id='code-doc-manual-requirement-notes-md-89-code-minimal-os-version-is-set-to-ios-15-in-compliance-with-tr-03161-1-anhang-c' class='heading'><code>../doc/manual/requirement-notes.md:89</code>:  Minimal OS version is set to iOS 15 in compliance with TR-03161-1 Anhang C.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Biom_2#1] Minimal OS version is set to iOS 15 in compliance with TR-03161-1 Anhang C.
</code></pre>
<h3 id='o-biom_3' class='heading'>O.Biom_3</h3>
<h4 id='code-doc-manual-requirement-notes-md-90-code' class='heading'><code>../doc/manual/requirement-notes.md:90</code>:</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Biom_3#1]
</code></pre>
<h3 id='o-biom_4' class='heading'>O.Biom_4</h3>
<h4 id='code-doc-manual-requirement-notes-md-91-code' class='heading'><code>../doc/manual/requirement-notes.md:91</code>:</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Biom_4#1]
</code></pre>
<h3 id='o-biom_5' class='heading'>O.Biom_5</h3>
<h4 id='code-doc-manual-requirement-notes-md-92-code' class='heading'><code>../doc/manual/requirement-notes.md:92</code>:</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Biom_5#1]
</code></pre>
<h3 id='o-biom_6' class='heading'>O.Biom_6</h3>
<h4 id='code-doc-manual-requirement-notes-md-93-code-biometric-secured-private-keys-are-invalid-whenever-the-biometrics-setup-changes' class='heading'><code>../doc/manual/requirement-notes.md:93</code>:  Biometric secured private keys are invalid whenever the biometrics setup changes.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Biom_6#1] Biometric secured private keys are invalid whenever the biometrics setup changes.
</code></pre>
<h4 id='code-sources-idp-privatekeycontainer-swift-131-code-invalidates-biometry-after-changes' class='heading'><code>../Sources/IDP/PrivateKeyContainer.swift:131</code>:  invalidates biometry after changes</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_21586] invalidates biometry after changes
// [REQ:BSI-eRp-ePA:O.Biom_6#2] invalidates biometry after changes
.biometryCurrentSet], &amp;error) else {
</code></pre>
<h3 id='o-biom_7' class='heading'>O.Biom_7</h3>
<h4 id='code-doc-manual-requirement-notes-md-94-code' class='heading'><code>../doc/manual/requirement-notes.md:94</code>:</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Biom_7#1]
</code></pre>
<h3 id='o-biom_8' class='heading'>O.Biom_8</h3>
<h4 id='code-doc-manual-requirement-notes-md-95-code' class='heading'><code>../doc/manual/requirement-notes.md:95</code>:</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Biom_8#1]
</code></pre>
<h3 id='o-cryp_1' class='heading'>O.Cryp_1</h3>
<h4 id='code-doc-manual-requirement-notes-md-60-code-private-keys-for-encryption-are-either-created-and-stored-within-the-secure-enclave-or-stored-within-the-egk-as-encryption-for-server-communication-is-done-ephemeral-via-ecdh-es-no-static-private-keys-on-client-side-are-necessary' class='heading'><code>../doc/manual/requirement-notes.md:60</code>:  Private keys for encryption are either created and stored within the secure enclave or stored within the eGK. As encryption for Server communication is done ephemeral via ECDH-ES, no static private keys on client side are necessary.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Cryp_1#1] Private keys for encryption are either created and stored within the secure enclave or stored within the eGK. As encryption for Server communication is done ephemeral via ECDH-ES, no static private keys on client side are necessary.
</code></pre>
<h4 id='code-sources-idp-models-signedchallenge-swift-36-code-signature-via-ecdh-ephemeral-static' class='heading'><code>../Sources/IDP/Models/SignedChallenge.swift:36</code>:  Signature via ecdh ephemeral-static</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Cryp_1#2] Signature via ecdh ephemeral-static
// [REQ:BSI-eRp-ePA:O.Cryp_4#5] one time usage for JWE ECDH-ES Encryption
let algorithm = JWE.Algorithm.ecdh_es(JWE.Algorithm.KeyExchangeContext.bpp256r1(
</code></pre>
<h4 id='code-sources-idp-models-signedauthenticationdata-swift-27-code-signature-via-ecdh-ephemeral-static' class='heading'><code>../Sources/IDP/Models/SignedAuthenticationData.swift:27</code>:  Signature via ecdh ephemeral-static</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Cryp_1#3] Signature via ecdh ephemeral-static
// [REQ:BSI-eRp-ePA:O.Cryp_4#4] one time usage for JWE ECDH-ES Encryption
let algorithm = JWE.Algorithm.ecdh_es(JWE.Algorithm.KeyExchangeContext.bpp256r1(
</code></pre>
<h4 id='code-sources-idp-models-registrationdata-swift-108-code-signature-via-ecdh-ephemeral-static' class='heading'><code>../Sources/IDP/Models/RegistrationData.swift:108</code>:  Signature via ecdh ephemeral-static</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Cryp_1#4] Signature via ecdh ephemeral-static
// [REQ:BSI-eRp-ePA:O.Cryp_4#3] one time usage for JWE ECDH-ES Encryption
let algorithm = JWE.Algorithm.ecdh_es(JWE.Algorithm.KeyExchangeContext.bpp256r1(
</code></pre>
<h4 id='code-sources-idp-internal-jwt-jwe-encryption-swift-20-code-signature-via-ecdh-ephemeral-static' class='heading'><code>../Sources/IDP/internal/JWT/JWE+Encryption.swift:20</code>:  Signature via ecdh ephemeral-static</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Cryp_1#5] Signature via ecdh ephemeral-static
// [REQ:BSI-eRp-ePA:O.Cryp_4#6] one time usage for JWE ECDH-ES Encryption
let algorithm = JWE.Algorithm.ecdh_es(JWE.Algorithm.KeyExchangeContext.bpp256r1(
</code></pre>
<h4 id='code-sources-idp-internal-tokenpayload-swift-177-code-signature-via-ecdh-ephemeral-static' class='heading'><code>../Sources/IDP/internal/TokenPayload.swift:177</code>:  Signature via ecdh ephemeral-static</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Cryp_1#6] Signature via ecdh ephemeral-static
// [REQ:BSI-eRp-ePA:O.Cryp_4#2] one time usage for JWE ECDH-ES Encryption
guard let jweHeader = try? JWE.Header(algorithm: JWE.Algorithm.ecdh_es(keyExchangeContext),
</code></pre>
<h3 id='o-cryp_2' class='heading'>O.Cryp_2</h3>
<h4 id='code-doc-manual-requirement-notes-md-61-code-all-cryptographics-are-defined-within-code-gemspec_krypt-code-the-document-was-created-together-with-bsi' class='heading'><code>../doc/manual/requirement-notes.md:61</code>:  All cryptographics are defined within <code>gemSpec_Krypt</code>. The document was created together with BSI.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Cryp_2#1] All cryptographics are defined within `gemSpec_Krypt`. The document was created together with BSI.
</code></pre>
<h3 id='o-cryp_3' class='heading'>O.Cryp_3</h3>
<h4 id='code-doc-manual-requirement-notes-md-62-code-all-cryptographics-are-defined-within-code-gemspec_krypt-code-the-document-was-created-together-with-bsi' class='heading'><code>../doc/manual/requirement-notes.md:62</code>:  All cryptographics are defined within <code>gemSpec_Krypt</code>. The document was created together with BSI.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Cryp_3#1] All cryptographics are defined within `gemSpec_Krypt`. The document was created together with BSI.
</code></pre>
<h4 id='code-sources-idp-privatekeycontainer-swift-62-code-secure-enclave-key-generation' class='heading'><code>../Sources/IDP/PrivateKeyContainer.swift:62</code>:  Secure Enclave Key generation</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// Keychain Query
// [REQ:BSI-eRp-ePA:O.Cryp_3#2,O.Cryp_6#2] Secure Enclave Key generation
let query: [String: Any] = [kSecClass as String: kSecClassKey,
</code></pre>
<h4 id='code-sources-idp-internal-idpcrypto-swift-43-code-brainpool-key-generator' class='heading'><code>../Sources/IDP/internal/IDPCrypto.swift:43</code>:  Brainpool key generator</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Cryp_3#3] Brainpool key generator
try BrainpoolP256r1.KeyExchange.generateKey()
</code></pre>
<h4 id='code-sources-idp-internal-jwt-jwe-kdf-swift-33-code-brainpool-key-generator' class='heading'><code>../Sources/IDP/internal/JWT/JWE+KDF.swift:33</code>:  Brainpool key generator</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Cryp_3#4] Brainpool key generator
= { try BrainpoolP256r1.KeyExchange.generateKey() })
</code></pre>
<h4 id='code-sources-vau-internal-vaucrypto-swift-95-code-brainpool-key-generator' class='heading'><code>../Sources/VAU/internal/VAUCrypto.swift:95</code>:  Brainpool key generator</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_Krypt:GS-A_4357] Key pair generation delegated to OpenSSL with BrainpoolP256r1 parameters
// [REQ:BSI-eRp-ePA:O.Cryp_3#5] Brainpool key generator
let keyPairGenerator = { try BrainpoolP256r1.KeyExchange.generateKey() }
</code></pre>
<h3 id='o-cryp_4' class='heading'>O.Cryp_4</h3>
<h4 id='code-doc-manual-requirement-notes-md-63-code-all-cryptographics-are-defined-within-code-gemspec_krypt-code-the-document-was-created-together-with-bsi' class='heading'><code>../doc/manual/requirement-notes.md:63</code>:  All cryptographics are defined within <code>gemSpec_Krypt</code>. The document was created together with BSI.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Cryp_4#1] All cryptographics are defined within `gemSpec_Krypt`. The document was created together with BSI.
</code></pre>
<h4 id='code-sources-idp-internal-tokenpayload-swift-178-code-one-time-usage-for-jwe-ecdh-es-encryption' class='heading'><code>../Sources/IDP/internal/TokenPayload.swift:178</code>:  one time usage for JWE ECDH-ES Encryption</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Cryp_1#6] Signature via ecdh ephemeral-static
// [REQ:BSI-eRp-ePA:O.Cryp_4#2] one time usage for JWE ECDH-ES Encryption
guard let jweHeader = try? JWE.Header(algorithm: JWE.Algorithm.ecdh_es(keyExchangeContext),
</code></pre>
<h4 id='code-sources-idp-models-registrationdata-swift-109-code-one-time-usage-for-jwe-ecdh-es-encryption' class='heading'><code>../Sources/IDP/Models/RegistrationData.swift:109</code>:  one time usage for JWE ECDH-ES Encryption</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Cryp_1#4] Signature via ecdh ephemeral-static
// [REQ:BSI-eRp-ePA:O.Cryp_4#3] one time usage for JWE ECDH-ES Encryption
let algorithm = JWE.Algorithm.ecdh_es(JWE.Algorithm.KeyExchangeContext.bpp256r1(
</code></pre>
<h4 id='code-sources-idp-models-signedauthenticationdata-swift-28-code-one-time-usage-for-jwe-ecdh-es-encryption' class='heading'><code>../Sources/IDP/Models/SignedAuthenticationData.swift:28</code>:  one time usage for JWE ECDH-ES Encryption</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Cryp_1#3] Signature via ecdh ephemeral-static
// [REQ:BSI-eRp-ePA:O.Cryp_4#4] one time usage for JWE ECDH-ES Encryption
let algorithm = JWE.Algorithm.ecdh_es(JWE.Algorithm.KeyExchangeContext.bpp256r1(
</code></pre>
<h4 id='code-sources-idp-models-signedchallenge-swift-37-code-one-time-usage-for-jwe-ecdh-es-encryption' class='heading'><code>../Sources/IDP/Models/SignedChallenge.swift:37</code>:  one time usage for JWE ECDH-ES Encryption</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Cryp_1#2] Signature via ecdh ephemeral-static
// [REQ:BSI-eRp-ePA:O.Cryp_4#5] one time usage for JWE ECDH-ES Encryption
let algorithm = JWE.Algorithm.ecdh_es(JWE.Algorithm.KeyExchangeContext.bpp256r1(
</code></pre>
<h4 id='code-sources-idp-internal-jwt-jwe-encryption-swift-21-code-one-time-usage-for-jwe-ecdh-es-encryption' class='heading'><code>../Sources/IDP/internal/JWT/JWE+Encryption.swift:21</code>:  one time usage for JWE ECDH-ES Encryption</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Cryp_1#5] Signature via ecdh ephemeral-static
// [REQ:BSI-eRp-ePA:O.Cryp_4#6] one time usage for JWE ECDH-ES Encryption
let algorithm = JWE.Algorithm.ecdh_es(JWE.Algorithm.KeyExchangeContext.bpp256r1(
</code></pre>
<h3 id='o-cryp_5' class='heading'>O.Cryp_5</h3>
<h4 id='code-doc-manual-requirement-notes-md-64-code-we-use-brainpool256r1-and-ecsecprimerandom-256-see-usages-in-o-cryp_1-to-o-cryp_4' class='heading'><code>../doc/manual/requirement-notes.md:64</code>:  We use Brainpool256R1 and ECSECPrimeRandom 256, see usages in O.Cryp_1 to O.Cryp_4</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Cryp_5#1] We use Brainpool256R1 and ECSECPrimeRandom 256, see usages in O.Cryp_1 to O.Cryp_4
</code></pre>
<h3 id='o-cryp_6' class='heading'>O.Cryp_6</h3>
<h4 id='code-doc-manual-requirement-notes-md-65-code-persisted-cryptographic-keys-are-created-within-the-devices-secure-enclave-temporal-keys-are-discarded-as-soon-as-usage-is-no-longer-needed' class='heading'><code>../doc/manual/requirement-notes.md:65</code>:  Persisted cryptographic keys are created within the devices secure enclave. Temporal keys are discarded as soon as usage is no longer needed.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Cryp_6#1] Persisted cryptographic keys are created within the devices secure enclave. Temporal keys are discarded as soon as usage is no longer needed.
</code></pre>
<h4 id='code-sources-idp-privatekeycontainer-swift-62-code-secure-enclave-key-generation' class='heading'><code>../Sources/IDP/PrivateKeyContainer.swift:62</code>:  Secure Enclave Key generation</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// Keychain Query
// [REQ:BSI-eRp-ePA:O.Cryp_3#2,O.Cryp_6#2] Secure Enclave Key generation
let query: [String: Any] = [kSecClass as String: kSecClassKey,
</code></pre>
<h3 id='o-cryp_7' class='heading'>O.Cryp_7</h3>
<h4 id='code-doc-manual-requirement-notes-md-66-code-as-brainpool256r1-is-not-available-within-secure-enclave-but-enforced-by-bsi-where-possible-we-use-secure-enclave-encryption-only-for-biometric-authentication-everywhere-else-cryptographic-operations-are-ephemeral-or-use-the-egk-as-a-secure-execution-environment' class='heading'><code>../doc/manual/requirement-notes.md:66</code>:  As Brainpool256R1 is not available within secure enclave but enforced by BSI where possible, we use secure enclave encryption only for biometric authentication. Everywhere else, cryptographic operations are ephemeral or use the eGK as a secure execution environment.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Cryp_7#1] As Brainpool256R1 is not available within secure enclave but enforced by BSI where possible, we use secure enclave encryption only for biometric authentication. Everywhere else, cryptographic operations are ephemeral or use the eGK as a secure execution environment.
</code></pre>
<h4 id='code-sources-idp-privatekeycontainer-swift-20-code-container-for-private-key-operations-using-secure-enclave-private-keys' class='heading'><code>../Sources/IDP/PrivateKeyContainer.swift:20</code>:  Container for private key operations using secure enclave private keys</h4>

<p>code</p>
<pre class="highlight plaintext"><code>/// Represents a (SecureEnclave) private key, namely `PrK_SE_AUT`, secured by iOS Biometrics.
///
/// [REQ:gemSpec_IDP_Frontend:A_21590] This is the container to represent biometric keys. Usage is limited to
/// authorization purposes
/// [REQ:BSI-eRp-ePA:O.Cryp_7#2] Container for private key operations using secure enclave private keys
public struct PrivateKeyContainer {
</code></pre>
<h3 id='o-data_1' class='heading'>O.Data_1</h3>
<h4 id='code-doc-manual-requirement-notes-md-111-code-user-preferences-are-asked-without-discrimination-within-the-onboarding-process' class='heading'><code>../doc/manual/requirement-notes.md:111</code>:  User preferences are asked without discrimination within the onboarding process</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Data_1#1] User preferences are asked without discrimination within the onboarding process
</code></pre>
<h3 id='o-data_2' class='heading'>O.Data_2</h3>
<h4 id='code-doc-manual-requirement-notes-md-112-code-we-use-the-os-keychain-to-persist-sensitive-data-the-keychain-either-stores-or-encrypts-via-secureenclave' class='heading'><code>../doc/manual/requirement-notes.md:112</code>:  We use the OS Keychain to persist sensitive data. The keychain either stores or encrypts via SecureEnclave.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Data_2#1] We use the OS Keychain to persist sensitive data. The keychain either stores or encrypts via SecureEnclave.
</code></pre>
<h4 id='code-sources-erpapp-session-keychainstorage-swift-23-code-implementation-of-data-storage-that-is' class='heading'><code>../Sources/eRpApp/Session/KeychainStorage.swift:23</code>:  Implementation of data storage that is</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_eRp_FdV:A_19186]
// [REQ:gemSpec_eRp_FdV:A_19188] Deletion of data saved here is managed by the OS.
// [REQ:gemSpec_IDP_Frontend:A_21322] Storage implementation uses iOS Keychain
// [REQ:gemF_Tokenverschlüsselung:A_21322] Storage implementation uses iOS Keychain
// [REQ:gemSpec_IDP_Frontend:A_21595] Storage Implementation
// [REQ:BSI-eRp-ePA:O.Purp_8#1,O.Arch_2#4,O.Arch_4#3,O.Source_7#2,O.Data_2#2] Implementation of data storage that is
// persisted via keychain
class KeychainStorage: SecureUserDataStore, IDPStorage, SecureEGKCertificateStorage {
</code></pre>
<h3 id='o-data_3' class='heading'>O.Data_3</h3>
<h4 id='code-doc-manual-requirement-notes-md-113-code-currently-it-is-not-possible-to-store-data-within-the-secure-enclave-on-ios-we-store-all-data-on-the-encrypted-application-container-on-the-device-see-code-erpapp-entitlements-code-for-code-nsfileprotectioncompleteunlessopen-code-usage' class='heading'><code>../doc/manual/requirement-notes.md:113</code>:  Currently it is not possible to store data within the secure enclave on iOS. We store all data on the encrypted application container on the device. See <code>eRpApp.entitlements</code> for <code>NSFileProtectionCompleteUnlessOpen</code> usage.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Data_3#1] Currently it is not possible to store data within the secure enclave on iOS. We store all data on the encrypted application container on the device. See `eRpApp.entitlements` for `NSFileProtectionCompleteUnlessOpen` usage.
</code></pre>
<h3 id='o-data_4' class='heading'>O.Data_4</h3>
<h4 id='code-doc-manual-requirement-notes-md-114-code-everything-we-store-safe-or-send-anywhere-is-both-verified-as-in-o-resi_4-and-or-encrypted-such-as-keychain-or-the-applicaiton-container' class='heading'><code>../doc/manual/requirement-notes.md:114</code>:  Everything we store, safe or send anywhere is both verified as in O.Resi_4 and or encrypted, such as Keychain or the applicaiton container.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Data_4#1] Everything we store, safe or send anywhere is both verified as in O.Resi_4 and or encrypted, such as Keychain or the applicaiton container.
</code></pre>
<h3 id='o-data_5' class='heading'>O.Data_5</h3>
<h4 id='code-doc-manual-requirement-notes-md-115-code-ephemeral-private-keys-are-released-as-soon-as-they-are-no-longer-needed-see-o-source_5' class='heading'><code>../doc/manual/requirement-notes.md:115</code>:  Ephemeral private keys are released as soon as they are no longer needed (see O.Source_5)</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Data_5#1] Ephemeral private keys are released as soon as they are no longer needed (see O.Source_5)
</code></pre>
<h3 id='o-data_6' class='heading'>O.Data_6</h3>
<h4 id='code-doc-manual-requirement-notes-md-116-code-collected-data-is-sparse-and-use-case-related-as-required' class='heading'><code>../doc/manual/requirement-notes.md:116</code>:  Collected data is sparse and use case related as required.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Data_6#1] Collected data is sparse and use case related as required.
</code></pre>
<h4 id='code-sources-erpapp-screens-cardwall-can-cardwallcanview-swift-167-code-can-is-used-for-egk-connection' class='heading'><code>../Sources/eRpApp/Screens/CardWall/CAN/CardWallCANView.swift:167</code>:  CAN is used for eGK connection</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Purp_2#2,O.Data_6#2] CAN is used for eGK connection
CardWallCANInputView(
</code></pre>
<h4 id='code-sources-erpapp-screens-cameraview-erxtaskscannerview-swift-26-code-scanning-tasks-contains-purpose-related-data-input' class='heading'><code>../Sources/eRpApp/Screens/CameraView/ErxTaskScannerView.swift:26</code>:  Scanning tasks contains purpose related data input</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Purp_2#1,O.Data_6#3] Scanning tasks contains purpose related data input
// [REQ:BSI-eRp-ePA:O.Source_1#1] Scanning tasks starts with scanner callback
viewStore.send(.analyse(scanOutput: $0))
</code></pre>
<h4 id='code-sources-erpapp-screens-cardwall-pin-cardwallpinview-swift-30-code-pin-is-used-for-egk-connection' class='heading'><code>../Sources/eRpApp/Screens/CardWall/PIN/CardWallPINView.swift:30</code>:  PIN is used for eGK Connection</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Purp_2#3,O.Data_6#4] PIN is used for eGK Connection
PINView(store: store).padding()
</code></pre>
<h4 id='code-sources-erpapp-screens-pharmacy-redeem-pharmacycontactview-swift-10-code-contact-information-is-collected-when-needed-for-redeeming' class='heading'><code>../Sources/eRpApp/Screens/Pharmacy/Redeem/PharmacyContactView.swift:10</code>:  Contact information is collected when needed for redeeming</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Purp_2#6,O.Data_6#5] Contact information is collected when needed for redeeming
struct PharmacyContactView: View {
</code></pre>
<h4 id='code-sources-erpapp-tracking-analyticsreducer-swift-16-code-user-interaction-analytics-trigger' class='heading'><code>../Sources/eRpApp/Tracking/AnalyticsReducer.swift:16</code>:  User interaction analytics trigger &hellip;</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Purp_2#4,O.Purp_4#1,O.Data_6#6] User interaction analytics trigger ...
struct AnalyticsReducer&lt;ContentReducer: ReducerProtocol&gt;: ReducerProtocol
</code></pre>
<h4 id='code-sources-erpapp-tracking-contentsquareanalyticsadapter-swift-99-code-records-data-only-if-user-opt-in-is-given' class='heading'><code>../Sources/eRpApp/Tracking/ContentSquareAnalyticsAdapter.swift:99</code>:  &hellip; records data only if user opt-in is given.</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Purp_2#5,O.Purp_4#2,O.Data_6#7] ... records data only if user opt-in is given.
if optIn {
</code></pre>
<h3 id='o-data_7' class='heading'>O.Data_7</h3>
<h4 id='code-doc-manual-requirement-notes-md-117-code-private-data-is-not-initially-created-by-the-application-only-additional-information-such-as-redeeming-or-deleting-prescriptions-create-data-the-created-data-is-kept-on-the-fd' class='heading'><code>../doc/manual/requirement-notes.md:117</code>:  Private data is not initially created by the application. Only additional information, such as redeeming or deleting prescriptions create data. The created data is kept on the FD.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Data_7#1] Private data is not initially created by the application. Only additional information, such as redeeming or deleting prescriptions create data. The created data is kept on the FD.
</code></pre>
<h3 id='o-data_8' class='heading'>O.Data_8</h3>
<h4 id='code-doc-manual-requirement-notes-md-118-code-the-device-camera-is-used-for-scanning-prescriptions' class='heading'><code>../doc/manual/requirement-notes.md:118</code>:  The device camera is used for scanning prescriptions.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Data_8#1] The device camera is used for scanning prescriptions.
</code></pre>
<h4 id='code-sources-erpapp-screens-cameraview-avscannerview-swift-40-code-this-controller-uses-the-camera-as-an-input-device-frames-are-processed-but-never' class='heading'><code>../Sources/eRpApp/Screens/CameraView/AVScannerView.swift:40</code>:  This controller uses the camera as an input device. Frames are processed but never</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Data_8#2] This controller uses the camera as an input device. Frames are processed but never
// stored, metadata is never created here.
class AVScannerViewController: UIViewController, AVCaptureMetadataOutputObjectsDelegate {
</code></pre>
<h3 id='o-data_9' class='heading'>O.Data_9</h3>
<h4 id='code-doc-manual-requirement-notes-md-119-code-the-device-camera-is-used-for-scanning-prescriptions-no-picture-files-are-created' class='heading'><code>../doc/manual/requirement-notes.md:119</code>:   The device camera is used for scanning prescriptions, no picture files are created.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Data_9#1]  The device camera is used for scanning prescriptions, no picture files are created.
</code></pre>
<h3 id='o-data_10' class='heading'>O.Data_10</h3>
<h4 id='code-doc-manual-requirement-notes-md-120-code-password-fields-are-marked-as-such-and-thus-disallow-autocorrections-search-for-code-securefield-code-or-code-securefieldwithreveal-code-for-all-usages' class='heading'><code>../doc/manual/requirement-notes.md:120</code>:  Password fields are marked as such and thus disallow autocorrections. Search for <code>SecureField</code> or <code>SecureFieldWithReveal</code> for all usages.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Data_10#1] Password fields are marked as such and thus disallow autocorrections. Search for `SecureField` or `SecureFieldWithReveal` for all usages.
</code></pre>
<h4 id='code-sources-erpapp-appdelegate-swift-36-code-keyboard-extensions-are-disallowed' class='heading'><code>../Sources/eRpApp/AppDelegate.swift:36</code>:  Keyboard extensions are disallowed</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Data_10#2] Keyboard extensions are disallowed
func application(
</code></pre>
<h4 id='code-sources-erpapp-components-controls-securefieldwithreveal-swift-35-code-code-securefields-code-are-used-for-password-input' class='heading'><code>../Sources/eRpApp/Components/Controls/SecureFieldWithReveal.swift:35</code>:  <code>SecureFields</code> are used for password input.</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Data_10#3] `SecureFields` are used for password input.
SecureField(titleKey, text: $text, onCommit: onCommit)
</code></pre>
<h3 id='o-data_11' class='heading'>O.Data_11</h3>
<h4 id='code-doc-manual-requirement-notes-md-121-code-we-use-default-platform-behavior-for-password-fields' class='heading'><code>../doc/manual/requirement-notes.md:121</code>:  We use default platform behavior for password fields.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Data_11#1] We use default platform behavior for password fields.
</code></pre>
<h3 id='o-data_12' class='heading'>O.Data_12</h3>
<h4 id='code-doc-manual-requirement-notes-md-122-code-there-is-no-api-from-apple-that-allows-extraction-of-biometric-data' class='heading'><code>../doc/manual/requirement-notes.md:122</code>:  There is no API from Apple that allows extraction of biometric data.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Data_12#1] There is no API from Apple that allows extraction of biometric data.
</code></pre>
<h3 id='o-data_13' class='heading'>O.Data_13</h3>
<h4 id='code-doc-manual-requirement-notes-md-123-code-suppressing-screenshots-is-not-possible-as-of-now' class='heading'><code>../doc/manual/requirement-notes.md:123</code>:  Suppressing Screenshots is not possible as of now.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Data_13#1] Suppressing Screenshots is not possible as of now.
</code></pre>
<h4 id='code-sources-erpapp-scenedelegate-swift-174-code-moving-the-application-to-the-background-blurs-the-application' class='heading'><code>../Sources/eRpApp/SceneDelegate.swift:174</code>:  Moving the application to the background blurs the application</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Data_13#2,O.Plat_12#2] Moving the application to the background blurs the application
// window.
addBlurOverlayToWindow()
</code></pre>
<h4 id='code-sources-erpapp-scenedelegate-swift-113-code-moving-the-application-to-the-foreground-removes-the-blur' class='heading'><code>../Sources/eRpApp/SceneDelegate.swift:113</code>:  Moving the application to the foreground removes the blur.</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Data_13#3,O.Plat_12#3] Moving the application to the foreground removes the blur.
removeBlurOverlayFromWindow()
</code></pre>
<h3 id='o-data_14' class='heading'>O.Data_14</h3>
<h4 id='code-doc-manual-requirement-notes-md-124-code-see-code-erpapp-entitlements-code-for-code-nsfileprotectioncompleteunlessopen-code-usage' class='heading'><code>../doc/manual/requirement-notes.md:124</code>:  See <code>eRpApp.entitlements</code> for <code>NSFileProtectionCompleteUnlessOpen</code> usage.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Data_14#1] See `eRpApp.entitlements` for `NSFileProtectionCompleteUnlessOpen` usage.
</code></pre>
<h3 id='o-data_15' class='heading'>O.Data_15</h3>
<h4 id='code-doc-manual-requirement-notes-md-125-code' class='heading'><code>../doc/manual/requirement-notes.md:125</code>:</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Data_15#1]
</code></pre>
<h3 id='o-data_16' class='heading'>O.Data_16</h3>
<h4 id='code-doc-manual-requirement-notes-md-126-code-storing-application-data-is-not-possible-on-ios' class='heading'><code>../doc/manual/requirement-notes.md:126</code>:  Storing application data is not possible on iOS.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Data_16#1] Storing application data is not possible on iOS.
</code></pre>
<h3 id='o-data_17' class='heading'>O.Data_17</h3>
<h4 id='code-doc-manual-requirement-notes-md-127-code-deletion-is-completly-handled-by-the-os-we-have-no-means-of-doing-anything-while-deinstallation-is-running-all-sensitive-keychain-data-is-tied-to-the-user-profile-id-and-cannot-be-accessed-after-deinstallation-though-technically-the-information-still-persists-for-a-short-period-of-time-lt-24h-after-some-kind-of-daily-cleanup-routine-by-the-os-it-will-be-removed-the-user-may-choose-to-manually-logout-or-delete-profiles-before-app-deletion' class='heading'><code>../doc/manual/requirement-notes.md:127</code>:  Deletion is completly handled by the OS. We have no means of doing anything while deinstallation is running. All sensitive keychain data is tied to the user profile id and cannot be accessed after deinstallation. though technically the information still persists for a short period of time (&lt;24h) after some kind of daily cleanup routine by the OS it will be removed. The user may choose to manually logout or delete profiles before app deletion.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Data_17#1,O.Data_18#1] Deletion is completly handled by the OS. We have no means of doing anything while deinstallation is running. All sensitive keychain data is tied to the user profile id and cannot be accessed after deinstallation. though technically the information still persists for a short period of time (&lt;24h) after some kind of daily cleanup routine by the OS it will be removed. The user may choose to manually logout or delete profiles before app deletion.
</code></pre>
<h3 id='o-data_18' class='heading'>O.Data_18</h3>
<h4 id='code-doc-manual-requirement-notes-md-127-code-deletion-is-completly-handled-by-the-os-we-have-no-means-of-doing-anything-while-deinstallation-is-running-all-sensitive-keychain-data-is-tied-to-the-user-profile-id-and-cannot-be-accessed-after-deinstallation-though-technically-the-information-still-persists-for-a-short-period-of-time-lt-24h-after-some-kind-of-daily-cleanup-routine-by-the-os-it-will-be-removed-the-user-may-choose-to-manually-logout-or-delete-profiles-before-app-deletion' class='heading'><code>../doc/manual/requirement-notes.md:127</code>:  Deletion is completly handled by the OS. We have no means of doing anything while deinstallation is running. All sensitive keychain data is tied to the user profile id and cannot be accessed after deinstallation. though technically the information still persists for a short period of time (&lt;24h) after some kind of daily cleanup routine by the OS it will be removed. The user may choose to manually logout or delete profiles before app deletion.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Data_17#1,O.Data_18#1] Deletion is completly handled by the OS. We have no means of doing anything while deinstallation is running. All sensitive keychain data is tied to the user profile id and cannot be accessed after deinstallation. though technically the information still persists for a short period of time (&lt;24h) after some kind of daily cleanup routine by the OS it will be removed. The user may choose to manually logout or delete profiles before app deletion.
</code></pre>
<h3 id='o-data_19' class='heading'>O.Data_19</h3>
<h4 id='code-doc-manual-requirement-notes-md-128-code-unused' class='heading'><code>../doc/manual/requirement-notes.md:128</code>:  Unused</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Data_19#1] Unused
</code></pre>
<h3 id='o-ntwk_1' class='heading'>O.Ntwk_1</h3>
<h4 id='code-doc-manual-requirement-notes-md-132-code-no-exceptions-set-in-nsapptransportsecurity-http-via-tls-is-enforced-os-will-use-system-root-certificates-in-combination-with-set-pinned-certificates-see-also-a-href-https-developer-apple-com-library-archive-documentation-general-reference-infoplistkeyreference-articles-cocoakeys-html-requirements-for-connecting-using-ats-a' class='heading'><code>../doc/manual/requirement-notes.md:132</code>:  no exceptions set in NSAppTransportSecurity, HTTP via TLS is enforced; OS will use system root certificates in combination with set pinned certificates. see also: <a href="https://developer.apple.com/library/archive/documentation/General/Reference/InfoPlistKeyReference/Articles/CocoaKeys.html">Requirements for Connecting Using ATS</a></h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Ntwk_1#1] no exceptions set in NSAppTransportSecurity, HTTP via TLS is enforced; OS will use system root certificates in combination with set pinned certificates. see also: [Requirements for Connecting Using ATS](https://developer.apple.com/library/archive/documentation/General/Reference/InfoPlistKeyReference/Articles/CocoaKeys.html)
</code></pre>
<h3 id='o-ntwk_2' class='heading'>O.Ntwk_2</h3>
<h4 id='code-doc-manual-requirement-notes-md-133-code-we-use-one-wrapper-around-nsurlsession-for-network-communication-that-uses-an-ephemeral-configuration-only-allowing-tls-1-2-or-greater' class='heading'><code>../doc/manual/requirement-notes.md:133</code>:  We use one wrapper around NSURLSession for network communication that uses an ephemeral configuration only allowing TLS 1.2 or greater.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Ntwk_2#1] We use one wrapper around NSURLSession for network communication that uses an ephemeral configuration only allowing TLS 1.2 or greater.
</code></pre>
<h4 id='code-sources-httpclient-defaulthttpclient-swift-42-code-urlsession-is-used-as-network-framework' class='heading'><code>../Sources/HTTPClient/DefaultHTTPClient.swift:42</code>:  URLSession is used as Network Framework</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_Krypt:GS-A_4385,A_18467,A_18464,GS-A_4387]
// [REQ:gemSpec_Krypt:GS-A_5322] TODO: Check if limiting SSL Sessions is possible, check for renegotiation
// swiftlint:disable:previous todo
// [REQ:gemSpec_IDP_Frontend:A_20606] Live URLs not present in NSAppTransportSecurity exception list for allowed
// HTTP communication
// [REQ:gemSpec_eRp_FdV:A_20206]
// [REQ:BSI-eRp-ePA:O.Sess_1#2,O.Ntwk_2#2,O.Ntwk_3#2] URLSession is used as Network Framework

</code></pre>
<h3 id='o-ntwk_3' class='heading'>O.Ntwk_3</h3>
<h4 id='code-doc-manual-requirement-notes-md-134-code-we-use-nsurlsession-for-network-communication' class='heading'><code>../doc/manual/requirement-notes.md:134</code>:  We use NSURLSession for network communication</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Ntwk_3#1] We use NSURLSession for network communication
</code></pre>
<h4 id='code-sources-httpclient-defaulthttpclient-swift-42-code-urlsession-is-used-as-network-framework' class='heading'><code>../Sources/HTTPClient/DefaultHTTPClient.swift:42</code>:  URLSession is used as Network Framework</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_Krypt:GS-A_4385,A_18467,A_18464,GS-A_4387]
// [REQ:gemSpec_Krypt:GS-A_5322] TODO: Check if limiting SSL Sessions is possible, check for renegotiation
// swiftlint:disable:previous todo
// [REQ:gemSpec_IDP_Frontend:A_20606] Live URLs not present in NSAppTransportSecurity exception list for allowed
// HTTP communication
// [REQ:gemSpec_eRp_FdV:A_20206]
// [REQ:BSI-eRp-ePA:O.Sess_1#2,O.Ntwk_2#2,O.Ntwk_3#2] URLSession is used as Network Framework

</code></pre>
<h3 id='o-ntwk_4' class='heading'>O.Ntwk_4</h3>
<h4 id='code-doc-manual-requirement-notes-md-135-code-see-info-plist-for-ats-settings-and-pinned-domains' class='heading'><code>../doc/manual/requirement-notes.md:135</code>:  See Info.plist for ATS Settings and pinned domains</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Ntwk_4#1] See Info.plist for ATS Settings and pinned domains
</code></pre>
<h3 id='o-ntwk_5' class='heading'>O.Ntwk_5</h3>
<h4 id='code-doc-manual-requirement-notes-md-136-code-by-using-nsurlsession-ats-app-transport-security-handles-that-within-the-application' class='heading'><code>../doc/manual/requirement-notes.md:136</code>:  By using NSURLSession ATS (App Transport Security) handles that within the application.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Ntwk_5#1] By using NSURLSession ATS (App Transport Security) handles that within the application.
</code></pre>
<h3 id='o-ntwk_6' class='heading'>O.Ntwk_6</h3>
<h4 id='code-doc-manual-requirement-notes-md-137-code-the-server-uses-extended-validation-certificates-to-ensure-maximum-authenticity' class='heading'><code>../doc/manual/requirement-notes.md:137</code>:  The server uses extended validation certificates to ensure maximum authenticity.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Ntwk_6#1] The server uses extended validation certificates to ensure maximum authenticity.
</code></pre>
<h3 id='o-ntwk_7' class='heading'>O.Ntwk_7</h3>
<h4 id='code-doc-manual-requirement-notes-md-138-code-see-info-plist-for-ats-settings-no-exceptions-are-made' class='heading'><code>../doc/manual/requirement-notes.md:138</code>:  See Info.plist for ATS Settings, no exceptions are made.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Ntwk_7#1] See Info.plist for ATS Settings, no exceptions are made.
</code></pre>
<h3 id='o-ntwk_8' class='heading'>O.Ntwk_8</h3>
<h4 id='code-doc-manual-requirement-notes-md-139-code' class='heading'><code>../doc/manual/requirement-notes.md:139</code>:</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Ntwk_8#1]
</code></pre>
<h3 id='o-ntwk_9' class='heading'>O.Ntwk_9</h3>
<h4 id='code-doc-manual-requirement-notes-md-140-code' class='heading'><code>../doc/manual/requirement-notes.md:140</code>:</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Ntwk_9#1]
</code></pre>
<h3 id='o-paid_1' class='heading'>O.Paid_1</h3>
<h4 id='code-doc-manual-requirement-notes-md-130-code-the-app-does-not-offer-any-purchases' class='heading'><code>../doc/manual/requirement-notes.md:130</code>:  The app does not offer any purchases.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Paid_1#1,O.Paid_2#1,O.Paid_3#1,O.Paid_4#1,O.Paid_5#1,O.Paid_6#1,O.Paid_7#1,O.Paid_8#1,O.Paid_9#1,O.Paid_10#1] The app does not offer any purchases.
</code></pre>
<h3 id='o-paid_2' class='heading'>O.Paid_2</h3>
<h4 id='code-doc-manual-requirement-notes-md-130-code-the-app-does-not-offer-any-purchases' class='heading'><code>../doc/manual/requirement-notes.md:130</code>:  The app does not offer any purchases.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Paid_1#1,O.Paid_2#1,O.Paid_3#1,O.Paid_4#1,O.Paid_5#1,O.Paid_6#1,O.Paid_7#1,O.Paid_8#1,O.Paid_9#1,O.Paid_10#1] The app does not offer any purchases.
</code></pre>
<h3 id='o-paid_3' class='heading'>O.Paid_3</h3>
<h4 id='code-doc-manual-requirement-notes-md-130-code-the-app-does-not-offer-any-purchases' class='heading'><code>../doc/manual/requirement-notes.md:130</code>:  The app does not offer any purchases.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Paid_1#1,O.Paid_2#1,O.Paid_3#1,O.Paid_4#1,O.Paid_5#1,O.Paid_6#1,O.Paid_7#1,O.Paid_8#1,O.Paid_9#1,O.Paid_10#1] The app does not offer any purchases.
</code></pre>
<h3 id='o-paid_4' class='heading'>O.Paid_4</h3>
<h4 id='code-doc-manual-requirement-notes-md-130-code-the-app-does-not-offer-any-purchases' class='heading'><code>../doc/manual/requirement-notes.md:130</code>:  The app does not offer any purchases.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Paid_1#1,O.Paid_2#1,O.Paid_3#1,O.Paid_4#1,O.Paid_5#1,O.Paid_6#1,O.Paid_7#1,O.Paid_8#1,O.Paid_9#1,O.Paid_10#1] The app does not offer any purchases.
</code></pre>
<h3 id='o-paid_5' class='heading'>O.Paid_5</h3>
<h4 id='code-doc-manual-requirement-notes-md-130-code-the-app-does-not-offer-any-purchases' class='heading'><code>../doc/manual/requirement-notes.md:130</code>:  The app does not offer any purchases.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Paid_1#1,O.Paid_2#1,O.Paid_3#1,O.Paid_4#1,O.Paid_5#1,O.Paid_6#1,O.Paid_7#1,O.Paid_8#1,O.Paid_9#1,O.Paid_10#1] The app does not offer any purchases.
</code></pre>
<h3 id='o-paid_6' class='heading'>O.Paid_6</h3>
<h4 id='code-doc-manual-requirement-notes-md-130-code-the-app-does-not-offer-any-purchases' class='heading'><code>../doc/manual/requirement-notes.md:130</code>:  The app does not offer any purchases.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Paid_1#1,O.Paid_2#1,O.Paid_3#1,O.Paid_4#1,O.Paid_5#1,O.Paid_6#1,O.Paid_7#1,O.Paid_8#1,O.Paid_9#1,O.Paid_10#1] The app does not offer any purchases.
</code></pre>
<h3 id='o-paid_7' class='heading'>O.Paid_7</h3>
<h4 id='code-doc-manual-requirement-notes-md-130-code-the-app-does-not-offer-any-purchases' class='heading'><code>../doc/manual/requirement-notes.md:130</code>:  The app does not offer any purchases.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Paid_1#1,O.Paid_2#1,O.Paid_3#1,O.Paid_4#1,O.Paid_5#1,O.Paid_6#1,O.Paid_7#1,O.Paid_8#1,O.Paid_9#1,O.Paid_10#1] The app does not offer any purchases.
</code></pre>
<h3 id='o-paid_8' class='heading'>O.Paid_8</h3>
<h4 id='code-doc-manual-requirement-notes-md-130-code-the-app-does-not-offer-any-purchases' class='heading'><code>../doc/manual/requirement-notes.md:130</code>:  The app does not offer any purchases.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Paid_1#1,O.Paid_2#1,O.Paid_3#1,O.Paid_4#1,O.Paid_5#1,O.Paid_6#1,O.Paid_7#1,O.Paid_8#1,O.Paid_9#1,O.Paid_10#1] The app does not offer any purchases.
</code></pre>
<h3 id='o-paid_9' class='heading'>O.Paid_9</h3>
<h4 id='code-doc-manual-requirement-notes-md-130-code-the-app-does-not-offer-any-purchases' class='heading'><code>../doc/manual/requirement-notes.md:130</code>:  The app does not offer any purchases.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Paid_1#1,O.Paid_2#1,O.Paid_3#1,O.Paid_4#1,O.Paid_5#1,O.Paid_6#1,O.Paid_7#1,O.Paid_8#1,O.Paid_9#1,O.Paid_10#1] The app does not offer any purchases.
</code></pre>
<h3 id='o-paid_10' class='heading'>O.Paid_10</h3>
<h4 id='code-doc-manual-requirement-notes-md-130-code-the-app-does-not-offer-any-purchases' class='heading'><code>../doc/manual/requirement-notes.md:130</code>:  The app does not offer any purchases.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Paid_1#1,O.Paid_2#1,O.Paid_3#1,O.Paid_4#1,O.Paid_5#1,O.Paid_6#1,O.Paid_7#1,O.Paid_8#1,O.Paid_9#1,O.Paid_10#1] The app does not offer any purchases.
</code></pre>
<h3 id='o-pass_1' class='heading'>O.Pass_1</h3>
<h4 id='code-doc-manual-requirement-notes-md-83-code-we-use-zxcvbn-ios-as-a-password-strength-indicator-and-enforcer-for-the-application-password' class='heading'><code>../doc/manual/requirement-notes.md:83</code>:  We use zxcvbn-ios as a password strength indicator and enforcer for the application password.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Pass_1#1,O.Pass_2#1] We use zxcvbn-ios as a password strength indicator and enforcer for the application password.
</code></pre>
<h3 id='o-pass_2' class='heading'>O.Pass_2</h3>
<h4 id='code-doc-manual-requirement-notes-md-83-code-we-use-zxcvbn-ios-as-a-password-strength-indicator-and-enforcer-for-the-application-password' class='heading'><code>../doc/manual/requirement-notes.md:83</code>:  We use zxcvbn-ios as a password strength indicator and enforcer for the application password.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Pass_1#1,O.Pass_2#1] We use zxcvbn-ios as a password strength indicator and enforcer for the application password.
</code></pre>
<h3 id='o-pass_3' class='heading'>O.Pass_3</h3>
<h4 id='code-doc-manual-requirement-notes-md-84-code-the-user-may-change-the-app-passwords-within-the-settings' class='heading'><code>../doc/manual/requirement-notes.md:84</code>:  The user may change the app passwords within the settings.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Pass_3#1] The user may change the app passwords within the settings.
</code></pre>
<h4 id='code-sources-erpapp-screens-settings-appsecurity-createpasswordview-swift-10-code-view-for-changing-the-user-password' class='heading'><code>../Sources/eRpApp/Screens/Settings/AppSecurity/CreatePasswordView.swift:10</code>:  View for changing the user password</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Pass_3#2] View for changing the user password
struct CreatePasswordView: View {
</code></pre>
<h3 id='o-pass_4' class='heading'>O.Pass_4</h3>
<h4 id='code-doc-manual-requirement-notes-md-85-code-there-is-no-protocoll-for-the-application-password-within-the-application-if-there-is-one-the-keychain-may-hold-it' class='heading'><code>../doc/manual/requirement-notes.md:85</code>:  There is no protocoll for the application password within the application. If there is one, the keychain may hold it.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Pass_4#1] There is no protocoll for the application password within the application. If there is one, the keychain may hold it.
</code></pre>
<h3 id='o-pass_5' class='heading'>O.Pass_5</h3>
<h4 id='code-doc-manual-requirement-notes-md-86-code-we-use-the-keychain-to-persist-the-app-password-the-app-password-is-not-hashed' class='heading'><code>../doc/manual/requirement-notes.md:86</code>:  We use the keychain to persist the app password. The app password is not hashed.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Pass_5#1] We use the keychain to persist the app password. The app password is not hashed.
</code></pre>
<h3 id='o-plat_1' class='heading'>O.Plat_1</h3>
<h4 id='code-doc-manual-requirement-notes-md-142-code-we-test-for-device-pincode-at-startup-and-show-a-dialog-if-no-pin-is-set' class='heading'><code>../doc/manual/requirement-notes.md:142</code>:  We test for device pincode at startup and show a dialog if no pin is set.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Plat_1#1] We test for device pincode at startup and show a dialog if no pin is set.
</code></pre>
<h4 id='code-sources-erpapp-screens-main-mainview-swift-97-code-triggger-device-security-check' class='heading'><code>../Sources/eRpApp/Screens/Main/MainView.swift:97</code>:  triggger device security check</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Arch_6#2,O.Resi_2#2,O.Plat_1#2] triggger device security check
viewStore.send(.loadDeviceSecurityView)
</code></pre>
<h4 id='code-sources-erpapp-session-helper-devicesecuritymanager-swift-58-code-calculate-system-risk-for-jailbreak-and-missing-device-pin' class='heading'><code>../Sources/eRpApp/Session/Helper/DeviceSecurityManager.swift:58</code>:  calculate system risk for jailbreak and missing device pin</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Arch_6#3,O.Resi_2#3,O.Plat_1#3] calculate system risk for jailbreak and missing device pin
var showSystemSecurityWarning: AnyPublisher&lt;DeviceSecurityWarningType, Never&gt; {
</code></pre>
<h4 id='code-sources-erpapp-session-helper-devicesecuritymanager-swift-68-code-missing-system-pin-detection' class='heading'><code>../Sources/eRpApp/Session/Helper/DeviceSecurityManager.swift:68</code>:  Missing system pin detection</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Plat_1#4] Missing system pin detection
var informMissingSystemPin: AnyPublisher&lt;Bool, Never&gt; {
</code></pre>
<h3 id='o-plat_2' class='heading'>O.Plat_2</h3>
<h4 id='code-doc-manual-requirement-notes-md-143-code-see-info-plist-for-all-accessed-entitlements' class='heading'><code>../doc/manual/requirement-notes.md:143</code>:  See Info.plist for all accessed entitlements.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Plat_2#1] See Info.plist for all accessed entitlements.
</code></pre>
<h3 id='o-plat_3' class='heading'>O.Plat_3</h3>
<h4 id='code-doc-manual-requirement-notes-md-144-code-we-use-the-platform-dialogs-for-this-localizations-can-be-found-within-code-infoplist-strings-code' class='heading'><code>../doc/manual/requirement-notes.md:144</code>:  We use the platform dialogs for this. Localizations can be found within <code>InfoPlist.strings</code></h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Plat_3#1] We use the platform dialogs for this. Localizations can be found within `InfoPlist.strings`
</code></pre>
<h3 id='o-plat_4' class='heading'>O.Plat_4</h3>
<h4 id='code-doc-manual-requirement-notes-md-145-code-we-never-show-sensitive-data-as-all-errors-are-localized-with-custom-descriptions-see-code-localizederror-code-implementations-some-errors-have-localized-parameters-such-as-a-failed-pin-counter-some-errors-are-sent-from-the-server-these-messages-show-only-generic-information-what-went-wrong' class='heading'><code>../doc/manual/requirement-notes.md:145</code>:  We never show sensitive data as all errors are localized with custom descriptions (See <code>LocalizedError</code> implementations). Some errors have localized parameters such as a failed PIN counter. Some errors are sent from the server, these messages show only generic information what went wrong.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Plat_4#1] We never show sensitive data as all errors are localized with custom descriptions (See `LocalizedError` implementations). Some errors have localized parameters such as a failed PIN counter. Some errors are sent from the server, these messages show only generic information what went wrong.
</code></pre>
<h3 id='o-plat_5' class='heading'>O.Plat_5</h3>
<h4 id='code-doc-manual-requirement-notes-md-146-code-unused' class='heading'><code>../doc/manual/requirement-notes.md:146</code>:  Unused</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Plat_5#1] Unused
</code></pre>
<h3 id='o-plat_6' class='heading'>O.Plat_6</h3>
<h4 id='code-doc-manual-requirement-notes-md-147-code-implemented-by-the-os-sandboxing' class='heading'><code>../doc/manual/requirement-notes.md:147</code>:  Implemented by the OS Sandboxing.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Plat_6#1,O.Plat_7#1] Implemented by the OS Sandboxing.
</code></pre>
<h3 id='o-plat_7' class='heading'>O.Plat_7</h3>
<h4 id='code-doc-manual-requirement-notes-md-147-code-implemented-by-the-os-sandboxing' class='heading'><code>../doc/manual/requirement-notes.md:147</code>:  Implemented by the OS Sandboxing.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Plat_6#1,O.Plat_7#1] Implemented by the OS Sandboxing.
</code></pre>
<h3 id='o-plat_8' class='heading'>O.Plat_8</h3>
<h4 id='code-doc-manual-requirement-notes-md-148-code-unused' class='heading'><code>../doc/manual/requirement-notes.md:148</code>:  Unused</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Plat_8#1] Unused
</code></pre>
<h3 id='o-plat_9' class='heading'>O.Plat_9</h3>
<h4 id='code-doc-manual-requirement-notes-md-149-code-unused' class='heading'><code>../doc/manual/requirement-notes.md:149</code>:  Unused</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Plat_9#1] Unused
</code></pre>
<h3 id='o-plat_10' class='heading'>O.Plat_10</h3>
<h4 id='code-doc-manual-requirement-notes-md-150-code-interprocesscommunication-is-implemented-using-universal-linking-current-use-cases-are-limited-to-login-with-insurance-company-apps-no-sensitive-data-is-transferred-the-actual-payload-is-decided-by-the-server' class='heading'><code>../doc/manual/requirement-notes.md:150</code>:  Interprocesscommunication is implemented using Universal Linking. Current use cases are limited to login with insurance company apps. No sensitive data is transferred, the actual payload is decided by the server.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Plat_10#1] Interprocesscommunication is implemented using Universal Linking. Current use cases are limited to login with insurance company apps. No sensitive data is transferred, the actual payload is decided by the server.
</code></pre>
<h4 id='code-sources-erpapp-screens-cardwall-extauth-cardwallextauthconfirmationdomain-swift-86-code-start-login-with-kk' class='heading'><code>../Sources/eRpApp/Screens/CardWall/ExtAuth/CardWallExtAuthConfirmationDomain.swift:86</code>:  Start login with KK</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Sek:A_22294] Start login with KK
// [REQ:BSI-eRp-ePA:O.Auth_3#2,O.Plat_10#2] Start login with KK
return environment.idpSession.startExtAuth(entry: state.selectedKK)
</code></pre>
<h4 id='code-sources-erpapp-screens-cardwall-extauth-cardwallextauthconfirmationdomain-swift-99-code-follow-redirect' class='heading'><code>../Sources/eRpApp/Screens/CardWall/ExtAuth/CardWallExtAuthConfirmationDomain.swift:99</code>:  Follow redirect</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Sek:A_22299] Follow redirect
// [REQ:BSI-eRp-ePA:O.Plat_10#3] Follow redirect
guard environment.resourceHandler.canOpenURL(url) else {
</code></pre>
<h3 id='o-plat_11' class='heading'>O.Plat_11</h3>
<h4 id='code-doc-manual-requirement-notes-md-151-code-webviews-only-display-local-content-that-is-delivered-together-with-the-application-javascript-is-disabled-linking-and-loading-other-content-is-disabled-all-website-open-the-system-browser' class='heading'><code>../doc/manual/requirement-notes.md:151</code>:  Webviews only display local content that is delivered together with the application. Javascript is disabled, linking and loading other content is disabled. All website open the system browser.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Plat_11#1] Webviews only display local content that is delivered together with the application. Javascript is disabled, linking and loading other content is disabled. All website open the system browser.
</code></pre>
<h4 id='code-sources-erpapp-screens-settings-dataprivacy-dataprivacyview-swift-26-code-disabled-javascript' class='heading'><code>../Sources/eRpApp/Screens/Settings/DataPrivacy/DataPrivacyView.swift:26</code>:  disabled javascript</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Plat_11#2] disabled javascript
wkWebView.configuration.defaultWebpagePreferences.allowsContentJavaScript = false
</code></pre>
<h4 id='code-sources-erpapp-screens-settings-termsofuse-termsofuseview-swift-26-code-disabled-javascript' class='heading'><code>../Sources/eRpApp/Screens/Settings/TermsOfUse/TermsOfUseView.swift:26</code>:  disabled javascript</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Plat_11#3] disabled javascript
wkWebView.configuration.defaultWebpagePreferences.allowsContentJavaScript = false
</code></pre>
<h4 id='code-sources-erpapp-screens-settings-foss-fossview-swift-25-code-disabled-javascript' class='heading'><code>../Sources/eRpApp/Screens/Settings/FOSS/FOSSView.swift:25</code>:  disabled javascript</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Plat_11#4] disabled javascript
wkWebView.configuration.defaultWebpagePreferences.allowsContentJavaScript = false
</code></pre>
<h3 id='o-plat_12' class='heading'>O.Plat_12</h3>
<h4 id='code-doc-manual-requirement-notes-md-152-code-the-content-window-is-blurred-upon-leaving-the-application-to-not-expose-content-to-the-system-multitasking-switcher' class='heading'><code>../doc/manual/requirement-notes.md:152</code>:  The content window is blurred upon leaving the application to not expose content to the system multitasking switcher.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Plat_12#1] The content window is blurred upon leaving the application to not expose content to the system multitasking switcher.
</code></pre>
<h4 id='code-sources-erpapp-scenedelegate-swift-174-code-moving-the-application-to-the-background-blurs-the-application' class='heading'><code>../Sources/eRpApp/SceneDelegate.swift:174</code>:  Moving the application to the background blurs the application</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Data_13#2,O.Plat_12#2] Moving the application to the background blurs the application
// window.
addBlurOverlayToWindow()
</code></pre>
<h4 id='code-sources-erpapp-scenedelegate-swift-113-code-moving-the-application-to-the-foreground-removes-the-blur' class='heading'><code>../Sources/eRpApp/SceneDelegate.swift:113</code>:  Moving the application to the foreground removes the blur.</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Data_13#3,O.Plat_12#3] Moving the application to the foreground removes the blur.
removeBlurOverlayFromWindow()
</code></pre>
<h3 id='o-plat_13' class='heading'>O.Plat_13</h3>
<h4 id='code-doc-manual-requirement-notes-md-153-code-implemented-using-a-code-wkwebviewdelegate-code' class='heading'><code>../doc/manual/requirement-notes.md:153</code>:  Implemented using a <code>WKWebViewDelegate</code>.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Plat_13#1] Implemented using a `WKWebViewDelegate`.
</code></pre>
<h4 id='code-sources-erpapp-screens-settings-dataprivacytermsofusenavigationdelegate-swift-9-code-delegate-disables-unused-schemes' class='heading'><code>../Sources/eRpApp/Screens/Settings/DataPrivacyTermsOfUseNavigationDelegate.swift:9</code>:  Delegate disables unused schemes</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Plat_13#2] Delegate disables unused schemes
class DataPrivacyTermsOfUseNavigationDelegate: NSObject, WKNavigationDelegate {
</code></pre>
<h4 id='code-sources-erpapp-screens-settings-dataprivacy-dataprivacyview-swift-22-code-usage-of-the-delegate' class='heading'><code>../Sources/eRpApp/Screens/Settings/DataPrivacy/DataPrivacyView.swift:22</code>:  Usage of the delegate</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// swiftlint:disable:next weak_delegate
// [REQ:BSI-eRp-ePA:O.Plat_13#3] Usage of the delegate
let navigationDelegate = DataPrivacyTermsOfUseNavigationDelegate()
</code></pre>
<h4 id='code-sources-erpapp-screens-settings-foss-fossview-swift-21-code-usage-of-the-delegate' class='heading'><code>../Sources/eRpApp/Screens/Settings/FOSS/FOSSView.swift:21</code>:  Usage of the delegate</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// swiftlint:disable:next weak_delegate
// [REQ:BSI-eRp-ePA:O.Plat_13#4] Usage of the delegate
let navigationDelegate = DataPrivacyTermsOfUseNavigationDelegate()
</code></pre>
<h4 id='code-sources-erpapp-screens-settings-termsofuse-termsofuseview-swift-22-code-usage-of-the-delegate' class='heading'><code>../Sources/eRpApp/Screens/Settings/TermsOfUse/TermsOfUseView.swift:22</code>:  Usage of the delegate</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// swiftlint:disable:next weak_delegate
// [REQ:BSI-eRp-ePA:O.Plat_13#5] Usage of the delegate
let navigationDelegate = DataPrivacyTermsOfUseNavigationDelegate()
</code></pre>
<h3 id='o-plat_14' class='heading'>O.Plat_14</h3>
<h4 id='code-doc-manual-requirement-notes-md-154-code-ebviews-only-display-local-content-that-is-delivered-together-with-the-application-no-cookies-are-created' class='heading'><code>../doc/manual/requirement-notes.md:154</code>:  ebviews only display local content that is delivered together with the application. No cookies are created.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Plat_14#1] ebviews only display local content that is delivered together with the application. No cookies are created.
</code></pre>
<h3 id='o-plat_15' class='heading'>O.Plat_15</h3>
<h4 id='code-doc-manual-requirement-notes-md-155-code' class='heading'><code>../doc/manual/requirement-notes.md:155</code>:</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Plat_15#1]
</code></pre>
<h3 id='o-plat_16' class='heading'>O.Plat_16</h3>
<h4 id='code-doc-manual-requirement-notes-md-156-code' class='heading'><code>../doc/manual/requirement-notes.md:156</code>:</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Plat_16#1]
</code></pre>
<h3 id='o-purp_1' class='heading'>O.Purp_1</h3>
<h4 id='code-sources-erpapp-screens-onboarding-onboardinglegalinfoview-swift-141-code-display-as-part-of-the-onboarding' class='heading'><code>../Sources/eRpApp/Screens/Onboarding/OnboardingLegalInfoView.swift:141</code>:  Display as part of the onboarding</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Purp_1#1] Display as part of the onboarding
struct OnboardingPrivacyView: View {
</code></pre>
<h4 id='code-sources-erpapp-screens-settings-dataprivacy-dataprivacyview-swift-11-code-actual-view-driving-the-display-of-code-dataprivacy-html-code' class='heading'><code>../Sources/eRpApp/Screens/Settings/DataPrivacy/DataPrivacyView.swift:11</code>:  Actual View driving the display of <code>DataPrivacy.html</code></h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Purp_1#2] Actual View driving the display of `DataPrivacy.html`
// [REQ:BSI-eRp-ePA:O.Arch_8#3] Webview containint local html without javascript
struct DataPrivacyView: View {
</code></pre>
<h3 id='o-purp_2' class='heading'>O.Purp_2</h3>
<h4 id='code-sources-erpapp-screens-cameraview-erxtaskscannerview-swift-26-code-scanning-tasks-contains-purpose-related-data-input' class='heading'><code>../Sources/eRpApp/Screens/CameraView/ErxTaskScannerView.swift:26</code>:  Scanning tasks contains purpose related data input</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Purp_2#1,O.Data_6#3] Scanning tasks contains purpose related data input
// [REQ:BSI-eRp-ePA:O.Source_1#1] Scanning tasks starts with scanner callback
viewStore.send(.analyse(scanOutput: $0))
</code></pre>
<h4 id='code-sources-erpapp-screens-cardwall-can-cardwallcanview-swift-167-code-can-is-used-for-egk-connection' class='heading'><code>../Sources/eRpApp/Screens/CardWall/CAN/CardWallCANView.swift:167</code>:  CAN is used for eGK connection</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Purp_2#2,O.Data_6#2] CAN is used for eGK connection
CardWallCANInputView(
</code></pre>
<h4 id='code-sources-erpapp-screens-cardwall-pin-cardwallpinview-swift-30-code-pin-is-used-for-egk-connection' class='heading'><code>../Sources/eRpApp/Screens/CardWall/PIN/CardWallPINView.swift:30</code>:  PIN is used for eGK Connection</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Purp_2#3,O.Data_6#4] PIN is used for eGK Connection
PINView(store: store).padding()
</code></pre>
<h4 id='code-sources-erpapp-tracking-analyticsreducer-swift-16-code-user-interaction-analytics-trigger' class='heading'><code>../Sources/eRpApp/Tracking/AnalyticsReducer.swift:16</code>:  User interaction analytics trigger &hellip;</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Purp_2#4,O.Purp_4#1,O.Data_6#6] User interaction analytics trigger ...
struct AnalyticsReducer&lt;ContentReducer: ReducerProtocol&gt;: ReducerProtocol
</code></pre>
<h4 id='code-sources-erpapp-tracking-contentsquareanalyticsadapter-swift-99-code-records-data-only-if-user-opt-in-is-given' class='heading'><code>../Sources/eRpApp/Tracking/ContentSquareAnalyticsAdapter.swift:99</code>:  &hellip; records data only if user opt-in is given.</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Purp_2#5,O.Purp_4#2,O.Data_6#7] ... records data only if user opt-in is given.
if optIn {
</code></pre>
<h4 id='code-sources-erpapp-screens-pharmacy-redeem-pharmacycontactview-swift-10-code-contact-information-is-collected-when-needed-for-redeeming' class='heading'><code>../Sources/eRpApp/Screens/Pharmacy/Redeem/PharmacyContactView.swift:10</code>:  Contact information is collected when needed for redeeming</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Purp_2#6,O.Data_6#5] Contact information is collected when needed for redeeming
struct PharmacyContactView: View {
</code></pre>
<h3 id='o-purp_3' class='heading'>O.Purp_3</h3>
<h4 id='code-sources-erpapp-screens-onboarding-onboardinglegalinfoview-swift-103-code-terms-of-use-display-is-part-of-the-onboarding' class='heading'><code>../Sources/eRpApp/Screens/Onboarding/OnboardingLegalInfoView.swift:103</code>:  Terms of Use display is part of the onboarding</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Purp_3#1] Terms of Use display is part of the onboarding
struct OnboardingTermsOfUseView: View {
</code></pre>
<h4 id='code-sources-erpapp-screens-settings-termsofuse-termsofuseview-swift-11-code-actual-view-for-the-terms-of-use-display' class='heading'><code>../Sources/eRpApp/Screens/Settings/TermsOfUse/TermsOfUseView.swift:11</code>:  Actual view for the Terms of Use display</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Purp_3#2] Actual view for the Terms of Use display
// [REQ:BSI-eRp-ePA:O.Arch_8#1] Webview containint local html without javascript
struct TermsOfUseView: View {
</code></pre>
<h4 id='code-sources-erpapp-screens-onboarding-onboardinglegalinfoview-swift-41-code-user-acceptance' class='heading'><code>../Sources/eRpApp/Screens/Onboarding/OnboardingLegalInfoView.swift:41</code>:  User acceptance</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Purp_3#3] User acceptance
OnboardingLegalInfoCheckmarkView(isAccepted: $isAllAccepted)
</code></pre>
<h4 id='code-sources-erpapp-screens-onboarding-onboardingcontainer-swift-69-code-callback-triggers-tracking-alert' class='heading'><code>../Sources/eRpApp/Screens/Onboarding/OnboardingContainer.swift:69</code>:  Callback triggers tracking alert</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Purp_3#4] Callback triggers tracking alert
viewStore.send(.showTrackingAlert)
</code></pre>
<h4 id='code-sources-erpapp-screens-onboarding-onboardingdomain-swift-182-code-show-comply-route-to-display-analytics-usage-within-onboarding' class='heading'><code>../Sources/eRpApp/Screens/Onboarding/OnboardingDomain.swift:182</code>:  Show comply route to display analytics usage within onboarding</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_eRp_FdV:A_19088,A_19091#1,A_19092] Show comply route to display analytics usage within
// onboarding
// [REQ:BSI-eRp-ePA:O.Purp_3#5] Show comply route to display analytics usage within onboarding
case .showTrackingAlert:
</code></pre>
<h4 id='code-sources-erpapp-screens-onboarding-onboardingdomain-swift-186-code-accept-usage-analytics' class='heading'><code>../Sources/eRpApp/Screens/Onboarding/OnboardingDomain.swift:186</code>:  Accept usage analytics</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_eRp_FdV:A_19090,A_19091#2] User confirms the opt in within settings
// [REQ:BSI-eRp-ePA:O.Purp_3#6] Accept usage analytics
case .allowTracking:
</code></pre>
<h4 id='code-sources-erpapp-screens-onboarding-onboardingdomain-swift-191-code-deny-usage-analytics' class='heading'><code>../Sources/eRpApp/Screens/Onboarding/OnboardingDomain.swift:191</code>:  Deny usage analytics</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_eRp_FdV:A_19092] User may choose to not accept analytics
// [REQ:BSI-eRp-ePA:O.Purp_3#7] Deny usage analytics
case .dismissAlert:
</code></pre>
<h3 id='o-purp_4' class='heading'>O.Purp_4</h3>
<h4 id='code-sources-erpapp-tracking-analyticsreducer-swift-16-code-user-interaction-analytics-trigger' class='heading'><code>../Sources/eRpApp/Tracking/AnalyticsReducer.swift:16</code>:  User interaction analytics trigger &hellip;</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Purp_2#4,O.Purp_4#1,O.Data_6#6] User interaction analytics trigger ...
struct AnalyticsReducer&lt;ContentReducer: ReducerProtocol&gt;: ReducerProtocol
</code></pre>
<h4 id='code-sources-erpapp-tracking-contentsquareanalyticsadapter-swift-99-code-records-data-only-if-user-opt-in-is-given' class='heading'><code>../Sources/eRpApp/Tracking/ContentSquareAnalyticsAdapter.swift:99</code>:  &hellip; records data only if user opt-in is given.</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Purp_2#5,O.Purp_4#2,O.Data_6#7] ... records data only if user opt-in is given.
if optIn {
</code></pre>
<h3 id='o-purp_5' class='heading'>O.Purp_5</h3>
<h4 id='code-sources-erpapp-screens-settings-settingsview-swift-249-code-toggle-within-settings-to-enable-and-disable-usage-tracking' class='heading'><code>../Sources/eRpApp/Screens/Settings/SettingsView.swift:249</code>:  Toggle within Settings to enable and disable usage tracking</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_eRp_FdV:A_19097] Toggle within Settings to enable and disable usage tracking
// [REQ:BSI-eRp-ePA:O.Purp_5#1] Toggle within Settings to enable and disable usage tracking
// [REQ:BSI-eRp-ePA:O.Purp_6#1] Current Analytics state is inspectable by the user
Toggle(isOn: viewStore.binding(
</code></pre>
<h4 id='code-sources-erpapp-screens-settings-settingsdomain-swift-196-code-actual-disabling-of-analytics' class='heading'><code>../Sources/eRpApp/Screens/Settings/SettingsDomain.swift:196</code>:  Actual disabling of analytics</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// Tracking
// [REQ:gemSpec_eRp_FdV:A_19088, A_19089, A_19092, A_19097] OptIn for usage tracking
// [REQ:BSI-eRp-ePA:O.Purp_5#2] Actual disabling of analytics
case let .toggleTrackingTapped(optIn):
</code></pre>
<h4 id='code-sources-erpapp-screens-settings-settingsview-swift-64-code-show-comply-view-for-settings-triggered-analytics-enabling' class='heading'><code>../Sources/eRpApp/Screens/Settings/SettingsView.swift:64</code>:  Show comply view for settings triggered analytics enabling</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// Tracking comply sheet presentation
// [REQ:BSI-eRp-ePA:O.Purp_5#3] Show comply view for settings triggered analytics enabling
Rectangle()
</code></pre>
<h4 id='code-sources-erpapp-screens-settings-settingsdomain-swift-207-code-user-confirms-the-opt-in-within-settings' class='heading'><code>../Sources/eRpApp/Screens/Settings/SettingsDomain.swift:207</code>:  User confirms the opt in within settings</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_eRp_FdV:A_19090,A_19091#4] User confirms the opt in within settings
// [REQ:BSI-eRp-ePA:O.Purp_5#4] User confirms the opt in within settings
case .confirmedOptInTracking:
</code></pre>
<h3 id='o-purp_6' class='heading'>O.Purp_6</h3>
<h4 id='code-sources-erpapp-screens-settings-settingsview-swift-250-code-current-analytics-state-is-inspectable-by-the-user' class='heading'><code>../Sources/eRpApp/Screens/Settings/SettingsView.swift:250</code>:  Current Analytics state is inspectable by the user</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_eRp_FdV:A_19097] Toggle within Settings to enable and disable usage tracking
// [REQ:BSI-eRp-ePA:O.Purp_5#1] Toggle within Settings to enable and disable usage tracking
// [REQ:BSI-eRp-ePA:O.Purp_6#1] Current Analytics state is inspectable by the user
Toggle(isOn: viewStore.binding(
</code></pre>
<h4 id='code-doc-manual-requirement-notes-md-30-code-as-most-of-the-user-deciscions-are-client-side-no-history-is-available-only-the-current-state-can-be-inspected' class='heading'><code>../doc/manual/requirement-notes.md:30</code>:  As most of the user deciscions are client side no history is available. Only the current state can be inspected.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Purp_6#2] As most of the user deciscions are client side no history is available. Only the current state can be inspected.
</code></pre>
<h3 id='o-purp_7' class='heading'>O.Purp_7</h3>
<h4 id='code-doc-manual-requirement-notes-md-31-code-most-libraries-are-self-written-and-cover-only-what-is-needed-dependencies-are-only-included-if-really-necessary-we-think-aboug-including-only-sub-packages-but-as-most-dependencies-are-very-small-this-is-hardly-used-besides-that-no-means-of-removing-unused-dependency-functionality-is-available-for-the-platform' class='heading'><code>../doc/manual/requirement-notes.md:31</code>:  Most libraries are self written and cover only what is needed. Dependencies are only included if really necessary. We think aboug including only sub packages, but as most dependencies are very small, this is hardly used. Besides that, no means of removing unused dependency functionality is available for the platform.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Purp_7] Most libraries are self written and cover only what is needed. Dependencies are only included if really necessary. We think aboug including only sub packages, but as most dependencies are very small, this is hardly used. Besides that, no means of removing unused dependency functionality is available for the platform.
</code></pre>
<h3 id='o-purp_8' class='heading'>O.Purp_8</h3>
<h4 id='code-sources-erpapp-session-keychainstorage-swift-23-code-implementation-of-data-storage-that-is' class='heading'><code>../Sources/eRpApp/Session/KeychainStorage.swift:23</code>:  Implementation of data storage that is</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_eRp_FdV:A_19186]
// [REQ:gemSpec_eRp_FdV:A_19188] Deletion of data saved here is managed by the OS.
// [REQ:gemSpec_IDP_Frontend:A_21322] Storage implementation uses iOS Keychain
// [REQ:gemF_Tokenverschlüsselung:A_21322] Storage implementation uses iOS Keychain
// [REQ:gemSpec_IDP_Frontend:A_21595] Storage Implementation
// [REQ:BSI-eRp-ePA:O.Purp_8#1,O.Arch_2#4,O.Arch_4#3,O.Source_7#2,O.Data_2#2] Implementation of data storage that is
// persisted via keychain
class KeychainStorage: SecureUserDataStore, IDPStorage, SecureEGKCertificateStorage {
</code></pre>
<h4 id='code-sources-erplocalstorage-coredatacontrollerfactory-swift-32-code-coredata-databases-are-protected' class='heading'><code>../Sources/eRpLocalStorage/CoreDataControllerFactory.swift:32</code>:  CoreData databases are protected</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Purp_8#2,O.Arch_2#1] CoreData databases are protected
self.fileProtection = fileProtection
</code></pre>
<h4 id='code-sources-erplocalstorage-coredatacontroller-swift-60-code-actual-protection-setting-on-file-system-level' class='heading'><code>../Sources/eRpLocalStorage/CoreDataController.swift:60</code>:  actual protection setting on file system level</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Purp_8#3,O.Arch_2#2] actual protection setting on file system level
protectedStoreDescription.setOption(
</code></pre>
<h4 id='code-sources-erplocalstorage-coredatacontroller-swift-84-code-database-backup-exclusion' class='heading'><code>../Sources/eRpLocalStorage/CoreDataController.swift:84</code>:  Database backup exclusion</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Purp_8#4,O.Arch_2#3,O.Arch_4#2] Database backup exclusion
if excludeFromBackup, let storeUrl = store.url {
</code></pre>
<h3 id='o-purp_9' class='heading'>O.Purp_9</h3>
<h4 id='code-sources-erpapp-screens-settings-idptokenview-idptokenview-swift-12-code-access-and-sso-token-display' class='heading'><code>../Sources/eRpApp/Screens/Settings/IDPTokenView/IDPTokenView.swift:12</code>:  Access and SSO Token display</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_BSI_FdV:O.Tokn_9] actual view that presents the token
// [REQ:BSI-eRp-ePA:O.Purp_9#1] Access and SSO Token display
// [REQ:BSI-eRp-ePA:O.Tokn_5#3] Access and SSO Token display
struct IDPTokenView: View {
</code></pre>
<h3 id='o-rand_1' class='heading'>O.Rand_1</h3>
<h4 id='code-doc-manual-requirement-notes-md-68-code-we-use-the-platform-provided-secure-random-genrator-see-a-href-https-support-apple-com-en-gb-guide-security-seca0c73a75b-web-apple-support-website-a-for-details' class='heading'><code>../doc/manual/requirement-notes.md:68</code>:  We use the platform provided secure random genrator. See <a href="https://support.apple.com/en-gb/guide/security/seca0c73a75b/web">Apple Support Website</a> for details.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Rand_1#1,O.Rand_2#1,O.Rand_3#1,O.Rand_4#1] We use the platform provided secure random genrator. See [Apple Support Website](https://support.apple.com/en-gb/guide/security/seca0c73a75b/web) for details.
</code></pre>
<h4 id='code-sources-idp-internal-seckeyrandom-swift-21-code-secure-random-generator' class='heading'><code>../Sources/IDP/internal/SecKeyRandom.swift:21</code>:  Secure Random generator.</h4>

<p>code</p>
<pre class="highlight plaintext"><code>/// Generate random Data with given length
///
/// [REQ:gemSpec_Krypt:GS-A_4367]
/// [REQ:BSI-eRp-ePA:O.Rand_1#2] Secure Random generator.
///
/// - Parameters:
///   - length: the number of bytes to generate
///   - randomizer: the randomizer to be used. Default: kSecRandomDefault
/// - Returns: the random initialized Data
/// - Throws: `IDPError`
public func generateSecureRandom(length: Int, randomizer: SecRandomRef? = kSecRandomDefault) throws -&gt; Data {
</code></pre>
<h4 id='code-sources-vau-internal-vaurandom-swift-22-code-secure-random-generator' class='heading'><code>../Sources/VAU/internal/VAURandom.swift:22</code>:  Secure Random generator.</h4>

<p>code</p>
<pre class="highlight plaintext"><code>/// Generate random Data with given length
///
/// [REQ:gemSpec_Krypt:GS-A_4367]
/// [REQ:BSI-eRp-ePA:O.Rand_1#3] Secure Random generator.
///
/// - Parameters:
///   - length: the number of bytes to generate
///   - randomizer: the randomizer to be used. Default: kSecRandomDefault
/// - Returns: the random initialized Data
/// - Throws: `VAUError`
static func generateSecureRandom(length: Int, randomizer: SecRandomRef? = kSecRandomDefault) throws -&gt; Data {
</code></pre>
<h3 id='o-rand_2' class='heading'>O.Rand_2</h3>
<h4 id='code-doc-manual-requirement-notes-md-68-code-we-use-the-platform-provided-secure-random-genrator-see-a-href-https-support-apple-com-en-gb-guide-security-seca0c73a75b-web-apple-support-website-a-for-details' class='heading'><code>../doc/manual/requirement-notes.md:68</code>:  We use the platform provided secure random genrator. See <a href="https://support.apple.com/en-gb/guide/security/seca0c73a75b/web">Apple Support Website</a> for details.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Rand_1#1,O.Rand_2#1,O.Rand_3#1,O.Rand_4#1] We use the platform provided secure random genrator. See [Apple Support Website](https://support.apple.com/en-gb/guide/security/seca0c73a75b/web) for details.
</code></pre>
<h3 id='o-rand_3' class='heading'>O.Rand_3</h3>
<h4 id='code-doc-manual-requirement-notes-md-68-code-we-use-the-platform-provided-secure-random-genrator-see-a-href-https-support-apple-com-en-gb-guide-security-seca0c73a75b-web-apple-support-website-a-for-details' class='heading'><code>../doc/manual/requirement-notes.md:68</code>:  We use the platform provided secure random genrator. See <a href="https://support.apple.com/en-gb/guide/security/seca0c73a75b/web">Apple Support Website</a> for details.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Rand_1#1,O.Rand_2#1,O.Rand_3#1,O.Rand_4#1] We use the platform provided secure random genrator. See [Apple Support Website](https://support.apple.com/en-gb/guide/security/seca0c73a75b/web) for details.
</code></pre>
<h3 id='o-rand_4' class='heading'>O.Rand_4</h3>
<h4 id='code-doc-manual-requirement-notes-md-68-code-we-use-the-platform-provided-secure-random-genrator-see-a-href-https-support-apple-com-en-gb-guide-security-seca0c73a75b-web-apple-support-website-a-for-details' class='heading'><code>../doc/manual/requirement-notes.md:68</code>:  We use the platform provided secure random genrator. See <a href="https://support.apple.com/en-gb/guide/security/seca0c73a75b/web">Apple Support Website</a> for details.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Rand_1#1,O.Rand_2#1,O.Rand_3#1,O.Rand_4#1] We use the platform provided secure random genrator. See [Apple Support Website](https://support.apple.com/en-gb/guide/security/seca0c73a75b/web) for details.
</code></pre>
<h3 id='o-resi_1' class='heading'>O.Resi_1</h3>
<h4 id='code-doc-manual-requirement-notes-md-158-code' class='heading'><code>../doc/manual/requirement-notes.md:158</code>:</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Resi_1#1]
</code></pre>
<h3 id='o-resi_2' class='heading'>O.Resi_2</h3>
<h4 id='code-doc-manual-requirement-notes-md-159-code-jailbreak-detection-is-done-on-startup-of-the-application-after-the-app-authentication-if-a-jailbreak-is-detected-a-information-dialog-is-presented-to-the-user' class='heading'><code>../doc/manual/requirement-notes.md:159</code>:  Jailbreak detection is done on startup of the application after the app authentication. If a jailbreak is detected, a information dialog is presented to the user.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Resi_2#1] Jailbreak detection is done on startup of the application after the app authentication. If a jailbreak is detected, a information dialog is presented to the user.
</code></pre>
<h4 id='code-sources-erpapp-screens-main-mainview-swift-97-code-triggger-device-security-check' class='heading'><code>../Sources/eRpApp/Screens/Main/MainView.swift:97</code>:  triggger device security check</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Arch_6#2,O.Resi_2#2,O.Plat_1#2] triggger device security check
viewStore.send(.loadDeviceSecurityView)
</code></pre>
<h4 id='code-sources-erpapp-session-helper-devicesecuritymanager-swift-58-code-calculate-system-risk-for-jailbreak-and-missing-device-pin' class='heading'><code>../Sources/eRpApp/Session/Helper/DeviceSecurityManager.swift:58</code>:  calculate system risk for jailbreak and missing device pin</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Arch_6#3,O.Resi_2#3,O.Plat_1#3] calculate system risk for jailbreak and missing device pin
var showSystemSecurityWarning: AnyPublisher&lt;DeviceSecurityWarningType, Never&gt; {
</code></pre>
<h4 id='code-sources-erpapp-session-helper-devicesecuritymanager-swift-114-code-jailbreak-detection' class='heading'><code>../Sources/eRpApp/Session/Helper/DeviceSecurityManager.swift:114</code>:  Jailbreak detection</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_BSI_FdV:A_20937] Jailbreak detection
// [REQ:BSI-eRp-ePA:O.Arch_6#4,O.Resi_2#4] Jailbreak detection
func informJailbreakDetected() -&gt; Bool {
</code></pre>
<h3 id='o-resi_3' class='heading'>O.Resi_3</h3>
<h4 id='code-doc-manual-requirement-notes-md-160-code' class='heading'><code>../doc/manual/requirement-notes.md:160</code>:</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Resi_3#1]
</code></pre>
<h3 id='o-resi_4' class='heading'>O.Resi_4</h3>
<h4 id='code-doc-manual-requirement-notes-md-161-code' class='heading'><code>../doc/manual/requirement-notes.md:161</code>:</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Resi_4#1]
</code></pre>
<h3 id='o-resi_5' class='heading'>O.Resi_5</h3>
<h4 id='code-doc-manual-requirement-notes-md-162-code' class='heading'><code>../doc/manual/requirement-notes.md:162</code>:</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Resi_5#1]
</code></pre>
<h3 id='o-resi_6' class='heading'>O.Resi_6</h3>
<h4 id='code-doc-manual-requirement-notes-md-163-code-idp-communication-is-secured-by-using-tls-with-pinned-certificates-as-well-as-jwes-with-keys-that-are-pinned-using-a-ti-specific-trust-anchor-as-well-as-ocsp-fd-communication-is-secured-by-using-tls-and-vau-encryption-again-with-pinned-certificates-for-both-methods-apovzd-communication-uses-tls-with-pinned-certificates-the-pinned-certificates-fingerprints-can-be-found-within-code-sources-erpapp-resources-info-plist-code' class='heading'><code>../doc/manual/requirement-notes.md:163</code>:  IDP Communication is secured by using TLS with pinned Certificates as well as JWEs with keys that are pinned using a TI specific trust anchor as well as OCSP. FD Communication is secured by using TLS and VAU encryption, again with pinned Certificates for both methods. APOVZD communication uses TLS with pinned certificates. The Pinned certificates fingerprints can be found within <code>Sources/eRpApp/Resources/Info.plist</code>.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Resi_6#1] IDP Communication is secured by using TLS with pinned Certificates as well as JWEs with keys that are pinned using a TI specific trust anchor as well as OCSP. FD Communication is secured by using TLS and VAU encryption, again with pinned Certificates for both methods. APOVZD communication uses TLS with pinned certificates. The Pinned certificates fingerprints can be found within `Sources/eRpApp/Resources/Info.plist`.
</code></pre>
<h4 id='code-sources-idp-defaultidpsession-swift-260-code-implementation-of-loading-the-discovery-document-for-fetching-signature-and' class='heading'><code>../Sources/IDP/DefaultIDPSession.swift:260</code>:  Implementation of loading the discovery document for fetching signature and</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Resi_6#2] Implementation of loading the discovery document for fetching signature and
// encryption keys.
private func loadDiscoveryDocument() -&gt; AnyPublisher&lt;DiscoveryDocument, IDPError&gt; {
</code></pre>
<h4 id='code-sources-idp-defaultidpsession-swift-418-code-discovery-document-signature-verification' class='heading'><code>../Sources/IDP/DefaultIDPSession.swift:418</code>:  Discovery Document signature verification</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Sek:A_22296] Signature verification
// [REQ:BSI-eRp-ePA:O.Resi_6#3] Discovery Document signature verification
guard try jwtContainer.verify(with: document.discKey) == true else {
</code></pre>
<h4 id='code-sources-idp-defaultidpsession-swift-287-code-discovery-document-signature-verification' class='heading'><code>../Sources/IDP/DefaultIDPSession.swift:287</code>:  Discovery Document signature verification</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// Validate JWT/DiscoveryDocument signature
// [REQ:gemSpec_Krypt:A_17207] Only implemented for brainpoolP256r1
// [REQ:gemSpec_Krypt:GS-A_4357-01,GS-A_4357-02] Assure that brainpoolP256r1 is used
// [REQ:BSI-eRp-ePA:O.Resi_6#4] Discovery Document signature verification
guard (try? fetchedDocument.backing.verify(with: fetchedDocument.discKey)) ?? false else {
</code></pre>
<h4 id='code-sources-idp-defaultidpsession-swift-748-code-discovery-document-signature-verification' class='heading'><code>../Sources/IDP/DefaultIDPSession.swift:748</code>:  Discovery Document signature verification</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Resi_6#5] Discovery Document signature verification
validate(certificate: discoveryDocument.discKey)
</code></pre>
<h3 id='o-resi_7' class='heading'>O.Resi_7</h3>
<h4 id='code-doc-manual-requirement-notes-md-164-code' class='heading'><code>../doc/manual/requirement-notes.md:164</code>:</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Resi_7#1]
</code></pre>
<h3 id='o-resi_8' class='heading'>O.Resi_8</h3>
<h4 id='code-doc-manual-requirement-notes-md-165-code-the-application-source-is-available-on-github-any-measure-of-preventing-reverse-engineering-would-be-pointless' class='heading'><code>../doc/manual/requirement-notes.md:165</code>:  The application source is available on github. Any measure of preventing reverse engineering would be pointless.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Resi_8#1] The application source is available on github. Any measure of preventing reverse engineering would be pointless.
</code></pre>
<h3 id='o-resi_9' class='heading'>O.Resi_9</h3>
<h4 id='code-doc-manual-requirement-notes-md-166-code-data-is-not-stored-while-moving-between-platforms-or-devices-private-keys-are-stored-within-the-secure-enclave-an-cannot-leave-the-device' class='heading'><code>../doc/manual/requirement-notes.md:166</code>:  Data is not stored while moving between platforms or devices. Private keys are stored within the secure enclave an cannot leave the device.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Resi_9#1] Data is not stored while moving between platforms or devices. Private keys are stored within the secure enclave an cannot leave the device.
</code></pre>
<h3 id='o-resi_10' class='heading'>O.Resi_10</h3>
<h4 id='code-doc-manual-requirement-notes-md-167-code-missing-internet-connection-or-other-means-of-disruption-use-the-same-error-mechanisms-as-every-part-of-the-app-uses-for-normal-errors' class='heading'><code>../doc/manual/requirement-notes.md:167</code>:  Missing internet connection or other means of disruption use the same error mechanisms as every part of the app uses for normal errors.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Resi_10#1] Missing internet connection or other means of disruption use the same error mechanisms as every part of the app uses for normal errors.
</code></pre>
<h3 id='o-sess_1' class='heading'>O.Sess_1</h3>
<h4 id='code-doc-manual-requirement-notes-md-97-code-tls-session-handling-is-done-via-nsurlsession-cookie-based-user-sessions-are-never-created-all-connections-are-ephemeral-remote-apis-are-stateless' class='heading'><code>../doc/manual/requirement-notes.md:97</code>:  TLS Session handling is done via NSURLSession. Cookie based user sessions are never created, all connections are ephemeral, remote APIs are stateless.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Sess_1#1] TLS Session handling is done via NSURLSession. Cookie based user sessions are never created, all connections are ephemeral, remote APIs are stateless.
</code></pre>
<h4 id='code-sources-httpclient-defaulthttpclient-swift-42-code-urlsession-is-used-as-network-framework' class='heading'><code>../Sources/HTTPClient/DefaultHTTPClient.swift:42</code>:  URLSession is used as Network Framework</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_Krypt:GS-A_4385,A_18467,A_18464,GS-A_4387]
// [REQ:gemSpec_Krypt:GS-A_5322] TODO: Check if limiting SSL Sessions is possible, check for renegotiation
// swiftlint:disable:previous todo
// [REQ:gemSpec_IDP_Frontend:A_20606] Live URLs not present in NSAppTransportSecurity exception list for allowed
// HTTP communication
// [REQ:gemSpec_eRp_FdV:A_20206]
// [REQ:BSI-eRp-ePA:O.Sess_1#2,O.Ntwk_2#2,O.Ntwk_3#2] URLSession is used as Network Framework

</code></pre>
<h3 id='o-sess_2' class='heading'>O.Sess_2</h3>
<h4 id='code-doc-manual-requirement-notes-md-98-code-not-applicable' class='heading'><code>../doc/manual/requirement-notes.md:98</code>:  not applicable</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Sess_2#1] not applicable
</code></pre>
<h3 id='o-sess_3' class='heading'>O.Sess_3</h3>
<h4 id='code-doc-manual-requirement-notes-md-99-code-not-applicable' class='heading'><code>../doc/manual/requirement-notes.md:99</code>:  not applicable</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Sess_3#1] not applicable
</code></pre>
<h3 id='o-sess_4' class='heading'>O.Sess_4</h3>
<h4 id='code-doc-manual-requirement-notes-md-100-code-not-applicable' class='heading'><code>../doc/manual/requirement-notes.md:100</code>:  not applicable</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Sess_4#1] not applicable
</code></pre>
<h3 id='o-sess_5' class='heading'>O.Sess_5</h3>
<h4 id='code-doc-manual-requirement-notes-md-101-code-not-applicable' class='heading'><code>../doc/manual/requirement-notes.md:101</code>:  not applicable</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Sess_5#1] not applicable
</code></pre>
<h3 id='o-sess_6' class='heading'>O.Sess_6</h3>
<h4 id='code-doc-manual-requirement-notes-md-102-code-not-applicable' class='heading'><code>../doc/manual/requirement-notes.md:102</code>:  not applicable</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Sess_6#1] not applicable
</code></pre>
<h3 id='o-sess_7' class='heading'>O.Sess_7</h3>
<h4 id='code-doc-manual-requirement-notes-md-103-code-not-applicable' class='heading'><code>../doc/manual/requirement-notes.md:103</code>:  not applicable</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Sess_7#1] not applicable
</code></pre>
<h3 id='o-source_1' class='heading'>O.Source_1</h3>
<h4 id='code-sources-erpapp-screens-cameraview-erxtaskscannerview-swift-27-code-scanning-tasks-starts-with-scanner-callback' class='heading'><code>../Sources/eRpApp/Screens/CameraView/ErxTaskScannerView.swift:27</code>:  Scanning tasks starts with scanner callback</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Purp_2#1,O.Data_6#3] Scanning tasks contains purpose related data input
// [REQ:BSI-eRp-ePA:O.Source_1#1] Scanning tasks starts with scanner callback
viewStore.send(.analyse(scanOutput: $0))
</code></pre>
<h4 id='code-sources-erpapp-screens-cameraview-scannerdomain-swift-134-code-analyse-the-unput' class='heading'><code>../Sources/eRpApp/Screens/CameraView/ScannerDomain.swift:134</code>:  analyse the unput</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Source_1#2] analyse the unput
let scannedTasks = try CodeAnalyser.analyse(scanOutput: scanOutput, with: state.acceptedTaskBatches)
</code></pre>
<h4 id='code-sources-erpapp-screens-cameraview-scannerdomain-helper-swift-11-code-validation' class='heading'><code>../Sources/eRpApp/Screens/CameraView/ScannerDomain+Helper.swift:11</code>:  validation</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Source_1#3] validation
static func analyse(scanOutput: [ScanOutput],
</code></pre>
<h4 id='code-sources-erpkit-scannederxtask-swift-104-code-actual-validation-by-decoding-into-predefined-structure' class='heading'><code>../Sources/eRpKit/ScannedErxTask.swift:104</code>:  actual validation by decoding into predefined structure</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_eRp_FdV:A_19984] validate data matrix code structure
// [REQ:BSI-eRp-ePA:O.Source_1#4] actual validation by decoding into predefined structure
erxToken = try jsonDecoder.decode(ErxToken.self, from: jsonData)
</code></pre>
<h4 id='code-sources-erpapp-scenedelegate-swift-178-code-external-application-calls-via-universal-linking' class='heading'><code>../Sources/eRpApp/SceneDelegate.swift:178</code>:  External application calls via Universal Linking</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Source_1#5] External application calls via Universal Linking
func scene(_: UIScene, continue userActivity: NSUserActivity) {
</code></pre>
<h4 id='code-sources-erpapp-screens-appstartdomain-swift-135-code-external-application-calls-via-universal-linking' class='heading'><code>../Sources/eRpApp/Screens/AppStartDomain.swift:135</code>:  External application calls via Universal Linking</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Source_1#6] External application calls via Universal Linking
case let .universalLink(url):
</code></pre>
<h4 id='code-sources-erpapp-screens-main-maindomain-swift-189-code-redirect-into-correct-domain' class='heading'><code>../Sources/eRpApp/Screens/Main/MainDomain.swift:189</code>:  redirect into correct domain</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Source_1#7] redirect into correct domain
return EffectTask(value: .extAuthPending(action: .externalLogin(url)))
</code></pre>
<h4 id='code-sources-erpapp-screens-main-extauth-extauthpendingdomain-swift-134-code-validate-data-by-parsing-url-and-only-allowing-predefined-variables-as-string' class='heading'><code>../Sources/eRpApp/Screens/Main/ExtAuth/ExtAuthPendingDomain.swift:134</code>:  Validate data by parsing url and only allowing predefined variables as String</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Source_1#8] Validate data by parsing url and only allowing predefined variables as String
case let .externalLogin(url):
</code></pre>
<h3 id='o-source_2' class='heading'>O.Source_2</h3>
<h4 id='code-doc-manual-requirement-notes-md-42-code-data-escaping-is-done-by-the-os-frameworks-we-never-generate-manual-sql-queries-coredata-is-used-as-an-orm-queries-are-build-with-nsfetchrequests-and-nspredicates-that-escape-all-manual-input' class='heading'><code>../doc/manual/requirement-notes.md:42</code>:  Data escaping is done by the OS Frameworks. We never generate manual SQL Queries, CoreData is used as an ORM, Queries are build with NSFetchRequests and NSPredicates that escape all manual input.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Source_2#1] Data escaping is done by the OS Frameworks. We never generate manual SQL Queries, CoreData is used as an ORM, Queries are build with NSFetchRequests and NSPredicates that escape all manual input.
</code></pre>
<h4 id='code-sources-erplocalstorage-pharmacy-pharmacycoredatastore-swift-13-code-coredatastore-adapter-for-code-pharmacylocation-code-s' class='heading'><code>../Sources/eRpLocalStorage/Pharmacy/PharmacyCoreDataStore.swift:13</code>:  CoreDataStore adapter for <code>PharmacyLocation</code>s</h4>

<p>code</p>
<pre class="highlight plaintext"><code>/// Store for fetching, creating, updating or deleting `PharmacyLocation`s on the provided `CoreDataController`
/// [REQ:BSI-eRp-ePA:O.Source_2#2] CoreDataStore adapter for `PharmacyLocation`s
public class PharmacyCoreDataStore: PharmacyLocalDataStore, CoreDataCrudable {
</code></pre>
<h4 id='code-sources-erplocalstorage-prescriptions-erxtaskcoredatastore-swift-18-code-coredatastore-adapter-for-code-erxtask-code-s' class='heading'><code>../Sources/eRpLocalStorage/Prescriptions/ErxTaskCoreDataStore.swift:18</code>:  CoreDataStore adapter for <code>ErxTask</code>s</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// tag::ErxTaskCoreDataStoreDescription[]
/// Store for fetching, creating, updating or deleting `ErxTask`s and it‘s underlying types. Access to most entities is
/// tied to the given profileId.
/// [REQ:BSI-eRp-ePA:O.Source_2#3] CoreDataStore adapter for `ErxTask`s
public class ErxTaskCoreDataStore: CoreDataCrudable, ErxLocalDataStore {
</code></pre>
<h4 id='code-sources-erplocalstorage-profiles-profilecoredatastore-swift-13-code-coredatastore-adapter-for-code-profile-code-s' class='heading'><code>../Sources/eRpLocalStorage/Profiles/ProfileCoreDataStore.swift:13</code>:  CoreDataStore adapter for <code>Profile</code>s</h4>

<p>code</p>
<pre class="highlight plaintext"><code>/// Store for fetching, creating, updating or deleting `Profile`s on the provided `CoreDataController`
/// [REQ:BSI-eRp-ePA:O.Source_2#4] CoreDataStore adapter for `Profile`s
public class ProfileCoreDataStore: ProfileDataStore, CoreDataCrudable {
</code></pre>
<h4 id='code-sources-erplocalstorage-shipmentinfo-shipmentinfocoredatastore-swift-13-code-coredatastore-adapter-for-code-shipmentinfoentity-code-s' class='heading'><code>../Sources/eRpLocalStorage/ShipmentInfo/ShipmentInfoCoreDataStore.swift:13</code>:  CoreDataStore adapter for <code>ShipmentInfoEntity</code>s</h4>

<p>code</p>
<pre class="highlight plaintext"><code>/// Store for fetching, creating, updating or deleting `ShipmentInfoEntity`s on the provided `CoreDataController`
/// [REQ:BSI-eRp-ePA:O.Source_2#5] CoreDataStore adapter for `ShipmentInfoEntity`s
public class ShipmentInfoCoreDataStore: ShipmentInfoDataStore, CoreDataCrudable {
</code></pre>
<h4 id='code-sources-erplocalstorage-avstransaction-avstransactioncoredatastore-swift-13-code-coredatastore-adapter-for-code-avstransactionentity-code-s' class='heading'><code>../Sources/eRpLocalStorage/AVSTransaction/AVSTransactionCoreDataStore.swift:13</code>:  CoreDataStore adapter for <code>AVSTransactionEntity</code>s</h4>

<p>code</p>
<pre class="highlight plaintext"><code>/// Store for fetching, creating, updating or deleting `AVSTransactionEntity`s on the provided `CoreDataController`
/// [REQ:BSI-eRp-ePA:O.Source_2#6] CoreDataStore adapter for `AVSTransactionEntity`s
public class AVSTransactionCoreDataStore: AVSTransactionDataStore, CoreDataCrudable {
</code></pre>
<h3 id='o-source_3' class='heading'>O.Source_3</h3>
<h4 id='code-doc-manual-requirement-notes-md-43-code-error-messages-are-localized-using-the-code-foundation-localizederror-code-protocoll-search-for-code-localizederror-code-to-see-all-instances-most-errors-are-localized-with-static-text-some-errors-contain-server-side-error-messages-userdata-is-never-used-for-error-messages-logging-is-only-active-on-debug-builds' class='heading'><code>../doc/manual/requirement-notes.md:43</code>:  Error messages are localized using the <code>Foundation.LocalizedError</code> protocoll. Search for <code>LocalizedError</code> to see all instances. Most errors are localized with static text, some errors contain server side error messages. Userdata is never used for error messages. Logging is only active on debug builds.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Source_3#1] Error messages are localized using the `Foundation.LocalizedError` protocoll. Search for `LocalizedError` to see all instances. Most errors are localized with static text, some errors contain server side error messages. Userdata is never used for error messages. Logging is only active on debug builds.
</code></pre>
<h3 id='o-source_4' class='heading'>O.Source_4</h3>
<h4 id='code-doc-manual-requirement-notes-md-44-code-exception-handling-in-swift-uses-errors-to-represent-the-exception-we-use-a-custom-protocol-code-codederror-code-that-is-autogenerated-for-all-error-messages-together-with-code-localizederror-code-we-create-error-messages-that-contain-a-user-readable-description-as-well-as-some-technical-identifiers-to-easily-identify-specific-error-scenarios-and-give-better-support-see-code-codederror-swift-code-and-code-codederror-generated-swift-code-for-the-protocol-and-the-autogenerated-implementations-of-it' class='heading'><code>../doc/manual/requirement-notes.md:44</code>:  Exception handling in swift uses Errors to represent the exception. We use a custom protocol <code>CodedError</code> that is autogenerated for all error messages. Together with <code>LocalizedError</code> we create error messages that contain a user readable description as well as some technical identifiers to easily identify specific error scenarios and give better support. See <code>CodedError.swift</code> and <code>CodedError.generated.swift</code> for the protocol and the autogenerated implementations of it.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Source_4#1] Exception handling in swift uses Errors to represent the exception. We use a custom protocol `CodedError` that is autogenerated for all error messages. Together with `LocalizedError` we create error messages that contain a user readable description as well as some technical identifiers to easily identify specific error scenarios and give better support. See `CodedError.swift` and `CodedError.generated.swift` for the protocol and the autogenerated implementations of it.
</code></pre>
<h3 id='o-source_5' class='heading'>O.Source_5</h3>
<h4 id='code-doc-manual-requirement-notes-md-45-code-as-excpetions-and-errors-are-kind-of-the-same-construct-in-swift-this-aspect-is-hard-to-answer-if-a-server-responds-with-401-403-we-delete-tokens-or-other-security-measuers-because-they-are-no-longer-vaild-anyways-while-logging-in-via-biometrics-we-create-temporary-data-containers-for-the-user-certificate-and-key-identifier-that-are-deleted-if-the-process-is-not-completed-properly-and-kept-if-the-process-complets' class='heading'><code>../doc/manual/requirement-notes.md:45</code>:  As excpetions and errors are kind of the same construct in swift, this aspect is hard to answer. If a server responds with 401/403 we delete tokens or other security measuers, because they are no longer vaild anyways. While logging in via biometrics we create temporary data containers for the user certificate and key identifier, that are deleted if the process is not completed properly and kept if the process complets.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Source_5#1] As excpetions and errors are kind of the same construct in swift, this aspect is hard to answer. If a server responds with 401/403 we delete tokens or other security measuers, because they are no longer vaild anyways. While logging in via biometrics we create temporary data containers for the user certificate and key identifier, that are deleted if the process is not completed properly and kept if the process complets.
</code></pre>
<h4 id='code-sources-idp-idpinterceptor-swift-72-code-invalidate-delete-unauthorized-token' class='heading'><code>../Sources/IDP/IDPInterceptor.swift:72</code>:  invalidate/delete unauthorized token</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_eRp_FdV:A_20167] invalidate/delete unauthorized token
// [REQ:BSI-eRp-ePA:O.Source_5#2] invalidate/delete unauthorized token
self.session.invalidateAccessToken()
</code></pre>
<h4 id='code-sources-idp-defaultidpsession-swift-106-code-invalidation-means-deleting-the-token' class='heading'><code>../Sources/IDP/DefaultIDPSession.swift:106</code>:  invalidation means deleting the token</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Source_5#3] invalidation means deleting the token
storage.set(token: nil)
</code></pre>
<h4 id='code-sources-erpapp-screens-cardwall-readcard-cardwallreadcarddomain-environment-biometrics-swift-112-code-creation-of-the-pairing-session' class='heading'><code>../Sources/eRpApp/Screens/CardWall/ReadCard/CardWallReadCardDomain.Environment+Biometrics.swift:112</code>:  Creation of the pairing session</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Source_5#4] Creation of the pairing session
pairingSession = try signatureProvider.createPairingSession()
</code></pre>
<h4 id='code-sources-erpapp-screens-cardwall-readcard-cardwallreadcarddomain-environment-biometrics-swift-208-code-failure-will-delete-paring-data' class='heading'><code>../Sources/eRpApp/Screens/CardWall/ReadCard/CardWallReadCardDomain.Environment+Biometrics.swift:208</code>:  Failure will delete paring data</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_21598,A_21595] Failure will delete paring data
// [REQ:BSI-eRp-ePA:O.Source_5#5] Failure will delete paring data
_ = try? signatureProvider.abort(pairingSession: pairingSession)
</code></pre>
<h3 id='o-source_6' class='heading'>O.Source_6</h3>
<h4 id='code-doc-manual-requirement-notes-md-46-code-swift-uses-automatic-reference-counting-that-does-not-require-active-memory-management-raw-memory-access-is-possible-but-only-used-for-swift-openssl-dependency-that-wrappes-the-c-library' class='heading'><code>../doc/manual/requirement-notes.md:46</code>:  Swift uses Automatic Reference Counting that does not require active memory management. Raw memory access is possible but only used for swift-OpenSSL dependency that wrappes the c library.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Source_6#1] Swift uses Automatic Reference Counting that does not require active memory management. Raw memory access is possible but only used for swift-OpenSSL dependency that wrappes the c library.
</code></pre>
<h3 id='o-source_7' class='heading'>O.Source_7</h3>
<h4 id='code-doc-manual-requirement-notes-md-47-code-alle-sensitive-data-is-handled-via-reference-types-after-usage-the-swift-runtime-handles-deletion-of-the-in-memory-representation-secure-enclave-encryption-keys-can-never-leave-the-secure-enclave' class='heading'><code>../doc/manual/requirement-notes.md:47</code>:  Alle sensitive data is handled via reference types. After usage the swift runtime handles deletion of the in memory representation. Secure enclave encryption keys can never leave the secure enclave.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Source_7#1] Alle sensitive data is handled via reference types. After usage the swift runtime handles deletion of the in memory representation. Secure enclave encryption keys can never leave the secure enclave.
</code></pre>
<h4 id='code-sources-erpapp-session-keychainstorage-swift-23-code-implementation-of-data-storage-that-is' class='heading'><code>../Sources/eRpApp/Session/KeychainStorage.swift:23</code>:  Implementation of data storage that is</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_eRp_FdV:A_19186]
// [REQ:gemSpec_eRp_FdV:A_19188] Deletion of data saved here is managed by the OS.
// [REQ:gemSpec_IDP_Frontend:A_21322] Storage implementation uses iOS Keychain
// [REQ:gemF_Tokenverschlüsselung:A_21322] Storage implementation uses iOS Keychain
// [REQ:gemSpec_IDP_Frontend:A_21595] Storage Implementation
// [REQ:BSI-eRp-ePA:O.Purp_8#1,O.Arch_2#4,O.Arch_4#3,O.Source_7#2,O.Data_2#2] Implementation of data storage that is
// persisted via keychain
class KeychainStorage: SecureUserDataStore, IDPStorage, SecureEGKCertificateStorage {
</code></pre>
<h3 id='o-source_8' class='heading'>O.Source_8</h3>
<h4 id='code-doc-manual-requirement-notes-md-48-code-we-use-swift-macros-to-remove-development-code-configuration-of-server-environments-is-done-within-code-appconfiguration-swift-code-a-debug-menu-is-available-within-settings-rooted-within-code-settingsview-swift-code' class='heading'><code>../doc/manual/requirement-notes.md:48</code>:  We use swift macros to remove development code. Configuration of server Environments is done within <code>AppConfiguration.swift</code>. A debug menu is available within settings, rooted within <code>SettingsView.swift</code>.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Source_8#1] We use swift macros to remove development code. Configuration of server Environments is done within `AppConfiguration.swift`. A debug menu is available within settings, rooted within `SettingsView.swift`.
</code></pre>
<h4 id='code-sources-erpapp-screens-settings-settingsview-swift-36-code-debug-menu-is-only-visible-on-debug-builds' class='heading'><code>../Sources/eRpApp/Screens/Settings/SettingsView.swift:36</code>:  Debug menu is only visible on debug builds</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Source_8#3] Debug menu is only visible on debug builds
#if ENABLE_DEBUG_VIEW
</code></pre>
<h4 id='code-sources-erpapp-screens-settings-settingsview-swift-280-code-debugsectionview-is-only-available-on-debug-builds' class='heading'><code>../Sources/eRpApp/Screens/Settings/SettingsView.swift:280</code>:  DebugSectionView is only available on debug builds</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Source_8#4] DebugSectionView is only available on debug builds
private struct DebugSectionView: View {
</code></pre>
<h4 id='code-sources-erpapp-screens-debugview-debugview-swift-12-code-debugview-is-only-available-on-debug-builds' class='heading'><code>../Sources/eRpApp/Screens/DebugView/DebugView.swift:12</code>:  DebugView is only available on debug builds</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Source_8#5] DebugView is only available on debug builds
struct DebugView: View {
</code></pre>
<h3 id='o-source_9' class='heading'>O.Source_9</h3>
<h4 id='code-doc-manual-requirement-notes-md-49-code-we-use-swift-macros-to-remove-debug-mechanism-code-a-debug-menu-is-available-within-settings-rooted-within-code-settingsview-swift-code-all-debug-classes-are-excluded-from-release-builds-by-using-swift-macros-to-remove-the-whole-classes-structs' class='heading'><code>../doc/manual/requirement-notes.md:49</code>:  We use swift macros to remove debug mechanism code. A debug menu is available within settings, rooted within <code>SettingsView.swift</code>. All debug classes are excluded from release builds by using swift macros to remove the whole classes/structs.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Source_9#1] We use swift macros to remove debug mechanism code. A debug menu is available within settings, rooted within `SettingsView.swift`. All debug classes are excluded from release builds by using swift macros to remove the whole classes/structs.
</code></pre>
<h3 id='o-source_10' class='heading'>O.Source_10</h3>
<h4 id='code-doc-manual-requirement-notes-md-50-code-we-use-common-defaults-for-all-compiler-security-related-settings-see-xcode-build-configuration-for-erpapp-target-using-current-xcode-for-actual-settings' class='heading'><code>../doc/manual/requirement-notes.md:50</code>:  We use common defaults for all compiler security related settings. See xcode build configuration for eRpApp Target using current Xcode for actual settings.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Source_10#1] We use common defaults for all compiler security related settings. See xcode build configuration for eRpApp Target using current Xcode for actual settings.
</code></pre>
<h3 id='o-source_11' class='heading'>O.Source_11</h3>
<h4 id='code-doc-manual-requirement-notes-md-51-code-we-do-not-create-any-kind-of-logs-for-release-builds' class='heading'><code>../doc/manual/requirement-notes.md:51</code>:  We do not create any kind of logs for release builds.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Source_11#1] We do not create any kind of logs for release builds.
</code></pre>
<h3 id='o-tokn_1' class='heading'>O.Tokn_1</h3>
<h4 id='code-doc-manual-requirement-notes-md-105-code-the-token-is-stored-within-the-keychain-for-long-lasting-tokens-short-living-tokens-as-used-in-biometric-pairing-process-are-not-persisted-and-only-live-in-the-memory' class='heading'><code>../doc/manual/requirement-notes.md:105</code>:  The token is stored within the keychain for long lasting tokens, short living tokens as used in biometric pairing process are not persisted and only live in the memory.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Tokn_1#1] The token is stored within the keychain for long lasting tokens, short living tokens as used in biometric pairing process are not persisted and only live in the memory.
</code></pre>
<h4 id='code-sources-idp-idpstorage-swift-37-code-protocol-defintion-for-token-storage' class='heading'><code>../Sources/IDP/IDPStorage.swift:37</code>:  protocol defintion for token storage</h4>

<p>code</p>
<pre class="highlight plaintext"><code>/// Set and save the IDPToken
/// [REQ:BSI-eRp-ePA:O.Tokn_1#2] protocol defintion for token storage
func set(token: IDPToken?)
</code></pre>
<h4 id='code-sources-erpapp-session-memorystorage-swift-41-code-memorystorage-implementation' class='heading'><code>../Sources/eRpApp/Session/MemoryStorage.swift:41</code>:  MemoryStorage implementation</h4>

<p>code</p>
<pre class="highlight plaintext"><code>/// [REQ:BSI-eRp-ePA:O.Tokn_1#3] MemoryStorage implementation
func set(token: IDPToken?) {
</code></pre>
<h4 id='code-sources-erpapp-session-keychainstorage-swift-125-code-keychainstorage-implementation' class='heading'><code>../Sources/eRpApp/Session/KeychainStorage.swift:125</code>:  KeychainStorage implementation</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_eRp_FdV:A_20184]
// [REQ:BSI-eRp-ePA:O.Tokn_1#4] KeychainStorage implementation
let success: Bool
</code></pre>
<h4 id='code-sources-idp-defaultidpsession-swift-234-code-storing-the-token-from-a-successfull-login' class='heading'><code>../Sources/IDP/DefaultIDPSession.swift:234</code>:  Storing the token from a successfull login</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Tokn_1#5] Storing the token from a successfull login
self?.storage.set(token: token)
</code></pre>
<h3 id='o-tokn_2' class='heading'>O.Tokn_2</h3>
<h4 id='code-doc-manual-requirement-notes-md-106-code-the-token-is-created-by-the-backend-we-have-no-means-of-manipulating-the-content' class='heading'><code>../doc/manual/requirement-notes.md:106</code>:  The token is created by the backend, we have no means of manipulating the content.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Tokn_2#1,O.Tokn_3#1] The token is created by the backend, we have no means of manipulating the content.
</code></pre>
<h3 id='o-tokn_3' class='heading'>O.Tokn_3</h3>
<h4 id='code-doc-manual-requirement-notes-md-106-code-the-token-is-created-by-the-backend-we-have-no-means-of-manipulating-the-content' class='heading'><code>../doc/manual/requirement-notes.md:106</code>:  The token is created by the backend, we have no means of manipulating the content.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Tokn_2#1,O.Tokn_3#1] The token is created by the backend, we have no means of manipulating the content.
</code></pre>
<h3 id='o-tokn_4' class='heading'>O.Tokn_4</h3>
<h4 id='code-doc-manual-requirement-notes-md-107-code-the-token-is-created-by-the-idp-and-signed-there-we-have-not-valid-signing-identity-within-the-application-to-sign-the-token' class='heading'><code>../doc/manual/requirement-notes.md:107</code>:  The token is created by the IDP and signed there. We have not valid signing identity within the application to sign the token.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Tokn_4#1] The token is created by the IDP and signed there. We have not valid signing identity within the application to sign the token.
</code></pre>
<h3 id='o-tokn_5' class='heading'>O.Tokn_5</h3>
<h4 id='code-doc-manual-requirement-notes-md-108-code-a-section-within-user-profiles-contains-all-tokens-for-that-profile-on-the-device' class='heading'><code>../doc/manual/requirement-notes.md:108</code>:  A Section within User Profiles contains all tokens for that profile on the device</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Tokn_5#1] A Section within User Profiles contains all tokens for that profile on the device
</code></pre>
<h4 id='code-sources-erpapp-screens-settings-profiles-edit-editprofileview-swift-434-code-section-for-token-display' class='heading'><code>../Sources/eRpApp/Screens/Settings/Profiles/Edit/EditProfileView.swift:434</code>:  Section for Token display</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Tokn_5#2] Section for Token display
private struct TokenSectionView: View {
</code></pre>
<h4 id='code-sources-erpapp-screens-settings-idptokenview-idptokenview-swift-13-code-access-and-sso-token-display' class='heading'><code>../Sources/eRpApp/Screens/Settings/IDPTokenView/IDPTokenView.swift:13</code>:  Access and SSO Token display</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_BSI_FdV:O.Tokn_9] actual view that presents the token
// [REQ:BSI-eRp-ePA:O.Purp_9#1] Access and SSO Token display
// [REQ:BSI-eRp-ePA:O.Tokn_5#3] Access and SSO Token display
struct IDPTokenView: View {
</code></pre>
<h3 id='o-tokn_6' class='heading'>O.Tokn_6</h3>
<h4 id='code-doc-manual-requirement-notes-md-109-code-a-logout-button-is-available-within-each-user-profile' class='heading'><code>../doc/manual/requirement-notes.md:109</code>:  A logout button is available within each user profile.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.Tokn_6#1] A logout button is available within each user profile.
</code></pre>
<h4 id='code-sources-erpapp-screens-settings-profiles-edit-editprofileview-swift-217-code-logout-button' class='heading'><code>../Sources/eRpApp/Screens/Settings/Profiles/Edit/EditProfileView.swift:217</code>:  Logout Button</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:BSI-eRp-ePA:O.Tokn_6#2] Logout Button
Button(action: {
</code></pre>
<h4 id='code-sources-erpapp-screens-settings-profiles-edit-editprofiledomain-swift-278-code-call-the-token-removal-upon-manual-logout' class='heading'><code>../Sources/eRpApp/Screens/Settings/Profiles/Edit/EditProfileDomain.swift:278</code>:  Call the token removal upon manual logout</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_20499-01#1] Call the SSO_TOKEN removal upon manual logout
// [REQ:BSI-eRp-ePA:O.Tokn_6#3] Call the token removal upon manual logout
return profileSecureDataWiper.wipeSecureData(of: state.profileId).fireAndForget()
</code></pre>
<h3 id='o-trdp_1' class='heading'>O.TrdP_1</h3>
<h4 id='code-doc-manual-requirement-notes-md-52-code-a-list-of-all-active-used-dependencys-can-be-found-within-code-dependencies-yml-code-the-list-contains-dependencies-from-carthage-and-swiftpm' class='heading'><code>../doc/manual/requirement-notes.md:52</code>:  A list of all active used dependencys can be found within <code>dependencies.yml</code>. The list contains dependencies from Carthage and SwiftPM.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.TrdP_1#1] A list of all active used dependencys can be found within `dependencies.yml`. The list contains dependencies from Carthage and SwiftPM.
</code></pre>
<h3 id='o-trdp_2' class='heading'>O.TrdP_2</h3>
<h4 id='code-doc-manual-requirement-notes-md-53-code-sast-scans-are-also-including-external-libraries' class='heading'><code>../doc/manual/requirement-notes.md:53</code>:  SAST Scans are also including external libraries.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.TrdP_2#1] SAST Scans are also including external libraries.
</code></pre>
<h3 id='o-trdp_3' class='heading'>O.TrdP_3</h3>
<h4 id='code-doc-manual-requirement-notes-md-54-code-external-document' class='heading'><code>../doc/manual/requirement-notes.md:54</code>:  External document</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.TrdP_3#1] External document
</code></pre>
<h3 id='o-trdp_4' class='heading'>O.TrdP_4</h3>
<h4 id='code-doc-manual-requirement-notes-md-55-code-we-have-few-dependencies-with-clear-scopes-we-activly-follow-developments-within-these-libraries-using-github-and-blogs' class='heading'><code>../doc/manual/requirement-notes.md:55</code>:  We have few dependencies with clear scopes. We activly follow developments within these libraries using github and blogs.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.TrdP_4#1] We have few dependencies with clear scopes. We activly follow developments within these libraries using github and blogs.
</code></pre>
<h3 id='o-trdp_5' class='heading'>O.TrdP_5</h3>
<h4 id='code-doc-manual-requirement-notes-md-56-code-we-do-not-share-sensitive-data-with-third-parties-se-data-usages-within-code-purp_8-code-and-code-o-arch_2-code' class='heading'><code>../doc/manual/requirement-notes.md:56</code>:  We do not share sensitive data with third parties. Se data usages within <code>Purp_8</code> and <code>O.Arch_2</code>.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.TrdP_5#1] We do not share sensitive data with third parties. Se data usages within `Purp_8` and `O.Arch_2`.
</code></pre>
<h3 id='o-trdp_6' class='heading'>O.TrdP_6</h3>
<h4 id='code-doc-manual-requirement-notes-md-57-code-see-code-o-source_1-code-and-code-o-arch_6-code' class='heading'><code>../doc/manual/requirement-notes.md:57</code>:  See <code>O.Source_1</code> and <code>O.Arch_6</code>.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.TrdP_6#1] See `O.Source_1` and `O.Arch_6`.
</code></pre>
<h3 id='o-trdp_7' class='heading'>O.TrdP_7</h3>
<h4 id='code-doc-manual-requirement-notes-md-58-code-as-most-libraries-are-source-code-dependencies-these-scans-are-part-of-sast-scanning-libraries-that-are-not-source-code-dependencies-are-the-precompiled-openssl-and-openhealthcardkit-own-library-but-different-repository-all-third-party-libraries-are-mirrored-into-internal-repositories-if-necessary-we-fork-libraries-to-apply-fixes' class='heading'><code>../doc/manual/requirement-notes.md:58</code>:  As most libraries are source code dependencies, these scans are part of SAST Scanning. Libraries that are not source code dependencies are the precompiled OpenSSL and OpenHealthCardKit (own library but different repository). All third party libraries are mirrored into internal repositories. If necessary we fork libraries to apply fixes.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:BSI-eRp-ePA:O.TrdP_7#1] As most libraries are source code dependencies, these scans are part of SAST Scanning. Libraries that are not source code dependencies are the precompiled OpenSSL and OpenHealthCardKit (own library but different repository). All third party libraries are mirrored into internal repositories. If necessary we fork libraries to apply fixes.
</code></pre>
<h2 id='gemf_biometrie' class='heading'>gemF_Biometrie</h2>
<h3 id='a_21415' class='heading'>A_21415</h3>
<h4 id='pairing_data-code-sources-idp-models-pairingdata-swift-12-code' class='heading'>Pairing_Data <code>../Sources/IDP/Models/PairingData.swift:12</code>:</h4>

<p>code</p>
<pre class="highlight plaintext"><code>/// Structure for registering a biometric key. See `SignedPairingData` for sigend representation.
/// [REQ:gemF_Biometrie:A_21415:Pairing_Data]
public struct PairingData: Claims, Codable {
</code></pre>
<h4 id='registration_data-code-sources-idp-models-registrationdata-swift-13-code' class='heading'>Registration_Data <code>../Sources/IDP/Models/RegistrationData.swift:13</code>:</h4>

<p>code</p>
<pre class="highlight plaintext"><code>/// Bundles data needed for creating and verifiying a pairing.
/// [REQ:gemF_Biometrie:A_21415:Registration_Data]
/// [REQ:gemSpec_IDP_Frontend:A_21416] Data Structure
public struct RegistrationData: Claims, Codable {
</code></pre>
<h4 id='device_information-code-sources-idp-models-registrationdata-swift-39-code' class='heading'>Device_Information <code>../Sources/IDP/Models/RegistrationData.swift:39</code>:</h4>

<p>code</p>
<pre class="highlight plaintext"><code>/// [REQ:gemF_Biometrie:A_21415:Device_Information]
public struct DeviceInformation: Codable {
</code></pre>
<h4 id='device_type-code-sources-idp-models-registrationdata-swift-56-code' class='heading'>Device_Type <code>../Sources/IDP/Models/RegistrationData.swift:56</code>:</h4>

<p>code</p>
<pre class="highlight plaintext"><code>/// [REQ:gemF_Biometrie:A_21415:Device_Type]
/// [REQ:gemSpec_IDP_Frontend:A_21591]
public struct DeviceType: Codable {
</code></pre>
<h4 id='encrypted_registration_data-code-sources-idp-models-registrationdata-swift-104-code-returns-jwe-encrypted-registration_data' class='heading'>Encrypted_Registration_Data <code>../Sources/IDP/Models/RegistrationData.swift:104</code>:  Returns JWE encrypted Registration_Data</h4>

<p>code</p>
<pre class="highlight plaintext"><code>/// [REQ:gemF_Biometrie:A_21415:Encrypted_Registration_Data] Returns JWE encrypted Registration_Data
/// [REQ:gemSpec_IDP_Frontend:A_21416] Encryption
func encrypted(with publicKey: BrainpoolP256r1.KeyExchange.PublicKey,
</code></pre>
<h4 id='signed_pairing_data-code-sources-idp-models-signedpairingdata-swift-12-code' class='heading'>Signed_Pairing_Data <code>../Sources/IDP/Models/SignedPairingData.swift:12</code>:</h4>

<p>code</p>
<pre class="highlight plaintext"><code>/// Signed (with eGK) version of `PairingData`.
/// [REQ:gemF_Biometrie:A_21415:Signed_Pairing_Data]
public struct SignedPairingData {
</code></pre>
<h3 id='a_21450' class='heading'>A_21450</h3>
<h4 id='pairing_entry-code-sources-idp-models-pairingentry-swift-12-code' class='heading'>Pairing_Entry <code>../Sources/IDP/Models/PairingEntry.swift:12</code>:</h4>

<p>code</p>
<pre class="highlight plaintext"><code>/// Represents stored data within the idp.
/// [REQ:gemF_Biometrie:A_21450:Pairing_Entry]
public struct PairingEntry: Equatable, Codable {
</code></pre>
<h2 id='gemf_tokenverschlüsselung' class='heading'>gemF_Tokenverschlüsselung</h2>
<h3 id='a_20526-01' class='heading'>A_20526-01</h3>
<h4 id='code-sources-idp-defaultidpsession-swift-152-code-encryption-with-jwe' class='heading'><code>../Sources/IDP/DefaultIDPSession.swift:152</code>:  Encryption with JWE</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemF_Tokenverschlüsselung:A_20526-01] Encryption with JWE
guard let jwe = try? signedChallenge.encrypt(with: document.encryptionPublicKey,
</code></pre>
<h4 id='code-sources-idp-models-idpchallengesession-swift-86-code-embed-certificate' class='heading'><code>../Sources/IDP/Models/IDPChallengeSession.swift:86</code>:  Embed certificate</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemF_Tokenverschlüsselung:A_20526-01] Embed certificate
let header = JWT.Header(alg: alg, x5c: certificates, typ: "JWT", cty: "NJWT")
</code></pre>
<h4 id='code-sources-idp-internal-realidpclient-swift-146-code-building-and-sending-the-request' class='heading'><code>../Sources/IDP/internal/RealIDPClient.swift:146</code>:  Building and sending the request</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemF_Tokenverschlüsselung:A_20526-01] Building and sending the request
var request = URLRequest(url: document.authentication.url, cachePolicy: .reloadIgnoringCacheData)
</code></pre>
<h4 id='code-sources-erpapp-screens-cardwall-readcard-cardwallreadcarddomain-environment-biometrics-swift-139-code-smartcard-signature' class='heading'><code>../Sources/eRpApp/Screens/CardWall/ReadCard/CardWallReadCardDomain.Environment+Biometrics.swift:139</code>:  Smartcard signature</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_20700-07] C.CH.AUT
// [REQ:gemF_Tokenverschlüsselung:A_20526-01] Smartcard signature
// [REQ:gemF_Tokenverschlüsselung:A_20700-05,A_20700-06] sign
.sign(challengeSession: challengeSession)
</code></pre>
<h4 id='code-sources-erpapp-screens-cardwall-readcard-nfcsignatureprovider-swift-426-code-smartcard-signature' class='heading'><code>../Sources/eRpApp/Screens/CardWall/ReadCard/NFCSignatureProvider.swift:426</code>:  Smartcard signature</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_20700-07] C.CH.AUT
// [REQ:gemF_Tokenverschlüsselung:A_20526-01] Smartcard signature
// [REQ:gemF_Tokenverschlüsselung:A_20700-06] sign
.readAutCertificate()
</code></pre>
<h3 id='a_20700-05' class='heading'>A_20700-05</h3>
<h4 id='code-sources-erpapp-screens-cardwall-readcard-cardwallreadcarddomain-environment-biometrics-swift-140-code-sign' class='heading'><code>../Sources/eRpApp/Screens/CardWall/ReadCard/CardWallReadCardDomain.Environment+Biometrics.swift:140</code>:  sign</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_20700-07] C.CH.AUT
// [REQ:gemF_Tokenverschlüsselung:A_20526-01] Smartcard signature
// [REQ:gemF_Tokenverschlüsselung:A_20700-05,A_20700-06] sign
.sign(challengeSession: challengeSession)
</code></pre>
<h3 id='a_20700-06' class='heading'>A_20700-06</h3>
<h4 id='code-sources-erpapp-screens-cardwall-readcard-cardwallreadcarddomain-environment-biometrics-swift-140-code-sign' class='heading'><code>../Sources/eRpApp/Screens/CardWall/ReadCard/CardWallReadCardDomain.Environment+Biometrics.swift:140</code>:  sign</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_20700-07] C.CH.AUT
// [REQ:gemF_Tokenverschlüsselung:A_20526-01] Smartcard signature
// [REQ:gemF_Tokenverschlüsselung:A_20700-05,A_20700-06] sign
.sign(challengeSession: challengeSession)
</code></pre>
<h4 id='code-sources-erpapp-screens-cardwall-readcard-nfcsignatureprovider-swift-320-code-sign' class='heading'><code>../Sources/eRpApp/Screens/CardWall/ReadCard/NFCSignatureProvider.swift:320</code>:  sign</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_20526-01] sign
// [REQ:gemF_Tokenverschlüsselung:A_20700-06] sign
func sign(can: String, pin: String, challenge: IDPChallengeSession)
</code></pre>
<h4 id='code-sources-erpapp-screens-cardwall-readcard-nfcsignatureprovider-swift-427-code-sign' class='heading'><code>../Sources/eRpApp/Screens/CardWall/ReadCard/NFCSignatureProvider.swift:427</code>:  sign</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_20700-07] C.CH.AUT
// [REQ:gemF_Tokenverschlüsselung:A_20526-01] Smartcard signature
// [REQ:gemF_Tokenverschlüsselung:A_20700-06] sign
.readAutCertificate()
</code></pre>
<h3 id='a_21322' class='heading'>A_21322</h3>
<h4 id='code-sources-erpapp-session-keychainstorage-swift-21-code-storage-implementation-uses-ios-keychain' class='heading'><code>../Sources/eRpApp/Session/KeychainStorage.swift:21</code>:  Storage implementation uses iOS Keychain</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_eRp_FdV:A_19186]
// [REQ:gemSpec_eRp_FdV:A_19188] Deletion of data saved here is managed by the OS.
// [REQ:gemSpec_IDP_Frontend:A_21322] Storage implementation uses iOS Keychain
// [REQ:gemF_Tokenverschlüsselung:A_21322] Storage implementation uses iOS Keychain
// [REQ:gemSpec_IDP_Frontend:A_21595] Storage Implementation
// [REQ:BSI-eRp-ePA:O.Purp_8#1,O.Arch_2#4,O.Arch_4#3,O.Source_7#2,O.Data_2#2] Implementation of data storage that is
// persisted via keychain
class KeychainStorage: SecureUserDataStore, IDPStorage, SecureEGKCertificateStorage {
</code></pre>
<h2 id='gemspec_bsi_fdv' class='heading'>gemSpec_BSI_FdV</h2>
<h3 id='a_20834' class='heading'>A_20834</h3>
<h4 id='code-sources-erpapp-scenedelegate-swift-165-code-mandatory-app-authentication' class='heading'><code>../Sources/eRpApp/SceneDelegate.swift:165</code>:  mandatory app authentication</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_BSI_FdV:A_20834] mandatory app authentication
rootView: AppAuthenticationView(store: appAuthenticationStore)
</code></pre>
<h4 id='code-sources-erpapp-screens-onboarding-onboardingcontainer-swift-41-code-view-to-register-authentication-in-onboarding-process' class='heading'><code>../Sources/eRpApp/Screens/Onboarding/OnboardingContainer.swift:41</code>:  view to register authentication in onboarding process</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_BSI_FdV:A_20834] view to register authentication in onboarding process
OnboardingAltRegisterAuthenticationView(
</code></pre>
<h4 id='code-sources-erpapp-screens-onboarding-onboardingcontainer-swift-59-code-view-to-register-authentication-in-onboarding-process' class='heading'><code>../Sources/eRpApp/Screens/Onboarding/OnboardingContainer.swift:59</code>:  view to register authentication in onboarding process</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_BSI_FdV:A_20834] view to register authentication in onboarding process
OnboardingRegisterAuthenticationView(
</code></pre>
<h3 id='a_20937' class='heading'>A_20937</h3>
<h4 id='code-sources-erpapp-session-helper-devicesecuritymanager-swift-113-code-jailbreak-detection' class='heading'><code>../Sources/eRpApp/Session/Helper/DeviceSecurityManager.swift:113</code>:  Jailbreak detection</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_BSI_FdV:A_20937] Jailbreak detection
// [REQ:BSI-eRp-ePA:O.Arch_6#4,O.Resi_2#4] Jailbreak detection
func informJailbreakDetected() -&gt; Bool {
</code></pre>
<h3 id='a_20938' class='heading'>A_20938</h3>
<h4 id='code-sources-erpapp-screens-main-devicesecurity-devicesecurityrooteddevice-devicesecurityrooteddeviceview-swift-8-code-jailbreak-information-view' class='heading'><code>../Sources/eRpApp/Screens/Main/DeviceSecurity/DeviceSecurityRootedDevice/DeviceSecurityRootedDeviceView.swift:8</code>:  Jailbreak information view</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_BSI_FdV:A_20938] Jailbreak information view
struct DeviceSecurityRootedDeviceView: View {
</code></pre>
<h3 id='o-tokn_9' class='heading'>O.Tokn_9</h3>
<h4 id='code-sources-erpapp-screens-settings-idptokenview-idptokenview-swift-11-code-actual-view-that-presents-the-token' class='heading'><code>../Sources/eRpApp/Screens/Settings/IDPTokenView/IDPTokenView.swift:11</code>:  actual view that presents the token</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_BSI_FdV:O.Tokn_9] actual view that presents the token
// [REQ:BSI-eRp-ePA:O.Purp_9#1] Access and SSO Token display
// [REQ:BSI-eRp-ePA:O.Tokn_5#3] Access and SSO Token display
struct IDPTokenView: View {
</code></pre>
<h4 id='code-sources-erpapp-screens-settings-profiles-edit-editprofiledomain-swift-193-code-observe-token-updates' class='heading'><code>../Sources/eRpApp/Screens/Settings/Profiles/Edit/EditProfileDomain.swift:193</code>:  observe token updates</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_BSI_FdV:O.Tokn_9] observe token updates
environment.subscribeToTokenUpdates(for: state.profileId)
</code></pre>
<h2 id='gemspec_fd_erp' class='heading'>gemSpec_FD_eRp</h2>
<h3 id='a_19145' class='heading'>A_19145</h3>
<h4 id='code-sources-erpapp-screens-main-prescriptionlist-model-prescription-swift-201-code-prevent-deletion-while-task-is-in-progress' class='heading'><code>../Sources/eRpApp/Screens/Main/PrescriptionList/Model/Prescription.swift:201</code>:  prevent deletion while task is in progress</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_FD_eRp:A_19145] prevent deletion while task is in progress
return erxTask.status != .inProgress
</code></pre>
<h3 id='a_21267' class='heading'>A_21267</h3>
<h4 id='code-sources-erpapp-screens-main-prescriptionlist-model-prescription-swift-29-code-direct-assignment' class='heading'><code>../Sources/eRpApp/Screens/Main/PrescriptionList/Model/Prescription.swift:29</code>:  direct assignment</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_FD_eRp:A_21267] direct assignment
var type: PrescriptionType = .regular
</code></pre>
<h3 id='a_21360' class='heading'>A_21360</h3>
<h4 id='code-sources-erpapp-screens-main-prescriptionlist-model-prescription-swift-165-code-no-redeem-informations-available-for-flowtype-169' class='heading'><code>../Sources/eRpApp/Screens/Main/PrescriptionList/Model/Prescription.swift:165</code>:  no redeem informations available for flowtype 169</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_FD_eRp:A_21360] no redeem informations available for flowtype 169
guard type != .directAssignment
</code></pre>
<h3 id='a_22102' class='heading'>A_22102</h3>
<h4 id='code-sources-erpapp-screens-main-prescriptionlist-model-prescription-swift-193-code-prevent-deletion-of-tasks-with-flowtype-169-while-not-completed' class='heading'><code>../Sources/eRpApp/Screens/Main/PrescriptionList/Model/Prescription.swift:193</code>:  prevent deletion of tasks with flowtype 169 while not completed</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_FD_eRp:A_22102] prevent deletion of tasks with flowtype 169 while not completed
guard type != .directAssignment
</code></pre>
<h2 id='gemspec_idp_frontend' class='heading'>gemSpec_IDP_Frontend</h2>
<h3 id='a_19908-01' class='heading'>A_19908-01</h3>
<h4 id='code-sources-idp-defaultidpsession-swift-625-code-signature-check' class='heading'><code>../Sources/IDP/DefaultIDPSession.swift:625</code>:  Signature check</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_Krypt:A_17207] Only implemented for brainpoolP256r1
// [REQ:gemSpec_IDP_Frontend:A_19908-01] Signature check
// [REQ:gemSpec_Krypt:GS-A_4357-01,GS-A_4357-02] Assure that brainpoolP256r1 is used
guard let verified = try? challenge.challenge.verify(with: document.authentication.cert),
</code></pre>
<h3 id='a_19937' class='heading'>A_19937</h3>
<h4 id='code-sources-idp-models-idperror-swift-85-code-error-formatting' class='heading'><code>../Sources/IDP/Models/IDPError.swift:85</code>:  Error formatting</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_19937,A_20605,A_20085] Error formatting
public var description: String {
</code></pre>
<h4 id='code-sources-idp-internal-realidpclient-swift-499-code-decoding-server-errors' class='heading'><code>../Sources/IDP/internal/RealIDPClient.swift:499</code>:  Decoding server errors</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_19937,A_20605] Decoding server errors
private static func responseError(for body: Data) -&gt; IDPError {
</code></pre>
<h4 id='code-sources-erpapp-common-errorlocalization-idperror-localization-swift-23-code-localized-description-of-server-errors' class='heading'><code>../Sources/eRpApp/Common/ErrorLocalization/IDPError+Localization.swift:23</code>:  Localized description of server errors</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_19937,A_20605,A_20085] Localized description of server errors
case let .internal(error: error): return error.localizedDescription
</code></pre>
<h3 id='a_19938-01' class='heading'>A_19938-01</h3>
<h4 id='code-sources-idp-defaultidpsession-swift-202-code-decrypt-fails-if-wrong-aes-key' class='heading'><code>../Sources/IDP/DefaultIDPSession.swift:202</code>:  Decrypt, fails if wrong aes key</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_19938-01,A_20283-01] Decrypt, fails if wrong aes key
guard let decrypted = try? token.decrypted(with: self.cryptoBox.aesKey) else {
</code></pre>
<h4 id='code-sources-idp-defaultidpsession-swift-225-code-usage' class='heading'><code>../Sources/IDP/DefaultIDPSession.swift:225</code>:  Usage</h4>

<p>code</p>
<pre class="highlight plaintext"><code>idToken: decrypted.idToken, // [REQ:gemSpec_IDP_Frontend:A_19938-01] Usage
ssoToken: exchange.sso,
</code></pre>
<h3 id='a_20068-01' class='heading'>A_20068-01</h3>
<h4 id='code-doc-manual-requirement-notes-md-25-code-implemented-with-ats-within-code-info-plist-code-path-code-nsapptransportsecurity-nspinneddomains-code' class='heading'><code>../doc/manual/requirement-notes.md:25</code>: : Implemented with ATS within <code>Info.plist</code>, path: <code>NSAppTransportSecurity.NSPinnedDomains</code></h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:gemSpec_IDP_Frontend:A_20608,A_20608-01,A_20609,A_20618,A_20068-01]: Implemented with ATS within `Info.plist`, path: `NSAppTransportSecurity.NSPinnedDomains`
</code></pre>
<h3 id='a_20079' class='heading'>A_20079</h3>
<h4 id='code-sources-idp-internal-realidpclient-swift-263-code-network-timeouts-will-traverse-the-queue-as-code-httperror-code-s' class='heading'><code>../Sources/IDP/internal/RealIDPClient.swift:263</code>:  Network timeouts will traverse the queue as <code>HTTPError</code>s.</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_20079] Network timeouts will traverse the queue as `HTTPError`s.
$0.asIDPError()
</code></pre>
<h3 id='a_20085' class='heading'>A_20085</h3>
<h4 id='code-sources-idp-models-idperror-swift-85-code-error-formatting' class='heading'><code>../Sources/IDP/Models/IDPError.swift:85</code>:  Error formatting</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_19937,A_20605,A_20085] Error formatting
public var description: String {
</code></pre>
<h4 id='code-sources-erpapp-common-errorlocalization-idperror-localization-swift-13-code-error-localization-is-not-done-yet-this-is-the-place-to-localize' class='heading'><code>../Sources/eRpApp/Common/ErrorLocalization/IDPError+Localization.swift:13</code>:  Error localization is not done yet, this is the place to localize</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_20085] Error localization is not done yet, this is the place to localize
// accordingly.
switch self {
</code></pre>
<h4 id='code-sources-erpapp-common-errorlocalization-idperror-localization-swift-23-code-localized-description-of-server-errors' class='heading'><code>../Sources/eRpApp/Common/ErrorLocalization/IDPError+Localization.swift:23</code>:  Localized description of server errors</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_19937,A_20605,A_20085] Localized description of server errors
case let .internal(error: error): return error.localizedDescription
</code></pre>
<h3 id='a_20283-01' class='heading'>A_20283-01</h3>
<h4 id='code-sources-idp-defaultidpsession-swift-202-code-decrypt-fails-if-wrong-aes-key' class='heading'><code>../Sources/IDP/DefaultIDPSession.swift:202</code>:  Decrypt, fails if wrong aes key</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_19938-01,A_20283-01] Decrypt, fails if wrong aes key
guard let decrypted = try? token.decrypted(with: self.cryptoBox.aesKey) else {
</code></pre>
<h4 id='code-sources-idp-defaultidpsession-swift-223-code-usage' class='heading'><code>../Sources/IDP/DefaultIDPSession.swift:223</code>:  Usage</h4>

<p>code</p>
<pre class="highlight plaintext"><code>accessToken: decrypted.accessToken, // [REQ:gemSpec_IDP_Frontend:A_20283-01] Usage
expires: self.time().addingTimeInterval(TimeInterval(token.expiresIn)),
</code></pre>
<h3 id='a_20309' class='heading'>A_20309</h3>
<h4 id='code-sources-idp-defaultidpsession-swift-603-code-generation-and-hashing-for-codechallenge' class='heading'><code>../Sources/IDP/DefaultIDPSession.swift:603</code>:  generation and hashing for codeChallenge</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// Generate a verifierCode
// [REQ:gemSpec_IDP_Frontend:A_20309] generation and hashing for codeChallenge
guard let verifierCode = try? self.cryptoBox.generateRandomVerifier(),
</code></pre>
<h4 id='code-sources-idp-internal-idpcrypto-swift-64-code-verifierlength-is-32-bytes-encoded-to-base64-this-results-in-43-chars' class='heading'><code>../Sources/IDP/internal/IDPCrypto.swift:64</code>:  verifierLength is 32 bytes, encoded to base64 this results in 43 chars</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_20309] verifierLength is 32 bytes, encoded to base64 this results in 43 chars
// (32 * 4 / 3 = 42,6)
try randomGenerator(verifierLength).encodeBase64urlsafe().utf8string
</code></pre>
<h3 id='a_20483' class='heading'>A_20483</h3>
<h4 id='code-sources-idp-defaultidpsession-swift-611-code' class='heading'><code>../Sources/IDP/DefaultIDPSession.swift:611</code>:</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_20483]
return self.client.requestChallenge(
</code></pre>
<h3 id='a_20499' class='heading'>A_20499</h3>
<h4 id='code-doc-manual-requirement-notes-md-17-code-not-applicable-as-authenticator-modul-is-within-fdv-not-3rd-party-app' class='heading'><code>../doc/manual/requirement-notes.md:17</code>:  Not applicable as authenticator modul is within FdV, not 3rd party app.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:gemSpec_IDP_Frontend:A_20499] Not applicable as authenticator modul is within FdV, not 3rd party app.
</code></pre>
<h4 id='code-sources-erpapp-session-keychainstorage-swift-247-code-deletion-of-sso_token-id_token-auth_token' class='heading'><code>../Sources/eRpApp/Session/KeychainStorage.swift:247</code>:  Deletion of SSO_TOKEN, ID_TOKEN, AUTH_TOKEN</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_20499,A_20499-1#3] Deletion of SSO_TOKEN, ID_TOKEN, AUTH_TOKEN
// [REQ:gemSpec_eRp_FdV:A_20186] Deletion of SSO_TOKEN, ID_TOKEN, AUTH_TOKEN
set(can: nil)
</code></pre>
<h4 id='code-sources-erpapp-session-profilesecuredatawiper-swift-38-code-deletion-of-sso_token-id_token-auth_token' class='heading'><code>../Sources/eRpApp/Session/ProfileSecureDataWiper.swift:38</code>:  Deletion of SSO_TOKEN, ID_TOKEN, AUTH_TOKEN</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_20499,A_20499-01#2] Deletion of SSO_TOKEN, ID_TOKEN, AUTH_TOKEN
// [REQ:gemSpec_eRp_FdV:A_20186] Deletion of SSO_TOKEN, ID_TOKEN, AUTH_TOKEN
// [REQ:gemSpec_IDP_Frontend:A_21603] Certificate
storage.wipe()
</code></pre>
<h3 id='a_20499-01' class='heading'>A_20499-01</h3>
<h4 id='code-sources-erpapp-screens-settings-profiles-edit-editprofiledomain-swift-277-code-call-the-sso_token-removal-upon-manual-logout' class='heading'><code>../Sources/eRpApp/Screens/Settings/Profiles/Edit/EditProfileDomain.swift:277</code>:  Call the SSO_TOKEN removal upon manual logout</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_20499-01#1] Call the SSO_TOKEN removal upon manual logout
// [REQ:BSI-eRp-ePA:O.Tokn_6#3] Call the token removal upon manual logout
return profileSecureDataWiper.wipeSecureData(of: state.profileId).fireAndForget()
</code></pre>
<h4 id='code-sources-erpapp-session-profilesecuredatawiper-swift-38-code-deletion-of-sso_token-id_token-auth_token' class='heading'><code>../Sources/eRpApp/Session/ProfileSecureDataWiper.swift:38</code>:  Deletion of SSO_TOKEN, ID_TOKEN, AUTH_TOKEN</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_20499,A_20499-01#2] Deletion of SSO_TOKEN, ID_TOKEN, AUTH_TOKEN
// [REQ:gemSpec_eRp_FdV:A_20186] Deletion of SSO_TOKEN, ID_TOKEN, AUTH_TOKEN
// [REQ:gemSpec_IDP_Frontend:A_21603] Certificate
storage.wipe()
</code></pre>
<h3 id='a_20499-1' class='heading'>A_20499-1</h3>
<h4 id='code-sources-erpapp-session-keychainstorage-swift-247-code-deletion-of-sso_token-id_token-auth_token' class='heading'><code>../Sources/eRpApp/Session/KeychainStorage.swift:247</code>:  Deletion of SSO_TOKEN, ID_TOKEN, AUTH_TOKEN</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_20499,A_20499-1#3] Deletion of SSO_TOKEN, ID_TOKEN, AUTH_TOKEN
// [REQ:gemSpec_eRp_FdV:A_20186] Deletion of SSO_TOKEN, ID_TOKEN, AUTH_TOKEN
set(can: nil)
</code></pre>
<h3 id='a_20512' class='heading'>A_20512</h3>
<h4 id='code-sources-idp-defaultidpsession-swift-276-code' class='heading'><code>../Sources/IDP/DefaultIDPSession.swift:276</code>:</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_20512]
self.storage.set(discovery: nil)
</code></pre>
<h4 id='code-sources-idp-models-discoverydocument-swift-166-code' class='heading'><code>../Sources/IDP/Models/DiscoveryDocument.swift:166</code>:</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_20512]
func isValid(on date: Date) -&gt; Bool {
</code></pre>
<h3 id='a_20525' class='heading'>A_20525</h3>
<h4 id='code-doc-manual-requirement-notes-md-15-code-not-applicable-as-authenticator-modul-is-within-fdv-not-3rd-party-app' class='heading'><code>../doc/manual/requirement-notes.md:15</code>:  Not applicable as authenticator modul is within FdV, not 3rd party app</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:gemSpec_IDP_Frontend:A_20525] Not applicable as authenticator modul is within FdV, not 3rd party app
</code></pre>
<h4 id='code-doc-manual-requirement-notes-md-18-code-not-applicable-as-authenticator-modul-is-within-fdv-consent-is-given-by-using-the-app' class='heading'><code>../doc/manual/requirement-notes.md:18</code>:  Not applicable as authenticator modul is within FdV. Consent is given by using the app.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:gemSpec_IDP_Frontend:A_20525] Not applicable as authenticator modul is within FdV. Consent is given by using the app.
</code></pre>
<h3 id='a_20526-01' class='heading'>A_20526-01</h3>
<h4 id='code-sources-erpapp-screens-cardwall-readcard-cardwallreadcarddomain-swift-378-code-sign-and-verify-with-idp' class='heading'><code>../Sources/eRpApp/Screens/CardWall/ReadCard/CardWallReadCardDomain.swift:378</code>:  sign and verify with idp</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_eRp_FdV:A_20172]
// [REQ:gemSpec_IDP_Frontend:A_20526-01] sign and verify with idp
func signChallengeWithNFCCard(can: String,
</code></pre>
<h4 id='code-sources-erpapp-screens-cardwall-readcard-cardwallreadcarddomain-swift-407-code-verify-with-idp' class='heading'><code>../Sources/eRpApp/Screens/CardWall/ReadCard/CardWallReadCardDomain.swift:407</code>:  verify with idp</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_eRp_FdV:A_20172]
// [REQ:gemSpec_IDP_Frontend:A_20526-01] verify with idp
private func verifyResultWithIDP(_ signedChallenge: SignedChallenge,
</code></pre>
<h4 id='code-sources-erpapp-screens-cardwall-readcard-nfcsignatureprovider-swift-319-code-sign' class='heading'><code>../Sources/eRpApp/Screens/CardWall/ReadCard/NFCSignatureProvider.swift:319</code>:  sign</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_20526-01] sign
// [REQ:gemF_Tokenverschlüsselung:A_20700-06] sign
func sign(can: String, pin: String, challenge: IDPChallengeSession)
</code></pre>
<h3 id='a_20527' class='heading'>A_20527</h3>
<h4 id='code-doc-manual-requirement-notes-md-16-code-not-directly-applicable-as-authenticator-modul-is-within-fdv-not-3rd-party-app-authorization_code-will-be-used-directly' class='heading'><code>../doc/manual/requirement-notes.md:16</code>:  Not directly applicable as authenticator modul is within FdV, not 3rd party app. AUTHORIZATION_CODE will be used directly.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:gemSpec_IDP_Frontend:A_20527] Not directly applicable as authenticator modul is within FdV, not 3rd party app. AUTHORIZATION_CODE will be used directly.
</code></pre>
<h4 id='code-sources-idp-defaultidpsession-swift-165-code-returning-the-authorization_code' class='heading'><code>../Sources/IDP/DefaultIDPSession.swift:165</code>:  Returning the AUTHORIZATION_CODE</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_20527] Returning the AUTHORIZATION_CODE
return Just(exchangeToken).setFailureType(to: IDPError.self).eraseToAnyPublisher()
</code></pre>
<h3 id='a_20529-01' class='heading'>A_20529-01</h3>
<h4 id='code-sources-idp-defaultidpsession-swift-183-code-encryption' class='heading'><code>../Sources/IDP/DefaultIDPSession.swift:183</code>:  Encryption</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_20529-01] Encryption
// [REQ:gemSpec_IDP_Frontend:A_21323] Crypto box contains `Token-Key`
guard let encryptedKeyVerifier = try? KeyVerifier(
</code></pre>
<h3 id='a_20600' class='heading'>A_20600</h3>
<h4 id='code-sources-idp-internal-realidpclient-swift-173-code' class='heading'><code>../Sources/IDP/internal/RealIDPClient.swift:173</code>:</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_20600]
return IDPExchangeToken(
</code></pre>
<h4 id='code-sources-idp-internal-realidpclient-swift-484-code' class='heading'><code>../Sources/IDP/internal/RealIDPClient.swift:484</code>:</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_20600]
return IDPExchangeToken(code: code,
</code></pre>
<h3 id='a_20601' class='heading'>A_20601</h3>
<h4 id='code-sources-idp-internal-realidpclient-swift-101-code-transfer' class='heading'><code>../Sources/IDP/internal/RealIDPClient.swift:101</code>:  Transfer</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_20603,A_20601,A_20601-01] Transfer
URLQueryItem(name: "client_id", value: clientConfig.clientId.urlPercentEscapedString()),
</code></pre>
<h3 id='a_20601-01' class='heading'>A_20601-01</h3>
<h4 id='code-sources-idp-internal-realidpclient-swift-101-code-transfer' class='heading'><code>../Sources/IDP/internal/RealIDPClient.swift:101</code>:  Transfer</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_20603,A_20601,A_20601-01] Transfer
URLQueryItem(name: "client_id", value: clientConfig.clientId.urlPercentEscapedString()),
</code></pre>
<h3 id='a_20602' class='heading'>A_20602</h3>
<h4 id='code-sources-idp-idpinterceptor-swift-56-code' class='heading'><code>../Sources/IDP/IDPInterceptor.swift:56</code>:</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_20602,A_21325#1]
request.setValue("\(token.tokenType) \(token.accessToken)", forHTTPHeaderField: "Authorization")
</code></pre>
<h3 id='a_20603' class='heading'>A_20603</h3>
<h4 id='code-sources-idp-internal-realidpclient-swift-101-code-transfer' class='heading'><code>../Sources/IDP/internal/RealIDPClient.swift:101</code>:  Transfer</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_20603,A_20601,A_20601-01] Transfer
URLQueryItem(name: "client_id", value: clientConfig.clientId.urlPercentEscapedString()),
</code></pre>
<h4 id='code-sources-idp-internal-realidpclient-swift-249-code-transfer' class='heading'><code>../Sources/IDP/internal/RealIDPClient.swift:249</code>:  transfer</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_20603] transfer
"client_id": clientConfig.clientId,
</code></pre>
<h4 id='code-sources-erpapp-appconfiguration-swift-15-code-actual-id' class='heading'><code>../Sources/eRpApp/AppConfiguration.swift:15</code>:  Actual ID</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_20603] Actual ID
private static let defaultClientId: String = "eRezeptApp"
</code></pre>
<h4 id='code-sources-erpapp-appconfiguration-swift-59-code-actual-id' class='heading'><code>../Sources/eRpApp/AppConfiguration.swift:59</code>:  Actual ID</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// clientId
// [REQ:gemSpec_IDP_Frontend:A_20603] Actual ID
let clientId: String = defaultClientId
</code></pre>
<h3 id='a_20605' class='heading'>A_20605</h3>
<h4 id='code-sources-idp-models-idperror-swift-85-code-error-formatting' class='heading'><code>../Sources/IDP/Models/IDPError.swift:85</code>:  Error formatting</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_19937,A_20605,A_20085] Error formatting
public var description: String {
</code></pre>
<h4 id='code-sources-idp-internal-realidpclient-swift-499-code-decoding-server-errors' class='heading'><code>../Sources/IDP/internal/RealIDPClient.swift:499</code>:  Decoding server errors</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_19937,A_20605] Decoding server errors
private static func responseError(for body: Data) -&gt; IDPError {
</code></pre>
<h4 id='code-sources-erpapp-common-errorlocalization-idperror-localization-swift-23-code-localized-description-of-server-errors' class='heading'><code>../Sources/eRpApp/Common/ErrorLocalization/IDPError+Localization.swift:23</code>:  Localized description of server errors</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_19937,A_20605,A_20085] Localized description of server errors
case let .internal(error: error): return error.localizedDescription
</code></pre>
<h3 id='a_20606' class='heading'>A_20606</h3>
<h4 id='code-sources-httpclient-defaulthttpclient-swift-39-code-live-urls-not-present-in-nsapptransportsecurity-exception-list-for-allowed' class='heading'><code>../Sources/HTTPClient/DefaultHTTPClient.swift:39</code>:  Live URLs not present in NSAppTransportSecurity exception list for allowed</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_Krypt:GS-A_4385,A_18467,A_18464,GS-A_4387]
// [REQ:gemSpec_Krypt:GS-A_5322] TODO: Check if limiting SSL Sessions is possible, check for renegotiation
// swiftlint:disable:previous todo
// [REQ:gemSpec_IDP_Frontend:A_20606] Live URLs not present in NSAppTransportSecurity exception list for allowed
// HTTP communication
// [REQ:gemSpec_eRp_FdV:A_20206]
// [REQ:BSI-eRp-ePA:O.Sess_1#2,O.Ntwk_2#2,O.Ntwk_3#2] URLSession is used as Network Framework

</code></pre>
<h3 id='a_20607' class='heading'>A_20607</h3>
<h4 id='code-doc-manual-requirement-notes-md-2-code-no-exceptions-set-in-nsapptransportsecurity-http-via-tls-is-enforced-os-will-use-system-root-certificates-in-combination-with-set-pinned-certificates-see-also-a-href-https-developer-apple-com-library-archive-documentation-general-reference-infoplistkeyreference-articles-cocoakeys-html-requirements-for-connecting-using-ats-a' class='heading'><code>../doc/manual/requirement-notes.md:2</code>:  no exceptions set in NSAppTransportSecurity, HTTP via TLS is enforced; OS will use system root certificates in combination with set pinned certificates. see also: <a href="https://developer.apple.com/library/archive/documentation/General/Reference/InfoPlistKeyReference/Articles/CocoaKeys.html">Requirements for Connecting Using ATS</a></h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:gemSpec_IDP_Frontend:A_20607,A_20609,A_20618] no exceptions set in NSAppTransportSecurity, HTTP via TLS is enforced; OS will use system root certificates in combination with set pinned certificates. see also: [Requirements for Connecting Using ATS](https://developer.apple.com/library/archive/documentation/General/Reference/InfoPlistKeyReference/Articles/CocoaKeys.html)
</code></pre>
<h3 id='a_20608' class='heading'>A_20608</h3>
<h4 id='code-doc-manual-requirement-notes-md-25-code-implemented-with-ats-within-code-info-plist-code-path-code-nsapptransportsecurity-nspinneddomains-code' class='heading'><code>../doc/manual/requirement-notes.md:25</code>: : Implemented with ATS within <code>Info.plist</code>, path: <code>NSAppTransportSecurity.NSPinnedDomains</code></h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:gemSpec_IDP_Frontend:A_20608,A_20608-01,A_20609,A_20618,A_20068-01]: Implemented with ATS within `Info.plist`, path: `NSAppTransportSecurity.NSPinnedDomains`
</code></pre>
<h3 id='a_20608-01' class='heading'>A_20608-01</h3>
<h4 id='code-doc-manual-requirement-notes-md-25-code-implemented-with-ats-within-code-info-plist-code-path-code-nsapptransportsecurity-nspinneddomains-code' class='heading'><code>../doc/manual/requirement-notes.md:25</code>: : Implemented with ATS within <code>Info.plist</code>, path: <code>NSAppTransportSecurity.NSPinnedDomains</code></h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:gemSpec_IDP_Frontend:A_20608,A_20608-01,A_20609,A_20618,A_20068-01]: Implemented with ATS within `Info.plist`, path: `NSAppTransportSecurity.NSPinnedDomains`
</code></pre>
<h3 id='a_20609' class='heading'>A_20609</h3>
<h4 id='code-doc-manual-requirement-notes-md-2-code-no-exceptions-set-in-nsapptransportsecurity-http-via-tls-is-enforced-os-will-use-system-root-certificates-in-combination-with-set-pinned-certificates-see-also-a-href-https-developer-apple-com-library-archive-documentation-general-reference-infoplistkeyreference-articles-cocoakeys-html-requirements-for-connecting-using-ats-a' class='heading'><code>../doc/manual/requirement-notes.md:2</code>:  no exceptions set in NSAppTransportSecurity, HTTP via TLS is enforced; OS will use system root certificates in combination with set pinned certificates. see also: <a href="https://developer.apple.com/library/archive/documentation/General/Reference/InfoPlistKeyReference/Articles/CocoaKeys.html">Requirements for Connecting Using ATS</a></h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:gemSpec_IDP_Frontend:A_20607,A_20609,A_20618] no exceptions set in NSAppTransportSecurity, HTTP via TLS is enforced; OS will use system root certificates in combination with set pinned certificates. see also: [Requirements for Connecting Using ATS](https://developer.apple.com/library/archive/documentation/General/Reference/InfoPlistKeyReference/Articles/CocoaKeys.html)
</code></pre>
<h4 id='code-doc-manual-requirement-notes-md-25-code-implemented-with-ats-within-code-info-plist-code-path-code-nsapptransportsecurity-nspinneddomains-code' class='heading'><code>../doc/manual/requirement-notes.md:25</code>: : Implemented with ATS within <code>Info.plist</code>, path: <code>NSAppTransportSecurity.NSPinnedDomains</code></h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:gemSpec_IDP_Frontend:A_20608,A_20608-01,A_20609,A_20618,A_20068-01]: Implemented with ATS within `Info.plist`, path: `NSAppTransportSecurity.NSPinnedDomains`
</code></pre>
<h3 id='a_20614' class='heading'>A_20614</h3>
<h4 id='code-sources-idp-defaultidpsession-swift-264-code' class='heading'><code>../Sources/IDP/DefaultIDPSession.swift:264</code>:</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_20617-01,A_20623,A_20614]
.validateOrNil(with: trustStoreSession, timeProvider: time)
</code></pre>
<h3 id='a_20617-01' class='heading'>A_20617-01</h3>
<h4 id='code-sources-idp-defaultidpsession-swift-264-code' class='heading'><code>../Sources/IDP/DefaultIDPSession.swift:264</code>:</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_20617-01,A_20623,A_20614]
.validateOrNil(with: trustStoreSession, timeProvider: time)
</code></pre>
<h4 id='code-sources-idp-defaultidpsession-swift-296-code' class='heading'><code>../Sources/IDP/DefaultIDPSession.swift:296</code>:</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_20617-01,A_20623]
.validate(with: self.trustStoreSession, timeProvider: self.time)
</code></pre>
<h4 id='code-sources-idp-defaultidpsession-swift-687-code' class='heading'><code>../Sources/IDP/DefaultIDPSession.swift:687</code>:</h4>

<p>code</p>
<pre class="highlight plaintext"><code>/// Returns a Publisher that validates the input streams discoveryDocument against the given trustStoreSession. If
/// the validity cannot be verified, the publisher fails with an `IDPError.trustStore` error.
///
/// [REQ:gemSpec_IDP_Frontend:A_20617-01]
/// [REQ:gemSpec_IDP_Frontend:A_20623]
///
/// - Parameter trustStoreSession: `TrustStoreSession` that is used to check the validity and trust of the
/// discoveryDocument.
/// - Returns: An AnyPublisher of `DiscoveryDocument`and `IDPError`
func validate(with trustStoreSession: TrustStoreSession,
</code></pre>
<h4 id='code-sources-idp-defaultidpsession-swift-719-code' class='heading'><code>../Sources/IDP/DefaultIDPSession.swift:719</code>:</h4>

<p>code</p>
<pre class="highlight plaintext"><code>/// Returns a Publisher that validates the input streams discoveryDocument and returns nil if validity cannot be
/// checked. All Errors are caught and result in an empty discoveryDocument.
///
/// [REQ:gemSpec_IDP_Frontend:A_20617-01,A_20623]
///
/// - Parameters:
///   - trustStoreSession: `TrustStoreSession` that is used to check the validity and trust of the disoveryDocument.
///   - time: Time provider to check the discovery document against.
/// - Returns: An AnyPublisher of `DiscoveryDocument`and `Never`.
func validateOrNil(with trustStoreSession: TrustStoreSession,
</code></pre>
<h3 id='a_20618' class='heading'>A_20618</h3>
<h4 id='code-doc-manual-requirement-notes-md-2-code-no-exceptions-set-in-nsapptransportsecurity-http-via-tls-is-enforced-os-will-use-system-root-certificates-in-combination-with-set-pinned-certificates-see-also-a-href-https-developer-apple-com-library-archive-documentation-general-reference-infoplistkeyreference-articles-cocoakeys-html-requirements-for-connecting-using-ats-a' class='heading'><code>../doc/manual/requirement-notes.md:2</code>:  no exceptions set in NSAppTransportSecurity, HTTP via TLS is enforced; OS will use system root certificates in combination with set pinned certificates. see also: <a href="https://developer.apple.com/library/archive/documentation/General/Reference/InfoPlistKeyReference/Articles/CocoaKeys.html">Requirements for Connecting Using ATS</a></h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:gemSpec_IDP_Frontend:A_20607,A_20609,A_20618] no exceptions set in NSAppTransportSecurity, HTTP via TLS is enforced; OS will use system root certificates in combination with set pinned certificates. see also: [Requirements for Connecting Using ATS](https://developer.apple.com/library/archive/documentation/General/Reference/InfoPlistKeyReference/Articles/CocoaKeys.html)
</code></pre>
<h4 id='code-doc-manual-requirement-notes-md-25-code-implemented-with-ats-within-code-info-plist-code-path-code-nsapptransportsecurity-nspinneddomains-code' class='heading'><code>../doc/manual/requirement-notes.md:25</code>: : Implemented with ATS within <code>Info.plist</code>, path: <code>NSAppTransportSecurity.NSPinnedDomains</code></h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:gemSpec_IDP_Frontend:A_20608,A_20608-01,A_20609,A_20618,A_20068-01]: Implemented with ATS within `Info.plist`, path: `NSAppTransportSecurity.NSPinnedDomains`
</code></pre>
<h3 id='a_20623' class='heading'>A_20623</h3>
<h4 id='code-sources-truststore-x509truststore-swift-193-code-idp-oid' class='heading'><code>../Sources/TrustStore/X509TrustStore.swift:193</code>:  IDP oid</h4>

<p>code</p>
<pre class="highlight plaintext"><code>case oidErpVau // 1.2.276.0.76.4.258 == 0x06082A8214004C048202
// [REQ:gemSpec_IDP_Frontend:A_20623] IDP oid
case oidIdpd // 1.2.276.0.76.4.260 == 0x06082A8214004C048204
}
</code></pre>
<h4 id='code-sources-idp-defaultidpsession-swift-296-code' class='heading'><code>../Sources/IDP/DefaultIDPSession.swift:296</code>:</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_20617-01,A_20623]
.validate(with: self.trustStoreSession, timeProvider: self.time)
</code></pre>
<h4 id='code-sources-idp-defaultidpsession-swift-688-code' class='heading'><code>../Sources/IDP/DefaultIDPSession.swift:688</code>:</h4>

<p>code</p>
<pre class="highlight plaintext"><code>/// Returns a Publisher that validates the input streams discoveryDocument against the given trustStoreSession. If
/// the validity cannot be verified, the publisher fails with an `IDPError.trustStore` error.
///
/// [REQ:gemSpec_IDP_Frontend:A_20617-01]
/// [REQ:gemSpec_IDP_Frontend:A_20623]
///
/// - Parameter trustStoreSession: `TrustStoreSession` that is used to check the validity and trust of the
/// discoveryDocument.
/// - Returns: An AnyPublisher of `DiscoveryDocument`and `IDPError`
func validate(with trustStoreSession: TrustStoreSession,
</code></pre>
<h4 id='code-sources-idp-defaultidpsession-swift-691-code-validation-call' class='heading'><code>../Sources/IDP/DefaultIDPSession.swift:691</code>:  Validation call</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_20623] Validation call
return trustStoreSession.validate(discoveryDocument: document)
</code></pre>
<h4 id='code-sources-idp-defaultidpsession-swift-719-code' class='heading'><code>../Sources/IDP/DefaultIDPSession.swift:719</code>:</h4>

<p>code</p>
<pre class="highlight plaintext"><code>/// Returns a Publisher that validates the input streams discoveryDocument and returns nil if validity cannot be
/// checked. All Errors are caught and result in an empty discoveryDocument.
///
/// [REQ:gemSpec_IDP_Frontend:A_20617-01,A_20623]
///
/// - Parameters:
///   - trustStoreSession: `TrustStoreSession` that is used to check the validity and trust of the disoveryDocument.
///   - time: Time provider to check the discovery document against.
/// - Returns: An AnyPublisher of `DiscoveryDocument`and `Never`.
func validateOrNil(with trustStoreSession: TrustStoreSession,
</code></pre>
<h4 id='code-sources-idp-defaultidpsession-swift-749-code-validation' class='heading'><code>../Sources/IDP/DefaultIDPSession.swift:749</code>:  Validation</h4>

<p>code</p>
<pre class="highlight plaintext"><code>/// Returns a publisher that checks a discoveryDocument against the trust store. The Stream contains an output
/// boolean for the plain check or an TrustStoreError in case the TrustStoreSession sub streams failed.
///
/// [REQ:gemSpec_IDP_Frontend:A_20623] Validation
///
/// - Parameter discoveryDocument: The DiscoveryDocument that needs to be checked.
/// - Returns: A publisher that contains an output with the check value or an failure if the check failed
/// due to an underlying error.
func validate(discoveryDocument: DiscoveryDocument) -&gt; AnyPublisher&lt;Bool, TrustStoreError&gt; {
</code></pre>
<h4 id='code-sources-truststore-x509truststore-swift-179-code-oid-check' class='heading'><code>../Sources/TrustStore/X509TrustStore.swift:179</code>:  oid check</h4>

<p>code</p>
<pre class="highlight plaintext"><code>} else if eeCert.contains(oidBytes: .oidIdpd) { // [REQ:gemSpec_IDP_Frontend:A_20623] oid check
return (vauCerts, idpCerts + [eeCert])
</code></pre>
<h4 id='code-sources-idp-defaultidpsession-swift-264-code' class='heading'><code>../Sources/IDP/DefaultIDPSession.swift:264</code>:</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_20617-01,A_20623,A_20614]
.validateOrNil(with: trustStoreSession, timeProvider: time)
</code></pre>
<h3 id='a_20625' class='heading'>A_20625</h3>
<h4 id='code-sources-idp-defaultidpsession-swift-209-code-validate-id_token-signature' class='heading'><code>../Sources/IDP/DefaultIDPSession.swift:209</code>:  Validate ID_TOKEN signature</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_20625] Validate ID_TOKEN signature
guard let jwt = try? JWT(from: decrypted.idToken),
</code></pre>
<h3 id='a_20700-05' class='heading'>A_20700-05</h3>
<h4 id='code-sources-erpapp-screens-cardwall-readcard-cardwallreadcarddomain-environment-biometrics-swift-25-code-sign-with-c-ch-aut' class='heading'><code>../Sources/eRpApp/Screens/CardWall/ReadCard/CardWallReadCardDomain.Environment+Biometrics.swift:25</code>:  sign with C.CH.AUT</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_20700-05,A_20700-07] sign with C.CH.AUT
return challengeSession.sign(
</code></pre>
<h4 id='code-sources-erpapp-screens-cardwall-readcard-nfcsignatureprovider-swift-435-code-sign-with-c-ch-aut' class='heading'><code>../Sources/eRpApp/Screens/CardWall/ReadCard/NFCSignatureProvider.swift:435</code>:  sign with C.CH.AUT</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_20700-05,A_20700-07] sign with C.CH.AUT
return session.sign(
</code></pre>
<h3 id='a_20700-07' class='heading'>A_20700-07</h3>
<h4 id='code-sources-idp-defaultsecureenclavesignatureprovider-swift-127-code-biometrics-only-other-modes-currently-not-supported' class='heading'><code>../Sources/IDP/DefaultSecureEnclaveSignatureProvider.swift:127</code>:  Biometrics only, other modes currently not supported</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_20700-07] Biometrics only, other modes currently not supported
amr: [
</code></pre>
<h4 id='code-sources-erpapp-screens-cardwall-readcard-cardwallreadcarddomain-environment-biometrics-swift-25-code-sign-with-c-ch-aut' class='heading'><code>../Sources/eRpApp/Screens/CardWall/ReadCard/CardWallReadCardDomain.Environment+Biometrics.swift:25</code>:  sign with C.CH.AUT</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_20700-05,A_20700-07] sign with C.CH.AUT
return challengeSession.sign(
</code></pre>
<h4 id='code-sources-erpapp-screens-cardwall-readcard-cardwallreadcarddomain-environment-biometrics-swift-138-code-c-ch-aut' class='heading'><code>../Sources/eRpApp/Screens/CardWall/ReadCard/CardWallReadCardDomain.Environment+Biometrics.swift:138</code>:  C.CH.AUT</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_20700-07] C.CH.AUT
// [REQ:gemF_Tokenverschlüsselung:A_20526-01] Smartcard signature
// [REQ:gemF_Tokenverschlüsselung:A_20700-05,A_20700-06] sign
.sign(challengeSession: challengeSession)
</code></pre>
<h4 id='code-sources-erpapp-screens-cardwall-readcard-nfcsignatureprovider-swift-425-code-c-ch-aut' class='heading'><code>../Sources/eRpApp/Screens/CardWall/ReadCard/NFCSignatureProvider.swift:425</code>:  C.CH.AUT</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_20700-07] C.CH.AUT
// [REQ:gemF_Tokenverschlüsselung:A_20526-01] Smartcard signature
// [REQ:gemF_Tokenverschlüsselung:A_20700-06] sign
.readAutCertificate()
</code></pre>
<h4 id='code-sources-erpapp-screens-cardwall-readcard-nfcsignatureprovider-swift-435-code-sign-with-c-ch-aut' class='heading'><code>../Sources/eRpApp/Screens/CardWall/ReadCard/NFCSignatureProvider.swift:435</code>:  sign with C.CH.AUT</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_20700-05,A_20700-07] sign with C.CH.AUT
return session.sign(
</code></pre>
<h4 id='code-sources-erpapp-screens-cardwall-readcard-nfcsignatureprovider-swift-466-code-perform-signature-with-openhealthcardkit' class='heading'><code>../Sources/eRpApp/Screens/CardWall/ReadCard/NFCSignatureProvider.swift:466</code>:  perform signature with OpenHealthCardKit</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_20700-07] perform signature with OpenHealthCardKit
card.sign(data: message)
</code></pre>
<h3 id='a_20740' class='heading'>A_20740</h3>
<h4 id='code-sources-idp-internal-realidpclient-swift-110-code-transfer' class='heading'><code>../Sources/IDP/internal/RealIDPClient.swift:110</code>:  transfer</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_20740] transfer
name: "redirect_uri",
</code></pre>
<h4 id='code-sources-idp-internal-realidpclient-swift-246-code-transfer' class='heading'><code>../Sources/IDP/internal/RealIDPClient.swift:246</code>:  transfer</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_20740] transfer
"redirect_uri": redirectURI ?? clientConfig.redirectURI.absoluteString,
</code></pre>
<h4 id='code-sources-erpapp-appconfiguration-swift-61-code-actual-redirect-uri' class='heading'><code>../Sources/eRpApp/AppConfiguration.swift:61</code>:  Actual redirect uri</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_20740] Actual redirect uri
let redirectUri = URL(string: "https://redirect.gematik.de/erezept")! // swiftlint:disable:this force_unwrapping
let extAuthRedirectUri = URL(
</code></pre>
<h3 id='a_20741' class='heading'>A_20741</h3>
<h4 id='code-doc-manual-requirement-notes-md-8-code-configuration-within-code-app-configuration-json-code-organisational-process-as-in-a_20603' class='heading'><code>../doc/manual/requirement-notes.md:8</code>:  Configuration within <code>app-configuration.json</code>, organisational process as in A_20603</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:gemSpec_IDP_Frontend:A_20741] Configuration within `app-configuration.json`, organisational process as in A_20603
</code></pre>
<h3 id='a_21322' class='heading'>A_21322</h3>
<h4 id='code-sources-erpapp-session-keychainstorage-swift-20-code-storage-implementation-uses-ios-keychain' class='heading'><code>../Sources/eRpApp/Session/KeychainStorage.swift:20</code>:  Storage implementation uses iOS Keychain</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_eRp_FdV:A_19186]
// [REQ:gemSpec_eRp_FdV:A_19188] Deletion of data saved here is managed by the OS.
// [REQ:gemSpec_IDP_Frontend:A_21322] Storage implementation uses iOS Keychain
// [REQ:gemF_Tokenverschlüsselung:A_21322] Storage implementation uses iOS Keychain
// [REQ:gemSpec_IDP_Frontend:A_21595] Storage Implementation
// [REQ:BSI-eRp-ePA:O.Purp_8#1,O.Arch_2#4,O.Arch_4#3,O.Source_7#2,O.Data_2#2] Implementation of data storage that is
// persisted via keychain
class KeychainStorage: SecureUserDataStore, IDPStorage, SecureEGKCertificateStorage {
</code></pre>
<h3 id='a_21323' class='heading'>A_21323</h3>
<h4 id='code-sources-idp-defaultidpsession-swift-184-code-crypto-box-contains-code-token-key-code' class='heading'><code>../Sources/IDP/DefaultIDPSession.swift:184</code>:  Crypto box contains <code>Token-Key</code></h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_20529-01] Encryption
// [REQ:gemSpec_IDP_Frontend:A_21323] Crypto box contains `Token-Key`
guard let encryptedKeyVerifier = try? KeyVerifier(
</code></pre>
<h3 id='a_21325' class='heading'>A_21325</h3>
<h4 id='code-sources-idp-idpinterceptor-swift-56-code' class='heading'><code>../Sources/IDP/IDPInterceptor.swift:56</code>:</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_20602,A_21325#1]
request.setValue("\(token.tokenType) \(token.accessToken)", forHTTPHeaderField: "Authorization")
</code></pre>
<h4 id='code-sources-erpapp-session-standardsessioncontainer-swift-321-code-interceptor-order-defines-what-is-encrypted-via-vau' class='heading'><code>../Sources/eRpApp/Session/StandardSessionContainer.swift:321</code>:  Interceptor order defines what is encrypted via VAU</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_21325#2] Interceptor order defines what is encrypted via VAU
let interceptors: [Interceptor] = [
</code></pre>
<h3 id='a_21414' class='heading'>A_21414</h3>
<h4 id='code-sources-idp-defaultidpsession-swift-320-code-encrypt-access_token-when-requesting-the-pairing-endpoint' class='heading'><code>../Sources/IDP/DefaultIDPSession.swift:320</code>:  Encrypt ACCESS_TOKEN when requesting the pairing endpoint</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_21414] Encrypt ACCESS_TOKEN when requesting the pairing endpoint
guard let tokenJWT = try? JWT(from: token.accessToken),
</code></pre>
<h3 id='a_21416' class='heading'>A_21416</h3>
<h4 id='code-sources-idp-defaultidpsession-swift-314-code-encryption' class='heading'><code>../Sources/IDP/DefaultIDPSession.swift:314</code>:  Encryption</h4>

<p>code</p>
<pre class="highlight plaintext"><code>/// [REQ:gemSpec_IDP_Frontend:A_21416] Encryption
guard let jwe = try? registrationData.encrypted(with: document.encryptionPublicKey,
</code></pre>
<h4 id='code-sources-idp-models-registrationdata-swift-14-code-data-structure' class='heading'><code>../Sources/IDP/Models/RegistrationData.swift:14</code>:  Data Structure</h4>

<p>code</p>
<pre class="highlight plaintext"><code>/// Bundles data needed for creating and verifiying a pairing.
/// [REQ:gemF_Biometrie:A_21415:Registration_Data]
/// [REQ:gemSpec_IDP_Frontend:A_21416] Data Structure
public struct RegistrationData: Claims, Codable {
</code></pre>
<h4 id='code-sources-idp-models-registrationdata-swift-105-code-encryption' class='heading'><code>../Sources/IDP/Models/RegistrationData.swift:105</code>:  Encryption</h4>

<p>code</p>
<pre class="highlight plaintext"><code>/// [REQ:gemF_Biometrie:A_21415:Encrypted_Registration_Data] Returns JWE encrypted Registration_Data
/// [REQ:gemSpec_IDP_Frontend:A_21416] Encryption
func encrypted(with publicKey: BrainpoolP256r1.KeyExchange.PublicKey,
</code></pre>
<h3 id='a_21431' class='heading'>A_21431</h3>
<h4 id='code-sources-idp-defaultidpsession-swift-394-code-encryption' class='heading'><code>../Sources/IDP/DefaultIDPSession.swift:394</code>:  Encryption</h4>

<p>code</p>
<pre class="highlight plaintext"><code>/// [REQ:gemSpec_IDP_Frontend:A_21431] Encryption
guard let jwe = try? signedChallenge.encrypted(with: document.encryptionPublicKey,
</code></pre>
<h4 id='code-sources-idp-models-signedauthenticationdata-swift-35-code-exp-header' class='heading'><code>../Sources/IDP/Models/SignedAuthenticationData.swift:35</code>:  exp header</h4>

<p>code</p>
<pre class="highlight plaintext"><code>/// [REQ:gemSpec_IDP_Frontend:A_21431] exp header
expiry: originalChallenge.challenge.exp,
</code></pre>
<h3 id='a_21443' class='heading'>A_21443</h3>
<h4 id='code-sources-idp-defaultidpsession-swift-345-code-encrypt-access_token-when-requesting-the-unregister-endpoint' class='heading'><code>../Sources/IDP/DefaultIDPSession.swift:345</code>:  Encrypt ACCESS_TOKEN when requesting the unregister endpoint</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_21443] Encrypt ACCESS_TOKEN when requesting the unregister endpoint
guard let tokenJWT = try? JWT(from: token.accessToken),
</code></pre>
<h4 id='code-sources-idp-defaultidpsession-swift-369-code-encrypt-access_token-when-requesting-the-list-endpoint' class='heading'><code>../Sources/IDP/DefaultIDPSession.swift:369</code>:  Encrypt ACCESS_TOKEN when requesting the list endpoint</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_21443] Encrypt ACCESS_TOKEN when requesting the list endpoint
guard let tokenJWT = try? JWT(from: token.accessToken),
</code></pre>
<h3 id='a_21574' class='heading'>A_21574</h3>
<h4 id='code-sources-erpapp-screens-cardwall-login-cardwallloginoptiondomain-swift-106-code-present-user-information' class='heading'><code>../Sources/eRpApp/Screens/CardWall/Login/CardWallLoginOptionDomain.swift:106</code>:  Present user information</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_21574] Present user information
return EffectTask(value: .presentSecurityWarning)
</code></pre>
<h4 id='code-sources-erpapp-screens-cardwall-login-cardwallloginoptionview-swift-123-code-actual-view' class='heading'><code>../Sources/eRpApp/Screens/CardWall/Login/CardWallLoginOptionView.swift:123</code>:  Actual view</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_21574] Actual view
struct PrivacyWarningViewContainer: View {
</code></pre>
<h3 id='a_21576' class='heading'>A_21576</h3>
<h4 id='code-sources-idp-defaultidpsession-swift-338-code-deletion-call' class='heading'><code>../Sources/IDP/DefaultIDPSession.swift:338</code>:  deletion call</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_21576] deletion call
public func unregisterDevice(_ keyIdentifier: String, token: IDPToken) -&gt; AnyPublisher&lt;Bool, IDPError&gt; {
</code></pre>
<h3 id='a_21578' class='heading'>A_21578</h3>
<h4 id='code-doc-manual-requirement-notes-md-19-code-ios-only-allows-biometric-access-via-secure-enclave-or-higher-order-apis' class='heading'><code>../doc/manual/requirement-notes.md:19</code>:  iOS only allows Biometric access via secure enclave or higher order apis.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:gemSpec_IDP_Frontend:A_21578] iOS only allows Biometric access via secure enclave or higher order apis.
</code></pre>
<h4 id='code-sources-idp-privatekeycontainer-swift-143-code-enforced-via-access-attribute' class='heading'><code>../Sources/IDP/PrivateKeyContainer.swift:143</code>:  Enforced via access attribute</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_21578,A_21579,A_21580,A_21583] Enforced via access attribute
kSecAttrTokenID as String: kSecAttrTokenIDSecureEnclave,
</code></pre>
<h3 id='a_21579' class='heading'>A_21579</h3>
<h4 id='code-sources-idp-privatekeycontainer-swift-143-code-enforced-via-access-attribute' class='heading'><code>../Sources/IDP/PrivateKeyContainer.swift:143</code>:  Enforced via access attribute</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_21578,A_21579,A_21580,A_21583] Enforced via access attribute
kSecAttrTokenID as String: kSecAttrTokenIDSecureEnclave,
</code></pre>
<h3 id='a_21580' class='heading'>A_21580</h3>
<h4 id='code-sources-idp-privatekeycontainer-swift-143-code-enforced-via-access-attribute' class='heading'><code>../Sources/IDP/PrivateKeyContainer.swift:143</code>:  Enforced via access attribute</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_21578,A_21579,A_21580,A_21583] Enforced via access attribute
kSecAttrTokenID as String: kSecAttrTokenIDSecureEnclave,
</code></pre>
<h3 id='a_21581' class='heading'>A_21581</h3>
<h4 id='code-sources-idp-privatekeycontainer-swift-139-code-algorithm-selection' class='heading'><code>../Sources/IDP/PrivateKeyContainer.swift:139</code>:  Algorithm selection</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_21581,A_21589] Algorithm selection
kSecAttrKeyType as String: kSecAttrKeyTypeECSECPrimeRandom,
</code></pre>
<h3 id='a_21582' class='heading'>A_21582</h3>
<h4 id='code-sources-idp-privatekeycontainer-swift-127-code-method-selection' class='heading'><code>../Sources/IDP/PrivateKeyContainer.swift:127</code>:  method selection</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_21582] method selection
// [REQ:gemSpec_IDP_Frontend:A_21587] via `.privateKeyUsage`
[.privateKeyUsage,
</code></pre>
<h3 id='a_21583' class='heading'>A_21583</h3>
<h4 id='code-doc-manual-requirement-notes-md-20-code-secure-enclave-is-enforced-with-code-attributes' class='heading'><code>../doc/manual/requirement-notes.md:20</code>:  Secure Enclave is enforced with code attributes.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:gemSpec_IDP_Frontend:A_21583] Secure Enclave is enforced with code attributes.
</code></pre>
<h4 id='code-sources-idp-privatekeycontainer-swift-143-code-enforced-via-access-attribute' class='heading'><code>../Sources/IDP/PrivateKeyContainer.swift:143</code>:  Enforced via access attribute</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_21578,A_21579,A_21580,A_21583] Enforced via access attribute
kSecAttrTokenID as String: kSecAttrTokenIDSecureEnclave,
</code></pre>
<h3 id='a_21584' class='heading'>A_21584</h3>
<h4 id='code-doc-manual-requirement-notes-md-21-code-there-is-no-api-to-allow-or-disallow-an-biometric-authentication-ios-is-handling-the-authorization-process-while-using-the-private-key-for-any-cryptographic-operation' class='heading'><code>../doc/manual/requirement-notes.md:21</code>:  There is no API to allow or disallow an biometric authentication, iOS is handling the authorization process while using the private key for any cryptographic operation.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:gemSpec_IDP_Frontend:A_21584] There is no API to allow or disallow an biometric authentication, iOS is handling the authorization process while using the private key for any cryptographic operation.
</code></pre>
<h4 id='code-sources-idp-privatekeycontainer-swift-234-code-private-key-usage-triggers-biometric-unlock' class='heading'><code>../Sources/IDP/PrivateKeyContainer.swift:234</code>:  private key usage triggers biometric unlock</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_21584] private key usage triggers biometric unlock
guard let signature = SecKeyCreateSignature(privateKey,
</code></pre>
<h3 id='a_21585' class='heading'>A_21585</h3>
<h4 id='code-doc-manual-requirement-notes-md-22-code-default-behaviour-for-all-apps-when-using-private-access-group-a-href-https-developer-apple-com-documentation-security-keychain_services-keychain_items-sharing_access_to_keychain_items_among_a_collection_of_apps-https-developer-apple-com-documentation-security-keychain_services-keychain_items-sharing_access_to_keychain_items_among_a_collection_of_apps-a' class='heading'><code>../doc/manual/requirement-notes.md:22</code>:  Default behaviour for all apps when using private access group (<a href="https://developer.apple.com/documentation/security/keychain_services/keychain_items/sharing_access_to_keychain_items_among_a_collection_of_apps">https://developer.apple.com/documentation/security/keychain_services/keychain_items/sharing_access_to_keychain_items_among_a_collection_of_apps</a>)</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:gemSpec_IDP_Frontend:A_21585] Default behaviour for all apps when using private access group (https://developer.apple.com/documentation/security/keychain_services/keychain_items/sharing_access_to_keychain_items_among_a_collection_of_apps)
</code></pre>
<h3 id='a_21586' class='heading'>A_21586</h3>
<h4 id='code-doc-manual-requirement-notes-md-23-code-ios-will-delete-all-user-related-data-after-user-accout-reset-key-chain-data-is-not-beeing-synced-with-icloud-since-code-ksecattrsynchronizable-code-is-not-applied' class='heading'><code>../doc/manual/requirement-notes.md:23</code>:  iOS will delete all user related data after user-accout reset. Key-Chain data is not beeing synced with iCloud since <code>kSecAttrSynchronizable</code> is not applied</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:gemSpec_IDP_Frontend:A_21586] iOS will delete all user related data after user-accout reset. Key-Chain data is not beeing synced with iCloud since `kSecAttrSynchronizable` is not applied
</code></pre>
<h4 id='code-sources-idp-privatekeycontainer-swift-124-code-prevents-migration-to-other-devices' class='heading'><code>../Sources/IDP/PrivateKeyContainer.swift:124</code>:  prevents migration to other devices</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_21586] prevents migration to other devices
kSecAttrAccessibleWhenPasscodeSetThisDeviceOnly,
</code></pre>
<h4 id='code-sources-idp-privatekeycontainer-swift-130-code-invalidates-biometry-after-changes' class='heading'><code>../Sources/IDP/PrivateKeyContainer.swift:130</code>:  invalidates biometry after changes</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_21586] invalidates biometry after changes
// [REQ:BSI-eRp-ePA:O.Biom_6#2] invalidates biometry after changes
.biometryCurrentSet], &amp;error) else {
</code></pre>
<h3 id='a_21587' class='heading'>A_21587</h3>
<h4 id='code-sources-idp-privatekeycontainer-swift-128-code-via-code-privatekeyusage-code' class='heading'><code>../Sources/IDP/PrivateKeyContainer.swift:128</code>:  via <code>.privateKeyUsage</code></h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_21582] method selection
// [REQ:gemSpec_IDP_Frontend:A_21587] via `.privateKeyUsage`
[.privateKeyUsage,
</code></pre>
<h3 id='a_21588' class='heading'>A_21588</h3>
<h4 id='code-sources-idp-defaultsecureenclavesignatureprovider-swift-13-code-key-identfier-generator-number-of-bytes-32' class='heading'><code>../Sources/IDP/DefaultSecureEnclaveSignatureProvider.swift:13</code>:  key identfier generator, number of bytes 32</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_21588] key identfier generator, number of bytes 32
keyIdentifierGenerator: @escaping (() throws -&gt; Data) = { try generateSecureRandom(length: 32) },
</code></pre>
<h4 id='code-sources-idp-defaultsecureenclavesignatureprovider-swift-36-code-key-generation' class='heading'><code>../Sources/IDP/DefaultSecureEnclaveSignatureProvider.swift:36</code>:  Key generation</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_21588] Key generation
let keyIdentifier = try keyIdentifierGenerator()
</code></pre>
<h4 id='code-sources-idp-defaultsecureenclavesignatureprovider-swift-101-code-usage-as-base64-encoded-string' class='heading'><code>../Sources/IDP/DefaultSecureEnclaveSignatureProvider.swift:101</code>:  usage as base64 encoded string</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_21588] usage as base64 encoded string
guard let someIdentifier = identifier,
</code></pre>
<h3 id='a_21589' class='heading'>A_21589</h3>
<h4 id='code-sources-idp-privatekeycontainer-swift-139-code-algorithm-selection' class='heading'><code>../Sources/IDP/PrivateKeyContainer.swift:139</code>:  Algorithm selection</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_21581,A_21589] Algorithm selection
kSecAttrKeyType as String: kSecAttrKeyTypeECSECPrimeRandom,
</code></pre>
<h4 id='code-sources-idp-privatekeycontainer-swift-141-code-key-length' class='heading'><code>../Sources/IDP/PrivateKeyContainer.swift:141</code>:  Key length</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_21589] Key length
kSecAttrKeySizeInBits as String: 256,
</code></pre>
<h3 id='a_21590' class='heading'>A_21590</h3>
<h4 id='code-doc-manual-requirement-notes-md-24-code-references-of-code-secureenclavesignatureprovider-code-is-limited-to-registration-and-altverify-usage' class='heading'><code>../doc/manual/requirement-notes.md:24</code>:  References of <code>SecureEnclaveSignatureProvider</code> is limited to registration and altVerify usage.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:gemSpec_IDP_Frontend:A_21590] References of `SecureEnclaveSignatureProvider` is limited to registration and altVerify usage.
</code></pre>
<h4 id='code-sources-idp-privatekeycontainer-swift-18-code-this-is-the-container-to-represent-biometric-keys-usage-is-limited-to' class='heading'><code>../Sources/IDP/PrivateKeyContainer.swift:18</code>:  This is the container to represent biometric keys. Usage is limited to</h4>

<p>code</p>
<pre class="highlight plaintext"><code>/// Represents a (SecureEnclave) private key, namely `PrK_SE_AUT`, secured by iOS Biometrics.
///
/// [REQ:gemSpec_IDP_Frontend:A_21590] This is the container to represent biometric keys. Usage is limited to
/// authorization purposes
/// [REQ:BSI-eRp-ePA:O.Cryp_7#2] Container for private key operations using secure enclave private keys
public struct PrivateKeyContainer {
</code></pre>
<h3 id='a_21591' class='heading'>A_21591</h3>
<h4 id='code-sources-idp-models-registrationdata-swift-57-code' class='heading'><code>../Sources/IDP/Models/RegistrationData.swift:57</code>:</h4>

<p>code</p>
<pre class="highlight plaintext"><code>/// [REQ:gemF_Biometrie:A_21415:Device_Type]
/// [REQ:gemSpec_IDP_Frontend:A_21591]
public struct DeviceType: Codable {
</code></pre>
<h4 id='code-sources-idp-uidevice-extension-swift-10-code' class='heading'><code>../Sources/IDP/UIDevice+Extension.swift:10</code>:</h4>

<p>code</p>
<pre class="highlight plaintext"><code>/// [REQ:gemSpec_IDP_Frontend:A_21591,A_21600]
func deviceInformation() -&gt; RegistrationData.DeviceInformation {
</code></pre>
<h4 id='code-sources-idp-uidevice-extension-swift-43-code' class='heading'><code>../Sources/IDP/UIDevice+Extension.swift:43</code>:</h4>

<p>code</p>
<pre class="highlight plaintext"><code>/// [REQ:gemSpec_IDP_Frontend:A_21591,A_21600]
func deviceInformation() -&gt; RegistrationData.DeviceInformation {
</code></pre>
<h3 id='a_21595' class='heading'>A_21595</h3>
<h4 id='code-sources-erpapp-session-keychainstorage-swift-232-code-store-within-keychain' class='heading'><code>../Sources/eRpApp/Session/KeychainStorage.swift:232</code>:  Store within keychain</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_21595] Store within keychain
success = try keychainHelper.setGenericPassword(keyIdentifier, for: idpBiometricKeyIdentifier)
</code></pre>
<h4 id='code-sources-idp-defaultsecureenclavesignatureprovider-swift-51-code-store-pairing-data' class='heading'><code>../Sources/IDP/DefaultSecureEnclaveSignatureProvider.swift:51</code>:  Store pairing data</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_21598,A_21595,A_21595] Store pairing data
certificateStorage.set(certificate: certificate)
</code></pre>
<h4 id='code-sources-idp-defaultsecureenclavesignatureprovider-swift-72-code-case-deletion' class='heading'><code>../Sources/IDP/DefaultSecureEnclaveSignatureProvider.swift:72</code>:  case deletion</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_21595] case deletion
certificateStorage.set(certificate: nil)
</code></pre>
<h4 id='code-sources-idp-idpstorage-swift-12-code-storage-protocol' class='heading'><code>../Sources/IDP/IDPStorage.swift:12</code>:  Storage Protocol</h4>

<p>code</p>
<pre class="highlight plaintext"><code>/// Interface to access an eGK Certificate that should be kept private
/// [REQ:gemSpec_IDP_Frontend:A_21595] Storage Protocol
public protocol SecureEGKCertificateStorage {
</code></pre>
<h4 id='code-sources-erpapp-screens-cardwall-readcard-cardwallreadcarddomain-environment-biometrics-swift-207-code-failure-will-delete-paring-data' class='heading'><code>../Sources/eRpApp/Screens/CardWall/ReadCard/CardWallReadCardDomain.Environment+Biometrics.swift:207</code>:  Failure will delete paring data</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_21598,A_21595] Failure will delete paring data
// [REQ:BSI-eRp-ePA:O.Source_5#5] Failure will delete paring data
_ = try? signatureProvider.abort(pairingSession: pairingSession)
</code></pre>
<h4 id='code-sources-erpapp-session-keychainstorage-swift-22-code-storage-implementation' class='heading'><code>../Sources/eRpApp/Session/KeychainStorage.swift:22</code>:  Storage Implementation</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_eRp_FdV:A_19186]
// [REQ:gemSpec_eRp_FdV:A_19188] Deletion of data saved here is managed by the OS.
// [REQ:gemSpec_IDP_Frontend:A_21322] Storage implementation uses iOS Keychain
// [REQ:gemF_Tokenverschlüsselung:A_21322] Storage implementation uses iOS Keychain
// [REQ:gemSpec_IDP_Frontend:A_21595] Storage Implementation
// [REQ:BSI-eRp-ePA:O.Purp_8#1,O.Arch_2#4,O.Arch_4#3,O.Source_7#2,O.Data_2#2] Implementation of data storage that is
// persisted via keychain
class KeychainStorage: SecureUserDataStore, IDPStorage, SecureEGKCertificateStorage {
</code></pre>
<h4 id='code-sources-erpapp-session-keychainstorage-swift-205-code-store-within-keychain' class='heading'><code>../Sources/eRpApp/Session/KeychainStorage.swift:205</code>:  Store within keychain</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_21595] Store within keychain
_ = try? keychainHelper.setGenericPassword(derBytes, for: egkAuthCertIdentifier)
</code></pre>
<h4 id='code-sources-idp-defaultsecureenclavesignatureprovider-swift-51-code-store-pairing-data' class='heading'><code>../Sources/IDP/DefaultSecureEnclaveSignatureProvider.swift:51</code>:  Store pairing data</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_21598,A_21595,A_21595] Store pairing data
certificateStorage.set(certificate: certificate)
</code></pre>
<h3 id='a_21598' class='heading'>A_21598</h3>
<h4 id='code-sources-idp-defaultsecureenclavesignatureprovider-swift-51-code-store-pairing-data' class='heading'><code>../Sources/IDP/DefaultSecureEnclaveSignatureProvider.swift:51</code>:  Store pairing data</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_21598,A_21595,A_21595] Store pairing data
certificateStorage.set(certificate: certificate)
</code></pre>
<h4 id='code-sources-idp-defaultsecureenclavesignatureprovider-swift-69-code-delete-all-stored-keys-identifiers-certificate-in-case-of-an-unsuccessful' class='heading'><code>../Sources/IDP/DefaultSecureEnclaveSignatureProvider.swift:69</code>:  Delete all stored keys/identifiers/certificate in case of an unsuccessful</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_21598] Delete all stored keys/identifiers/certificate in case of an unsuccessful
// registration
public func abort(pairingSession: PairingSession) throws {
</code></pre>
<h4 id='code-sources-erpapp-screens-cardwall-readcard-cardwallreadcarddomain-environment-biometrics-swift-207-code-failure-will-delete-paring-data' class='heading'><code>../Sources/eRpApp/Screens/CardWall/ReadCard/CardWallReadCardDomain.Environment+Biometrics.swift:207</code>:  Failure will delete paring data</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_21598,A_21595] Failure will delete paring data
// [REQ:BSI-eRp-ePA:O.Source_5#5] Failure will delete paring data
_ = try? signatureProvider.abort(pairingSession: pairingSession)
</code></pre>
<h3 id='a_21600' class='heading'>A_21600</h3>
<h4 id='code-sources-idp-uidevice-extension-swift-10-code' class='heading'><code>../Sources/IDP/UIDevice+Extension.swift:10</code>:</h4>

<p>code</p>
<pre class="highlight plaintext"><code>/// [REQ:gemSpec_IDP_Frontend:A_21591,A_21600]
func deviceInformation() -&gt; RegistrationData.DeviceInformation {
</code></pre>
<h4 id='code-sources-idp-uidevice-extension-swift-43-code' class='heading'><code>../Sources/IDP/UIDevice+Extension.swift:43</code>:</h4>

<p>code</p>
<pre class="highlight plaintext"><code>/// [REQ:gemSpec_IDP_Frontend:A_21591,A_21600]
func deviceInformation() -&gt; RegistrationData.DeviceInformation {
</code></pre>
<h3 id='a_21603' class='heading'>A_21603</h3>
<h4 id='code-sources-erpapp-session-keychainstorage-swift-251-code-certificate' class='heading'><code>../Sources/eRpApp/Session/KeychainStorage.swift:251</code>:  Certificate</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_21603] Certificate
set(certificate: nil)
</code></pre>
<h4 id='code-sources-erpapp-session-profilesecuredatawiper-swift-40-code-certificate' class='heading'><code>../Sources/eRpApp/Session/ProfileSecureDataWiper.swift:40</code>:  Certificate</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_20499,A_20499-01#2] Deletion of SSO_TOKEN, ID_TOKEN, AUTH_TOKEN
// [REQ:gemSpec_eRp_FdV:A_20186] Deletion of SSO_TOKEN, ID_TOKEN, AUTH_TOKEN
// [REQ:gemSpec_IDP_Frontend:A_21603] Certificate
storage.wipe()
</code></pre>
<h4 id='code-sources-erpapp-session-profilesecuredatawiper-swift-46-code-key-identifier' class='heading'><code>../Sources/eRpApp/Session/ProfileSecureDataWiper.swift:46</code>:  key identifier</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_21603] key identifier
storage.set(keyIdentifier: nil)
</code></pre>
<h4 id='code-sources-erpapp-session-profilesecuredatawiper-swift-50-code-prk_se_aut-puk_se_aut' class='heading'><code>../Sources/eRpApp/Session/ProfileSecureDataWiper.swift:50</code>:  PrK_SE_AUT/PuK_SE_AUT</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// If deletion fails we cannot do anything
// [REQ:gemSpec_IDP_Frontend:A_21603] PrK_SE_AUT/PuK_SE_AUT
_ = try? PrivateKeyContainer.deleteExistingKey(for: identifier)
</code></pre>
<h2 id='gemspec_idp_sek' class='heading'>gemSpec_IDP_Sek</h2>
<h3 id='a_22294' class='heading'>A_22294</h3>
<h4 id='code-sources-erpapp-screens-cardwall-extauth-cardwallextauthconfirmationdomain-swift-85-code-start-login-with-kk' class='heading'><code>../Sources/eRpApp/Screens/CardWall/ExtAuth/CardWallExtAuthConfirmationDomain.swift:85</code>:  Start login with KK</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Sek:A_22294] Start login with KK
// [REQ:BSI-eRp-ePA:O.Auth_3#2,O.Plat_10#2] Start login with KK
return environment.idpSession.startExtAuth(entry: state.selectedKK)
</code></pre>
<h4 id='code-sources-erpapp-screens-cardwall-extauth-cardwallextauthselectiondomain-swift-119-code-select-kk' class='heading'><code>../Sources/eRpApp/Screens/CardWall/ExtAuth/CardWallExtAuthSelectionDomain.swift:119</code>:  Select KK</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Sek:A_22294] Select KK
state.selectedKK = entry
</code></pre>
<h3 id='a_22295' class='heading'>A_22295</h3>
<h4 id='code-sources-idp-defaultidpsession-swift-445-code-usage-of-kk_app_id' class='heading'><code>../Sources/IDP/DefaultIDPSession.swift:445</code>:  Usage of kk_app_id</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Sek:A_22295] Usage of kk_app_id
let extAuth = IDPExtAuth(kkAppId: entry.identifier,
</code></pre>
<h3 id='a_22296' class='heading'>A_22296</h3>
<h4 id='code-sources-idp-defaultidpsession-swift-417-code-signature-verification' class='heading'><code>../Sources/IDP/DefaultIDPSession.swift:417</code>:  Signature verification</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Sek:A_22296] Signature verification
// [REQ:BSI-eRp-ePA:O.Resi_6#3] Discovery Document signature verification
guard try jwtContainer.verify(with: document.discKey) == true else {
</code></pre>
<h4 id='code-sources-erpapp-screens-cardwall-extauth-cardwallextauthselectiondomain-swift-103-code-load-available-apps' class='heading'><code>../Sources/eRpApp/Screens/CardWall/ExtAuth/CardWallExtAuthSelectionDomain.swift:103</code>:  Load available apps</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Sek:A_22296] Load available apps
return idpSession.loadDirectoryKKApps()
</code></pre>
<h3 id='a_22299' class='heading'>A_22299</h3>
<h4 id='code-sources-idp-defaultidpsession-swift-458-code-remember-state-parameter-for-later-verification' class='heading'><code>../Sources/IDP/DefaultIDPSession.swift:458</code>:  Remember State parameter for later verification</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Sek:A_22299] Remember State parameter for later verification

</code></pre>
<h4 id='code-sources-erpapp-screens-cardwall-extauth-cardwallextauthconfirmationdomain-swift-98-code-follow-redirect' class='heading'><code>../Sources/eRpApp/Screens/CardWall/ExtAuth/CardWallExtAuthConfirmationDomain.swift:98</code>:  Follow redirect</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Sek:A_22299] Follow redirect
// [REQ:BSI-eRp-ePA:O.Plat_10#3] Follow redirect
guard environment.resourceHandler.canOpenURL(url) else {
</code></pre>
<h3 id='a_22301' class='heading'>A_22301</h3>
<h4 id='code-sources-idp-defaultidpsession-swift-489-code-match-request-with-existing-state' class='heading'><code>../Sources/IDP/DefaultIDPSession.swift:489</code>:  Match request with existing state</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Sek:A_22301] Match request with existing state
guard let challengeSession = extAuthRequestStorage.getExtAuthRequest(for: state) else {
</code></pre>
<h4 id='code-sources-idp-defaultidpsession-swift-498-code-send-authorization-request' class='heading'><code>../Sources/IDP/DefaultIDPSession.swift:498</code>:  Send authorization request</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Sek:A_22301] Send authorization request
return extAuthVerify(verify)
</code></pre>
<h3 id='a_22313' class='heading'>A_22313</h3>
<h4 id='code-sources-erpapp-screens-cardwall-extauth-cardwallextauthconfirmationdomain-swift-104-code-remember-state-parameter-for-later-verification' class='heading'><code>../Sources/eRpApp/Screens/CardWall/ExtAuth/CardWallExtAuthConfirmationDomain.swift:104</code>:  Remember State parameter for later verification</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Sek:A_22313] Remember State parameter for later verification
environment.resourceHandler.open(url, options: [:]) { result in
</code></pre>
<h2 id='gemspec_krypt' class='heading'>gemSpec_Krypt</h2>
<h3 id='a_17124' class='heading'>A_17124</h3>
<h4 id='code-doc-manual-requirement-notes-md-3-code-no-exceptions-set-in-nsapptransportsecurity-see-also-a-href-https-developer-apple-com-library-archive-documentation-general-reference-infoplistkeyreference-articles-cocoakeys-html-requirements-for-connecting-using-ats-a' class='heading'><code>../doc/manual/requirement-notes.md:3</code>:  no exceptions set in NSAppTransportSecurity, see also: <a href="https://developer.apple.com/library/archive/documentation/General/Reference/InfoPlistKeyReference/Articles/CocoaKeys.html">Requirements for Connecting Using ATS</a></h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:gemSpec_Krypt:A_17322,A_17124,A_21275,A_21332,GS-A_4359,A_21275−01] no exceptions set in NSAppTransportSecurity, see also: [Requirements for Connecting Using ATS](https://developer.apple.com/library/archive/documentation/General/Reference/InfoPlistKeyReference/Articles/CocoaKeys.html)
</code></pre>
<h3 id='a_17205' class='heading'>A_17205</h3>
<h4 id='code-doc-manual-requirement-notes-md-9-code-the-app-does-not-use-the-tsl-all-tsl-related-parts-are-handled-within-the-erp-fd' class='heading'><code>../doc/manual/requirement-notes.md:9</code>:  The app does not use the TSL. All TSL related parts are handled within the eRp-FD.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:gemSpec_Krypt:A_17205] The app does not use the TSL. All TSL related parts are handled within the eRp-FD.
</code></pre>
<h3 id='a_17207' class='heading'>A_17207</h3>
<h4 id='code-sources-erpapp-screens-cardwall-readcard-nfcsignatureprovider-swift-481-code-assure-only-brainpoolp256r1-is-used' class='heading'><code>../Sources/eRpApp/Screens/CardWall/ReadCard/NFCSignatureProvider.swift:481</code>:  Assure only brainpoolP256r1 is used</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_Krypt:A_17207] Assure only brainpoolP256r1 is used
// [REQ:gemSpec_Krypt:GS-A_4357-01,GS-A_4357-02] Assure that brainpoolP256r1 is used
var alg: JWT.Algorithm? {
</code></pre>
<h4 id='code-sources-idp-defaultidpsession-swift-285-code-only-implemented-for-brainpoolp256r1' class='heading'><code>../Sources/IDP/DefaultIDPSession.swift:285</code>:  Only implemented for brainpoolP256r1</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// Validate JWT/DiscoveryDocument signature
// [REQ:gemSpec_Krypt:A_17207] Only implemented for brainpoolP256r1
// [REQ:gemSpec_Krypt:GS-A_4357-01,GS-A_4357-02] Assure that brainpoolP256r1 is used
// [REQ:BSI-eRp-ePA:O.Resi_6#4] Discovery Document signature verification
guard (try? fetchedDocument.backing.verify(with: fetchedDocument.discKey)) ?? false else {
</code></pre>
<h4 id='code-sources-idp-defaultidpsession-swift-624-code-only-implemented-for-brainpoolp256r1' class='heading'><code>../Sources/IDP/DefaultIDPSession.swift:624</code>:  Only implemented for brainpoolP256r1</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_Krypt:A_17207] Only implemented for brainpoolP256r1
// [REQ:gemSpec_IDP_Frontend:A_19908-01] Signature check
// [REQ:gemSpec_Krypt:GS-A_4357-01,GS-A_4357-02] Assure that brainpoolP256r1 is used
guard let verified = try? challenge.challenge.verify(with: document.authentication.cert),
</code></pre>
<h4 id='code-sources-idp-internal-jwt-jwtsignatureverifier-swift-23-code' class='heading'><code>../Sources/IDP/internal/JWT/JWTSignatureVerifier.swift:23</code>:</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_Krypt:A_17207]
// [REQ:gemSpec_Krypt:GS-A_4357-01,GS-A_4357-02]
public func verify(signature raw: Data, message: Data) throws -&gt; Bool {
</code></pre>
<h4 id='code-sources-idp-internal-jwt-jwtsignatureverifier-swift-33-code' class='heading'><code>../Sources/IDP/internal/JWT/JWTSignatureVerifier.swift:33</code>:</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_Krypt:A_17207]
// [REQ:gemSpec_Krypt:GS-A_4357-01,GS-A_4357-02] Assure that brainpoolP256r1 is used
guard let key = brainpoolP256r1VerifyPublicKey() else {
</code></pre>
<h4 id='code-sources-erpapp-screens-cardwall-readcard-cardwallreadcarddomain-environment-biometrics-swift-19-code-assure-only-brainpoolp256r1-is-used' class='heading'><code>../Sources/eRpApp/Screens/CardWall/ReadCard/CardWallReadCardDomain.Environment+Biometrics.swift:19</code>:  Assure only brainpoolP256r1 is used</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_Krypt:A_17207] Assure only brainpoolP256r1 is used
// [REQ:gemSpec_Krypt:GS-A_4357-01,GS-A_4357-02] Assure that brainpoolP256r1 is used
guard let alg = certificate.info.algorithm.alg else {
</code></pre>
<h4 id='code-sources-erpapp-screens-cardwall-readcard-cardwallreadcarddomain-environment-biometrics-swift-45-code-assure-only-brainpoolp256r1-is-used' class='heading'><code>../Sources/eRpApp/Screens/CardWall/ReadCard/CardWallReadCardDomain.Environment+Biometrics.swift:45</code>:  Assure only brainpoolP256r1 is used</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_Krypt:A_17207] Assure only brainpoolP256r1 is used
// [REQ:gemSpec_Krypt:GS-A_4357-01,GS-A_4357-02] Assure that brainpoolP256r1 is used
guard certificate.info.algorithm.alg == .bp256r1 else {
</code></pre>
<h4 id='code-sources-erpapp-screens-cardwall-readcard-nfcsignatureprovider-swift-429-code-assure-only-brainpoolp256r1-is-used' class='heading'><code>../Sources/eRpApp/Screens/CardWall/ReadCard/NFCSignatureProvider.swift:429</code>:  Assure only brainpoolP256r1 is used</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_Krypt:A_17207] Assure only brainpoolP256r1 is used
// [REQ:gemSpec_Krypt:GS-A_4357-01,GS-A_4357-02] Assure that brainpoolP256r1 is used
guard let alg = certificate.info.algorithm.alg else {
</code></pre>
<h4 id='code-doc-manual-requirement-notes-md-1-code-brainpoolp256r1-ist-used-for-creating-verifying-key-for-signature-usage-exception-biometric-use-case-uses-secp256r1-is-considered-in-repective-specification' class='heading'><code>../doc/manual/requirement-notes.md:1</code>:  brainpoolP256r1 ist used for creating/verifying key for signature usage; exception: Biometric use case uses secp256r1 (is considered in repective specification)</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:gemSpec_Krypt:A_17207,A_17359] brainpoolP256r1 ist used for creating/verifying key for signature usage; exception: Biometric use case uses secp256r1 (is considered in repective specification)
</code></pre>
<h3 id='a_17322' class='heading'>A_17322</h3>
<h4 id='code-doc-manual-requirement-notes-md-3-code-no-exceptions-set-in-nsapptransportsecurity-see-also-a-href-https-developer-apple-com-library-archive-documentation-general-reference-infoplistkeyreference-articles-cocoakeys-html-requirements-for-connecting-using-ats-a' class='heading'><code>../doc/manual/requirement-notes.md:3</code>:  no exceptions set in NSAppTransportSecurity, see also: <a href="https://developer.apple.com/library/archive/documentation/General/Reference/InfoPlistKeyReference/Articles/CocoaKeys.html">Requirements for Connecting Using ATS</a></h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:gemSpec_Krypt:A_17322,A_17124,A_21275,A_21332,GS-A_4359,A_21275−01] no exceptions set in NSAppTransportSecurity, see also: [Requirements for Connecting Using ATS](https://developer.apple.com/library/archive/documentation/General/Reference/InfoPlistKeyReference/Articles/CocoaKeys.html)
</code></pre>
<h3 id='a_17359' class='heading'>A_17359</h3>
<h4 id='code-doc-manual-requirement-notes-md-1-code-brainpoolp256r1-ist-used-for-creating-verifying-key-for-signature-usage-exception-biometric-use-case-uses-secp256r1-is-considered-in-repective-specification' class='heading'><code>../doc/manual/requirement-notes.md:1</code>:  brainpoolP256r1 ist used for creating/verifying key for signature usage; exception: Biometric use case uses secp256r1 (is considered in repective specification)</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:gemSpec_Krypt:A_17207,A_17359] brainpoolP256r1 ist used for creating/verifying key for signature usage; exception: Biometric use case uses secp256r1 (is considered in repective specification)
</code></pre>
<h3 id='a_17775' class='heading'>A_17775</h3>
<h4 id='code-doc-manual-requirement-notes-md-10-code-we-cannot-interfere-with-cipher-suite-lists-see-a-href-https-developer-apple-com-library-archive-documentation-general-reference-infoplistkeyreference-articles-cocoakeys-html-requirements-for-connecting-using-ats-a-for-actual-order' class='heading'><code>../doc/manual/requirement-notes.md:10</code>:  We cannot interfere with cipher suite lists, see <a href="https://developer.apple.com/library/archive/documentation/General/Reference/InfoPlistKeyReference/Articles/CocoaKeys.html">Requirements for Connecting Using ATS</a> for actual order.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:gemSpec_Krypt:A_17775,GS−A_5339] We cannot interfere with cipher suite lists, see [Requirements for Connecting Using ATS](https://developer.apple.com/library/archive/documentation/General/Reference/InfoPlistKeyReference/Articles/CocoaKeys.html) for actual order.
</code></pre>
<h3 id='a_18464' class='heading'>A_18464</h3>
<h4 id='code-sources-httpclient-defaulthttpclient-swift-36-code' class='heading'><code>../Sources/HTTPClient/DefaultHTTPClient.swift:36</code>:</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_Krypt:GS-A_4385,A_18467,A_18464,GS-A_4387]
// [REQ:gemSpec_Krypt:GS-A_5322] TODO: Check if limiting SSL Sessions is possible, check for renegotiation
// swiftlint:disable:previous todo
// [REQ:gemSpec_IDP_Frontend:A_20606] Live URLs not present in NSAppTransportSecurity exception list for allowed
// HTTP communication
// [REQ:gemSpec_eRp_FdV:A_20206]
// [REQ:BSI-eRp-ePA:O.Sess_1#2,O.Ntwk_2#2,O.Ntwk_3#2] URLSession is used as Network Framework

</code></pre>
<h3 id='a_18467' class='heading'>A_18467</h3>
<h4 id='code-sources-httpclient-defaulthttpclient-swift-36-code' class='heading'><code>../Sources/HTTPClient/DefaultHTTPClient.swift:36</code>:</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_Krypt:GS-A_4385,A_18467,A_18464,GS-A_4387]
// [REQ:gemSpec_Krypt:GS-A_5322] TODO: Check if limiting SSL Sessions is possible, check for renegotiation
// swiftlint:disable:previous todo
// [REQ:gemSpec_IDP_Frontend:A_20606] Live URLs not present in NSAppTransportSecurity exception list for allowed
// HTTP communication
// [REQ:gemSpec_eRp_FdV:A_20206]
// [REQ:BSI-eRp-ePA:O.Sess_1#2,O.Ntwk_2#2,O.Ntwk_3#2] URLSession is used as Network Framework

</code></pre>
<h3 id='a_19215' class='heading'>A_19215</h3>
<h4 id='code-doc-manual-requirement-notes-md-11-code-we-use-https-only-see-code-defaulthttpclient-swift-code-ats-forbidds-other-connections' class='heading'><code>../doc/manual/requirement-notes.md:11</code>:  We use https only, see <code>DefaultHTTPClient.swift</code>. ATS forbidds other connections.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:gemSpec_Krypt:GS−A_5035,A_19215,A_20607] We use https only, see `DefaultHTTPClient.swift`. ATS forbidds other connections.
</code></pre>
<h3 id='a_20161-01' class='heading'>A_20161-01</h3>
<h4 id='code-sources-vau-vauinterceptor-swift-46-code' class='heading'><code>../Sources/VAU/VAUInterceptor.swift:46</code>:</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// Prepare outer request (encrypt original request and embed it into a new one)
// [REQ:gemSpec_Krypt:A_20161-01]
.processToVauRequest(urlRequest: request, vauCryptoProvider: vauCryptoProvider)
</code></pre>
<h4 id='code-sources-vau-vauinterceptor-swift-62-code' class='heading'><code>../Sources/VAU/VAUInterceptor.swift:62</code>:</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// Prepare outer request (encrypt original request and embed it into a new one)
// [REQ:gemSpec_Krypt:A_20161-01]
func processToVauRequest(
</code></pre>
<h4 id='code-sources-vau-internal-vaucrypto-swift-26-code' class='heading'><code>../Sources/VAU/internal/VAUCrypto.swift:26</code>:</h4>

<p>code</p>
<pre class="highlight plaintext"><code>/// Perform encryption of the data that the implementing instance has been initialized with
/// in order to send it to a VAU service endpoint. See: gemSpec_Krypt A_20161-01
///
/// [REQ:gemSpec_Krypt:A_20161-01]
///
/// - Returns: Encrypted HTTPRequest as specified to be sent to a VAU endpoint
/// - Throws: `VAUError` in case of encryption failure
func encrypt() throws -&gt; Data
</code></pre>
<h4 id='5-code-sources-vau-internal-vaucrypto-swift-87-code' class='heading'>5 <code>../Sources/VAU/internal/VAUCrypto.swift:87</code>:</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_Krypt:A_20161-01:5]
guard let payload = "1 \(bearerToken) \(requestId) \(symKeyHex) \(message)".data(using: .utf8) else {
</code></pre>
<h4 id='6a-g-code-sources-vau-internal-vaucrypto-swift-132-code' class='heading'>6a-g <code>../Sources/VAU/internal/VAUCrypto.swift:132</code>:</h4>

<p>code</p>
<pre class="highlight plaintext"><code>/// Perform Elliptic Curve Integrated Encryption Scheme [SEC1-2009] on some payload
/// [REQ:gemSpec_Krypt:A_20161-01:6a-g]
static func encrypt(
</code></pre>
<h3 id='a_20163' class='heading'>A_20163</h3>
<h4 id='code-sources-vau-internal-vaucrypto-swift-34-code' class='heading'><code>../Sources/VAU/internal/VAUCrypto.swift:34</code>:</h4>

<p>code</p>
<pre class="highlight plaintext"><code>/// Perform decryption and validation of given data with the secret key material the implementing instance holds.
///
/// [REQ:gemSpec_Krypt:A_20163]
///
/// - Parameter data: Data to be decrypted
/// - Returns: Decrypted UTF8 string representation of the given data
/// - Throws: `VAUError` in case of decryption failure or when the decrypted data could not be validated
func decrypt(data: Data) throws -&gt; String
</code></pre>
<h3 id='a_20174' class='heading'>A_20174</h3>
<h4 id='code-sources-vau-vauinterceptor-swift-51-code' class='heading'><code>../Sources/VAU/VAUInterceptor.swift:51</code>:</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// Process VAU server response (validate and extract+decrypt inner FHIR service response)
// [REQ:gemSpec_Krypt:A_20174]
.handleUserPseudonym(vauEndpointHandler: self.vauEndpointHandler)
</code></pre>
<h4 id='code-sources-vau-vauinterceptor-swift-129-code' class='heading'><code>../Sources/VAU/VAUInterceptor.swift:129</code>:</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// Process VAU server response (validate and extract+decrypt inner FHIR service response)
// [REQ:gemSpec_Krypt:A_20174]
static func processVauResponse(httpResponse: HTTPResponse, vauCrypto: VAUCrypto, originalUrl: URL) throws
</code></pre>
<h4 id='3-code-sources-vau-internal-vaucrypto-swift-109-code-decrypt-using-aes-symmetric-key' class='heading'>3 <code>../Sources/VAU/internal/VAUCrypto.swift:109</code>:  Decrypt using AES symmetric key</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// Steps according to gemSpec_Krypt A_20174
// [REQ:gemSpec_Krypt:A_20174:3] Decrypt using AES symmetric key
guard let sealed = try? AES.GCM.SealedBox(combined: data),
</code></pre>
<h4 id='4-5-code-sources-vau-internal-vaucrypto-swift-116-code-verify-decrypted-message-expect-quot-1-request-id-response-header-and-body-quot' class='heading'>4,5 <code>../Sources/VAU/internal/VAUCrypto.swift:116</code>:  Verify decrypted message. Expect: &ldquo;1 <request id> <response header and body>&rdquo;</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_Krypt:A_20174:4,5] Verify decrypted message. Expect: "1 &lt;request id&gt; &lt;response header and body&gt;"
let separated = utf8.split(separator: " ", maxSplits: 2).map { String($0) }
</code></pre>
<h4 id='2-code-sources-vau-internal-vauendpointhandler-swift-13-code' class='heading'>2 <code>../Sources/VAU/internal/VAUEndpointHandler.swift:13</code>:</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_Krypt:A_20174:2]
func didReceiveUserPseudonym(in httpResponse: HTTPResponse)
</code></pre>
<h4 id='2-code-sources-vau-internal-vauendpointhandler-swift-34-code' class='heading'>2 <code>../Sources/VAU/internal/VAUEndpointHandler.swift:34</code>:</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_Krypt:A_20174:2]
if let pseudonym = httpResponse.response.value(forHTTPHeaderField: "userpseudonym") {
</code></pre>
<h3 id='a_20175' class='heading'>A_20175</h3>
<h4 id='code-sources-vau-vaustorage-swift-15-code' class='heading'><code>../Sources/VAU/VAUStorage.swift:15</code>:</h4>

<p>code</p>
<pre class="highlight plaintext"><code>/// Retrieve a previously saved UserPseudonym
///
/// [REQ:gemSpec_Krypt:A_20175]
var userPseudonym: AnyPublisher&lt;String?, Never&gt; { get }
</code></pre>
<h4 id='code-sources-vau-vaustorage-swift-22-code' class='heading'><code>../Sources/VAU/VAUStorage.swift:22</code>:</h4>

<p>code</p>
<pre class="highlight plaintext"><code>/// Set and save a user pseudonym
///
/// [REQ:gemSpec_Krypt:A_20175]
///
/// - Parameter userPseudonym: value to save. Pass in nil to unset
func set(userPseudonym: String?)
</code></pre>
<h3 id='a_20607' class='heading'>A_20607</h3>
<h4 id='code-doc-manual-requirement-notes-md-11-code-we-use-https-only-see-code-defaulthttpclient-swift-code-ats-forbidds-other-connections' class='heading'><code>../doc/manual/requirement-notes.md:11</code>:  We use https only, see <code>DefaultHTTPClient.swift</code>. ATS forbidds other connections.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:gemSpec_Krypt:GS−A_5035,A_19215,A_20607] We use https only, see `DefaultHTTPClient.swift`. ATS forbidds other connections.
</code></pre>
<h3 id='a_21216' class='heading'>A_21216</h3>
<h4 id='code-sources-truststore-internal-certlist-swift-11-code' class='heading'><code>../Sources/TrustStore/internal/CertList.swift:11</code>:</h4>

<p>code</p>
<pre class="highlight plaintext"><code>/// Data structure according to */CertList* endpoint
/// [REQ:gemSpec_Krypt:A_21216]
public struct CertList: Codable, Equatable {
</code></pre>
<h4 id='code-sources-vau-internal-vaucertlist-swift-11-code' class='heading'><code>../Sources/VAU/internal/VAUCertList.swift:11</code>:</h4>

<p>code</p>
<pre class="highlight plaintext"><code>/// Data structure according to */CertList* endpoint
/// [REQ:gemSpec_Krypt:A_21216]
public struct VAUCertList: Codable, Equatable {
</code></pre>
<h3 id='a_21217' class='heading'>A_21217</h3>
<h4 id='code-sources-truststore-internal-ocsplist-swift-10-code' class='heading'><code>../Sources/TrustStore/internal/OCSPList.swift:10</code>:</h4>

<p>code</p>
<pre class="highlight plaintext"><code>/// [REQ:gemSpec_Krypt:A_21217]
/// Data structure according to */OCSPList* endpoint
public struct OCSPList: Codable, Equatable {
</code></pre>
<h3 id='a_21218' class='heading'>A_21218</h3>
<h4 id='code-sources-erpapp-appconfiguration-swift-94-code-gematik-root-ca-3-as-a-trust-anchor-has-to-be-set-in-the-program-code' class='heading'><code>../Sources/eRpApp/AppConfiguration.swift:94</code>:  Gematik Root CA 3 as a trust anchor has to be set in the program code</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_Krypt:A_21218] Gematik Root CA 3 as a trust anchor has to be set in the program code
// swiftlint:disable:next force_try
let TRUSTANCHOR_GemRootCa3 = try! TrustAnchor(withPEM: """
</code></pre>
<h4 id='code-sources-truststore-defaulttruststoresession-swift-68-code' class='heading'><code>../Sources/TrustStore/DefaultTrustStoreSession.swift:68</code>:</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_Krypt:A_21218,A_21222]
extension DefaultTrustStoreSession: TrustStoreSession {
</code></pre>
<h4 id='code-sources-truststore-defaulttruststoresession-swift-178-code' class='heading'><code>../Sources/TrustStore/DefaultTrustStoreSession.swift:178</code>:</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_Krypt:A_21218]
func loadOCSPResponses() -&gt; AnyPublisher&lt;[OCSPResponse], TrustStoreError&gt; {
</code></pre>
<h4 id='code-sources-truststore-defaulttruststoresession-swift-191-code-if-only-ocsp-responses-gt-12h-available-we-must-request-new-ones' class='heading'><code>../Sources/TrustStore/DefaultTrustStoreSession.swift:191</code>:  If only OCSP responses &gt;12h available, we must request new ones</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_Krypt:A_21218] If only OCSP responses &gt;12h available, we must request new ones
ocspResponses
</code></pre>
<h4 id='code-sources-truststore-defaulttruststoresession-swift-209-code-if-only-ocsp-responses-gt-12h-available' class='heading'><code>../Sources/TrustStore/DefaultTrustStoreSession.swift:209</code>:  If only OCSP responses &gt;12h available, &hellip;</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_Krypt:A_21218] If only OCSP responses &gt;12h available, ...
ocspResponses
</code></pre>
<h4 id='code-sources-truststore-defaulttruststoresession-swift-233-code-if-only-ocsp-responses-gt-12h-available-we-must-request-new-ones' class='heading'><code>../Sources/TrustStore/DefaultTrustStoreSession.swift:233</code>:  If only OCSP responses &gt;12h available, we must request new ones</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_Krypt:A_21218] If only OCSP responses &gt;12h available, we must request new ones
func allSatisfyNotProducedBefore(date: Date) -&gt; Bool {
</code></pre>
<h4 id='code-sources-truststore-truststoresession-swift-13-code' class='heading'><code>../Sources/TrustStore/TrustStoreSession.swift:13</code>:</h4>

<p>code</p>
<pre class="highlight plaintext"><code>/// TrustStoreSession acts as an interactor/mediator for the TrustStoreClient and TrustStoreStorage
///
/// [REQ:gemSpec_Krypt:A_21218,A_21222]
public protocol TrustStoreSession {
</code></pre>
<h4 id='code-sources-truststore-x509truststore-swift-13-code' class='heading'><code>../Sources/TrustStore/X509TrustStore.swift:13</code>:</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_Krypt:A_21218]
// [REQ:gemSpec_eRp_FdV:A_20032-01]
// Category A: Cross root certificates
private let rootCa: X509
</code></pre>
<h4 id='code-sources-truststore-x509truststore-swift-105-code' class='heading'><code>../Sources/TrustStore/X509TrustStore.swift:105</code>:</h4>

<p>code</p>
<pre class="highlight plaintext"><code>/// Match a collection of `OCSPResponse`s with the end entity certificates of this `X509TrustStore`.
/// Checks response status, revocation status for each certificate and validates the signer certificates of
///   the responses itself.
///
/// [REQ:gemSpec_Krypt:A_21218]
/// [REQ:gemSpec_eRp_Fdv:A_20032-01]
///
/// - Note: This function assumes that up-to-dateness of the responses itself has already been checked.
///
/// - Returns: true on successful matching/validation, false if not successful or error
func checkEeCertificatesStatus(with ocspResponses: [OCSPResponse]) throws -&gt; Bool {
</code></pre>
<h4 id='code-sources-truststore-x509truststore-swift-103-code-ocsp-responder-certificates-must-be-verifiable-by-the-trust-store' class='heading'><code>../Sources/TrustStore/X509TrustStore.swift:103</code>:  OCSP responder certificates must be verifiable by the trust store</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_Krypt:A_21218] OCSP responder certificates must be verifiable by the trust store
let verifiedOCSPResponses = basicVerifyFilter(ocspResponses: ocspResponses)
</code></pre>
<h4 id='code-sources-truststore-x509truststore-swift-111-code-for-every-ee-certificate-there-must-be-a-matching-ocsp-response' class='heading'><code>../Sources/TrustStore/X509TrustStore.swift:111</code>:  For every EE certificate there must be a matching OCSP response</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_Krypt:A_21218] For every EE certificate there must be a matching OCSP response
let matchedResponses = try eeCertAndSignerTuple.map { eeCertificate, signer in
</code></pre>
<h4 id='code-sources-truststore-x509truststore-swift-119-code-for-every-ocsp-response-there-must-be-a-matching-ee-certificate' class='heading'><code>../Sources/TrustStore/X509TrustStore.swift:119</code>:  For every OCSP response there must be a matching EE certificate</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_Krypt:A_21218] For every OCSP response there must be a matching EE certificate
let matchedEeCerts = try ocspResponses.map { response in
</code></pre>
<h4 id='code-sources-truststore-x509truststore-swift-130-code-ocsp-responder-certificates-must-be-verifiable-by-the-trust-store' class='heading'><code>../Sources/TrustStore/X509TrustStore.swift:130</code>:  OCSP responder certificates must be verifiable by the trust store</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_Krypt:A_21218] OCSP responder certificates must be verifiable by the trust store
private func basicVerifyFilter(ocspResponses: [OCSPResponse]) -&gt; [OCSPResponse] {
</code></pre>
<h4 id='3-code-sources-truststore-x509truststore-swift-151-code-check-ca_certs-against-category-a-certificates' class='heading'>(3) <code>../Sources/TrustStore/X509TrustStore.swift:151</code>:  Check ca_certs against category A certificates</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_Krypt:A_21218:(3)] Check ca_certs against category A certificates
private static let caCertRegex =
</code></pre>
<h4 id='4-code-sources-truststore-x509truststore-swift-168-code-check-ee_certs-against-category-a-b-certificates' class='heading'>(4) <code>../Sources/TrustStore/X509TrustStore.swift:168</code>:  Check ee_certs against category A+B certificates</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_Krypt:A_21218:(4)] Check ee_certs against category A+B certificates
typealias VauAndIpdCerts = (vauCerts: [X509], idpCerts: [X509])
</code></pre>
<h4 id='code-doc-manual-requirement-notes-md-5-code-note-grace-period-for-ocsp-responses-is-12h' class='heading'><code>../doc/manual/requirement-notes.md:5</code>:  Note: grace period for OCSP responses is 12h</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:gemSpec_Krypt:A_21218] Note: grace period for OCSP responses is 12h
</code></pre>
<h3 id='a_21222' class='heading'>A_21222</h3>
<h4 id='code-sources-truststore-defaulttruststoresession-swift-68-code' class='heading'><code>../Sources/TrustStore/DefaultTrustStoreSession.swift:68</code>:</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_Krypt:A_21218,A_21222]
extension DefaultTrustStoreSession: TrustStoreSession {
</code></pre>
<h4 id='code-sources-truststore-truststoresession-swift-13-code' class='heading'><code>../Sources/TrustStore/TrustStoreSession.swift:13</code>:</h4>

<p>code</p>
<pre class="highlight plaintext"><code>/// TrustStoreSession acts as an interactor/mediator for the TrustStoreClient and TrustStoreStorage
///
/// [REQ:gemSpec_Krypt:A_21218,A_21222]
public protocol TrustStoreSession {
</code></pre>
<h3 id='a_21275' class='heading'>A_21275</h3>
<h4 id='code-doc-manual-requirement-notes-md-3-code-no-exceptions-set-in-nsapptransportsecurity-see-also-a-href-https-developer-apple-com-library-archive-documentation-general-reference-infoplistkeyreference-articles-cocoakeys-html-requirements-for-connecting-using-ats-a' class='heading'><code>../doc/manual/requirement-notes.md:3</code>:  no exceptions set in NSAppTransportSecurity, see also: <a href="https://developer.apple.com/library/archive/documentation/General/Reference/InfoPlistKeyReference/Articles/CocoaKeys.html">Requirements for Connecting Using ATS</a></h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:gemSpec_Krypt:A_17322,A_17124,A_21275,A_21332,GS-A_4359,A_21275−01] no exceptions set in NSAppTransportSecurity, see also: [Requirements for Connecting Using ATS](https://developer.apple.com/library/archive/documentation/General/Reference/InfoPlistKeyReference/Articles/CocoaKeys.html)
</code></pre>
<h3 id='a_21275-01' class='heading'>A_21275−01</h3>
<h4 id='code-doc-manual-requirement-notes-md-3-code-no-exceptions-set-in-nsapptransportsecurity-see-also-a-href-https-developer-apple-com-library-archive-documentation-general-reference-infoplistkeyreference-articles-cocoakeys-html-requirements-for-connecting-using-ats-a' class='heading'><code>../doc/manual/requirement-notes.md:3</code>:  no exceptions set in NSAppTransportSecurity, see also: <a href="https://developer.apple.com/library/archive/documentation/General/Reference/InfoPlistKeyReference/Articles/CocoaKeys.html">Requirements for Connecting Using ATS</a></h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:gemSpec_Krypt:A_17322,A_17124,A_21275,A_21332,GS-A_4359,A_21275−01] no exceptions set in NSAppTransportSecurity, see also: [Requirements for Connecting Using ATS](https://developer.apple.com/library/archive/documentation/General/Reference/InfoPlistKeyReference/Articles/CocoaKeys.html)
</code></pre>
<h3 id='a_21332' class='heading'>A_21332</h3>
<h4 id='code-doc-manual-requirement-notes-md-3-code-no-exceptions-set-in-nsapptransportsecurity-see-also-a-href-https-developer-apple-com-library-archive-documentation-general-reference-infoplistkeyreference-articles-cocoakeys-html-requirements-for-connecting-using-ats-a' class='heading'><code>../doc/manual/requirement-notes.md:3</code>:  no exceptions set in NSAppTransportSecurity, see also: <a href="https://developer.apple.com/library/archive/documentation/General/Reference/InfoPlistKeyReference/Articles/CocoaKeys.html">Requirements for Connecting Using ATS</a></h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:gemSpec_Krypt:A_17322,A_17124,A_21275,A_21332,GS-A_4359,A_21275−01] no exceptions set in NSAppTransportSecurity, see also: [Requirements for Connecting Using ATS](https://developer.apple.com/library/archive/documentation/General/Reference/InfoPlistKeyReference/Articles/CocoaKeys.html)
</code></pre>
<h3 id='a_4389' class='heading'>A_4389</h3>
<h4 id='1-code-sources-vau-internal-vaucrypto-swift-91-code-ivs-must-not-be-reused-ivs-bit-length-must-be-larger-or-equal-to-96' class='heading'>1 <code>../Sources/VAU/internal/VAUCrypto.swift:91</code>:  IVs must not be reused, IVs bit length must be larger or equal to 96</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_Krypt:A_4389:1] IVs must not be reused, IVs bit length must be larger or equal to 96
let nonceGenerator = { try VAURandom.generateSecureRandom(length: self.eciesSpec.ivSize) }
</code></pre>
<h3 id='gs-a_4357' class='heading'>GS-A_4357</h3>
<h4 id='code-sources-idp-internal-idpcrypto-swift-15-code-key-pair-generation-delegated-to-openssl-with-brainpoolp256r1-parameters' class='heading'><code>../Sources/IDP/internal/IDPCrypto.swift:15</code>:  Key pair generation delegated to OpenSSL with BrainpoolP256r1 parameters</h4>

<p>code</p>
<pre class="highlight plaintext"><code>/// Key-pair generator type based on BrainpoolP256r1
///
/// [REQ:gemSpec_Krypt:GS-A_4357] Key pair generation delegated to OpenSSL with BrainpoolP256r1 parameters
public typealias BrainpoolKeyGenerator = () throws -&gt; BrainpoolP256r1.KeyExchange.PrivateKey
</code></pre>
<h4 id='code-sources-idp-internal-jwt-jwe-kdf-swift-30-code-key-pair-generation-delegated-to-openssl-with-brainpoolp256r1-parameters' class='heading'><code>../Sources/IDP/internal/JWT/JWE+KDF.swift:30</code>:  Key pair generation delegated to OpenSSL with BrainpoolP256r1 parameters</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_Krypt:GS-A_4357] Key pair generation delegated to OpenSSL with BrainpoolP256r1 parameters
case bpp256r1(BrainpoolP256r1.KeyExchange.PublicKey,
</code></pre>
<h4 id='code-sources-vau-internal-vaucrypto-swift-94-code-key-pair-generation-delegated-to-openssl-with-brainpoolp256r1-parameters' class='heading'><code>../Sources/VAU/internal/VAUCrypto.swift:94</code>:  Key pair generation delegated to OpenSSL with BrainpoolP256r1 parameters</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_Krypt:GS-A_4357] Key pair generation delegated to OpenSSL with BrainpoolP256r1 parameters
// [REQ:BSI-eRp-ePA:O.Cryp_3#5] Brainpool key generator
let keyPairGenerator = { try BrainpoolP256r1.KeyExchange.generateKey() }
</code></pre>
<h3 id='gs-a_4357-01' class='heading'>GS-A_4357-01</h3>
<h4 id='code-sources-erpapp-screens-cardwall-readcard-nfcsignatureprovider-swift-482-code-assure-that-brainpoolp256r1-is-used' class='heading'><code>../Sources/eRpApp/Screens/CardWall/ReadCard/NFCSignatureProvider.swift:482</code>:  Assure that brainpoolP256r1 is used</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_Krypt:A_17207] Assure only brainpoolP256r1 is used
// [REQ:gemSpec_Krypt:GS-A_4357-01,GS-A_4357-02] Assure that brainpoolP256r1 is used
var alg: JWT.Algorithm? {
</code></pre>
<h4 id='code-sources-idp-defaultidpsession-swift-626-code-assure-that-brainpoolp256r1-is-used' class='heading'><code>../Sources/IDP/DefaultIDPSession.swift:626</code>:  Assure that brainpoolP256r1 is used</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_Krypt:A_17207] Only implemented for brainpoolP256r1
// [REQ:gemSpec_IDP_Frontend:A_19908-01] Signature check
// [REQ:gemSpec_Krypt:GS-A_4357-01,GS-A_4357-02] Assure that brainpoolP256r1 is used
guard let verified = try? challenge.challenge.verify(with: document.authentication.cert),
</code></pre>
<h4 id='code-sources-idp-internal-jwt-jwtsignatureverifier-swift-24-code' class='heading'><code>../Sources/IDP/internal/JWT/JWTSignatureVerifier.swift:24</code>:</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_Krypt:A_17207]
// [REQ:gemSpec_Krypt:GS-A_4357-01,GS-A_4357-02]
public func verify(signature raw: Data, message: Data) throws -&gt; Bool {
</code></pre>
<h4 id='code-sources-idp-internal-jwt-jwtsignatureverifier-swift-34-code-assure-that-brainpoolp256r1-is-used' class='heading'><code>../Sources/IDP/internal/JWT/JWTSignatureVerifier.swift:34</code>:  Assure that brainpoolP256r1 is used</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_Krypt:A_17207]
// [REQ:gemSpec_Krypt:GS-A_4357-01,GS-A_4357-02] Assure that brainpoolP256r1 is used
guard let key = brainpoolP256r1VerifyPublicKey() else {
</code></pre>
<h4 id='code-sources-erpapp-screens-cardwall-readcard-cardwallreadcarddomain-environment-biometrics-swift-20-code-assure-that-brainpoolp256r1-is-used' class='heading'><code>../Sources/eRpApp/Screens/CardWall/ReadCard/CardWallReadCardDomain.Environment+Biometrics.swift:20</code>:  Assure that brainpoolP256r1 is used</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_Krypt:A_17207] Assure only brainpoolP256r1 is used
// [REQ:gemSpec_Krypt:GS-A_4357-01,GS-A_4357-02] Assure that brainpoolP256r1 is used
guard let alg = certificate.info.algorithm.alg else {
</code></pre>
<h4 id='code-sources-erpapp-screens-cardwall-readcard-cardwallreadcarddomain-environment-biometrics-swift-46-code-assure-that-brainpoolp256r1-is-used' class='heading'><code>../Sources/eRpApp/Screens/CardWall/ReadCard/CardWallReadCardDomain.Environment+Biometrics.swift:46</code>:  Assure that brainpoolP256r1 is used</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_Krypt:A_17207] Assure only brainpoolP256r1 is used
// [REQ:gemSpec_Krypt:GS-A_4357-01,GS-A_4357-02] Assure that brainpoolP256r1 is used
guard certificate.info.algorithm.alg == .bp256r1 else {
</code></pre>
<h4 id='code-sources-erpapp-screens-cardwall-readcard-nfcsignatureprovider-swift-430-code-assure-that-brainpoolp256r1-is-used' class='heading'><code>../Sources/eRpApp/Screens/CardWall/ReadCard/NFCSignatureProvider.swift:430</code>:  Assure that brainpoolP256r1 is used</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_Krypt:A_17207] Assure only brainpoolP256r1 is used
// [REQ:gemSpec_Krypt:GS-A_4357-01,GS-A_4357-02] Assure that brainpoolP256r1 is used
guard let alg = certificate.info.algorithm.alg else {
</code></pre>
<h4 id='code-sources-idp-defaultidpsession-swift-286-code-assure-that-brainpoolp256r1-is-used' class='heading'><code>../Sources/IDP/DefaultIDPSession.swift:286</code>:  Assure that brainpoolP256r1 is used</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// Validate JWT/DiscoveryDocument signature
// [REQ:gemSpec_Krypt:A_17207] Only implemented for brainpoolP256r1
// [REQ:gemSpec_Krypt:GS-A_4357-01,GS-A_4357-02] Assure that brainpoolP256r1 is used
// [REQ:BSI-eRp-ePA:O.Resi_6#4] Discovery Document signature verification
guard (try? fetchedDocument.backing.verify(with: fetchedDocument.discKey)) ?? false else {
</code></pre>
<h3 id='gs-a_4357-02' class='heading'>GS-A_4357-02</h3>
<h4 id='code-sources-erpapp-screens-cardwall-readcard-nfcsignatureprovider-swift-482-code-assure-that-brainpoolp256r1-is-used' class='heading'><code>../Sources/eRpApp/Screens/CardWall/ReadCard/NFCSignatureProvider.swift:482</code>:  Assure that brainpoolP256r1 is used</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_Krypt:A_17207] Assure only brainpoolP256r1 is used
// [REQ:gemSpec_Krypt:GS-A_4357-01,GS-A_4357-02] Assure that brainpoolP256r1 is used
var alg: JWT.Algorithm? {
</code></pre>
<h4 id='code-sources-idp-defaultidpsession-swift-626-code-assure-that-brainpoolp256r1-is-used' class='heading'><code>../Sources/IDP/DefaultIDPSession.swift:626</code>:  Assure that brainpoolP256r1 is used</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_Krypt:A_17207] Only implemented for brainpoolP256r1
// [REQ:gemSpec_IDP_Frontend:A_19908-01] Signature check
// [REQ:gemSpec_Krypt:GS-A_4357-01,GS-A_4357-02] Assure that brainpoolP256r1 is used
guard let verified = try? challenge.challenge.verify(with: document.authentication.cert),
</code></pre>
<h4 id='code-sources-idp-internal-jwt-jwtsignatureverifier-swift-24-code' class='heading'><code>../Sources/IDP/internal/JWT/JWTSignatureVerifier.swift:24</code>:</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_Krypt:A_17207]
// [REQ:gemSpec_Krypt:GS-A_4357-01,GS-A_4357-02]
public func verify(signature raw: Data, message: Data) throws -&gt; Bool {
</code></pre>
<h4 id='code-sources-idp-internal-jwt-jwtsignatureverifier-swift-34-code-assure-that-brainpoolp256r1-is-used' class='heading'><code>../Sources/IDP/internal/JWT/JWTSignatureVerifier.swift:34</code>:  Assure that brainpoolP256r1 is used</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_Krypt:A_17207]
// [REQ:gemSpec_Krypt:GS-A_4357-01,GS-A_4357-02] Assure that brainpoolP256r1 is used
guard let key = brainpoolP256r1VerifyPublicKey() else {
</code></pre>
<h4 id='code-sources-erpapp-screens-cardwall-readcard-cardwallreadcarddomain-environment-biometrics-swift-20-code-assure-that-brainpoolp256r1-is-used' class='heading'><code>../Sources/eRpApp/Screens/CardWall/ReadCard/CardWallReadCardDomain.Environment+Biometrics.swift:20</code>:  Assure that brainpoolP256r1 is used</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_Krypt:A_17207] Assure only brainpoolP256r1 is used
// [REQ:gemSpec_Krypt:GS-A_4357-01,GS-A_4357-02] Assure that brainpoolP256r1 is used
guard let alg = certificate.info.algorithm.alg else {
</code></pre>
<h4 id='code-sources-erpapp-screens-cardwall-readcard-cardwallreadcarddomain-environment-biometrics-swift-46-code-assure-that-brainpoolp256r1-is-used' class='heading'><code>../Sources/eRpApp/Screens/CardWall/ReadCard/CardWallReadCardDomain.Environment+Biometrics.swift:46</code>:  Assure that brainpoolP256r1 is used</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_Krypt:A_17207] Assure only brainpoolP256r1 is used
// [REQ:gemSpec_Krypt:GS-A_4357-01,GS-A_4357-02] Assure that brainpoolP256r1 is used
guard certificate.info.algorithm.alg == .bp256r1 else {
</code></pre>
<h4 id='code-sources-erpapp-screens-cardwall-readcard-nfcsignatureprovider-swift-430-code-assure-that-brainpoolp256r1-is-used' class='heading'><code>../Sources/eRpApp/Screens/CardWall/ReadCard/NFCSignatureProvider.swift:430</code>:  Assure that brainpoolP256r1 is used</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_Krypt:A_17207] Assure only brainpoolP256r1 is used
// [REQ:gemSpec_Krypt:GS-A_4357-01,GS-A_4357-02] Assure that brainpoolP256r1 is used
guard let alg = certificate.info.algorithm.alg else {
</code></pre>
<h4 id='code-sources-idp-defaultidpsession-swift-286-code-assure-that-brainpoolp256r1-is-used' class='heading'><code>../Sources/IDP/DefaultIDPSession.swift:286</code>:  Assure that brainpoolP256r1 is used</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// Validate JWT/DiscoveryDocument signature
// [REQ:gemSpec_Krypt:A_17207] Only implemented for brainpoolP256r1
// [REQ:gemSpec_Krypt:GS-A_4357-01,GS-A_4357-02] Assure that brainpoolP256r1 is used
// [REQ:BSI-eRp-ePA:O.Resi_6#4] Discovery Document signature verification
guard (try? fetchedDocument.backing.verify(with: fetchedDocument.discKey)) ?? false else {
</code></pre>
<h3 id='gs-a_4359' class='heading'>GS-A_4359</h3>
<h4 id='code-doc-manual-requirement-notes-md-3-code-no-exceptions-set-in-nsapptransportsecurity-see-also-a-href-https-developer-apple-com-library-archive-documentation-general-reference-infoplistkeyreference-articles-cocoakeys-html-requirements-for-connecting-using-ats-a' class='heading'><code>../doc/manual/requirement-notes.md:3</code>:  no exceptions set in NSAppTransportSecurity, see also: <a href="https://developer.apple.com/library/archive/documentation/General/Reference/InfoPlistKeyReference/Articles/CocoaKeys.html">Requirements for Connecting Using ATS</a></h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:gemSpec_Krypt:A_17322,A_17124,A_21275,A_21332,GS-A_4359,A_21275−01] no exceptions set in NSAppTransportSecurity, see also: [Requirements for Connecting Using ATS](https://developer.apple.com/library/archive/documentation/General/Reference/InfoPlistKeyReference/Articles/CocoaKeys.html)
</code></pre>
<h3 id='gs-a_4367' class='heading'>GS-A_4367</h3>
<h4 id='code-sources-idp-internal-seckeyrandom-swift-20-code' class='heading'><code>../Sources/IDP/internal/SecKeyRandom.swift:20</code>:</h4>

<p>code</p>
<pre class="highlight plaintext"><code>/// Generate random Data with given length
///
/// [REQ:gemSpec_Krypt:GS-A_4367]
/// [REQ:BSI-eRp-ePA:O.Rand_1#2] Secure Random generator.
///
/// - Parameters:
///   - length: the number of bytes to generate
///   - randomizer: the randomizer to be used. Default: kSecRandomDefault
/// - Returns: the random initialized Data
/// - Throws: `IDPError`
public func generateSecureRandom(length: Int, randomizer: SecRandomRef? = kSecRandomDefault) throws -&gt; Data {
</code></pre>
<h4 id='code-sources-vau-internal-vaurandom-swift-21-code' class='heading'><code>../Sources/VAU/internal/VAURandom.swift:21</code>:</h4>

<p>code</p>
<pre class="highlight plaintext"><code>/// Generate random Data with given length
///
/// [REQ:gemSpec_Krypt:GS-A_4367]
/// [REQ:BSI-eRp-ePA:O.Rand_1#3] Secure Random generator.
///
/// - Parameters:
///   - length: the number of bytes to generate
///   - randomizer: the randomizer to be used. Default: kSecRandomDefault
/// - Returns: the random initialized Data
/// - Throws: `VAUError`
static func generateSecureRandom(length: Int, randomizer: SecRandomRef? = kSecRandomDefault) throws -&gt; Data {
</code></pre>
<h3 id='gs-a_4385' class='heading'>GS-A_4385</h3>
<h4 id='code-sources-httpclient-defaulthttpclient-swift-36-code' class='heading'><code>../Sources/HTTPClient/DefaultHTTPClient.swift:36</code>:</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_Krypt:GS-A_4385,A_18467,A_18464,GS-A_4387]
// [REQ:gemSpec_Krypt:GS-A_5322] TODO: Check if limiting SSL Sessions is possible, check for renegotiation
// swiftlint:disable:previous todo
// [REQ:gemSpec_IDP_Frontend:A_20606] Live URLs not present in NSAppTransportSecurity exception list for allowed
// HTTP communication
// [REQ:gemSpec_eRp_FdV:A_20206]
// [REQ:BSI-eRp-ePA:O.Sess_1#2,O.Ntwk_2#2,O.Ntwk_3#2] URLSession is used as Network Framework

</code></pre>
<h3 id='gs-a_4387' class='heading'>GS-A_4387</h3>
<h4 id='code-sources-httpclient-defaulthttpclient-swift-36-code' class='heading'><code>../Sources/HTTPClient/DefaultHTTPClient.swift:36</code>:</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_Krypt:GS-A_4385,A_18467,A_18464,GS-A_4387]
// [REQ:gemSpec_Krypt:GS-A_5322] TODO: Check if limiting SSL Sessions is possible, check for renegotiation
// swiftlint:disable:previous todo
// [REQ:gemSpec_IDP_Frontend:A_20606] Live URLs not present in NSAppTransportSecurity exception list for allowed
// HTTP communication
// [REQ:gemSpec_eRp_FdV:A_20206]
// [REQ:BSI-eRp-ePA:O.Sess_1#2,O.Ntwk_2#2,O.Ntwk_3#2] URLSession is used as Network Framework

</code></pre>
<h3 id='gs-a_4389' class='heading'>GS-A_4389</h3>
<h4 id='2-code-sources-idp-internal-idpcrypto-swift-47-code-ivs-must-not-be-reused-ivs-bit-length-must-be-larger-or-equal-to-96' class='heading'>2 <code>../Sources/IDP/internal/IDPCrypto.swift:47</code>:  IVs must not be reused, IVs bit length must be larger or equal to 96</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_Krypt:GS-A_4389:2] IVs must not be reused, IVs bit length must be larger or equal to 96
try generateSecureRandom(length: IDPCrypto.AES256GCMSpec.nonceBytes)
</code></pre>
<h4 id='1-code-sources-idp-internal-idpcrypto-swift-50-code-256bit-gcm-symmetric-key' class='heading'>1 <code>../Sources/IDP/internal/IDPCrypto.swift:50</code>:  256bit GCM symmetric key</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_Krypt:GS-A_4389:1] 256bit GCM symmetric key
aesKey: SymmetricKey = SymmetricKey(size: SymmetricKeySize(bitCount: 256))
</code></pre>
<h4 id='2-code-sources-vau-internal-vaucrypto-swift-142-code-256bit-gcm-symmetric-key' class='heading'>2 <code>../Sources/VAU/internal/VAUCrypto.swift:142</code>:  256bit GCM symmetric key</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_Krypt:GS-A_4389:2] 256bit GCM symmetric key
let secretKey = SymmetricKey(data: sharedSecret)
</code></pre>
<h4 id='1-code-sources-vau-internal-vaucrypto-swift-161-code-256bit-gcm-symmetric-key' class='heading'>1 <code>../Sources/VAU/internal/VAUCrypto.swift:161</code>:  256bit GCM symmetric key</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// f) Encrypt
// [REQ:gemSpec_Krypt:GS-A_4389:1] 256bit GCM symmetric key
let sealedBox = try AES.GCM.seal(payload, using: cek, nonce: nonce)
</code></pre>
<h3 id='gs-a_4390' class='heading'>GS-A_4390</h3>
<h4 id='code-sources-avs-avscmsencrypter-swift-17-code-rsaes-oaep-with-mgf1-implemented-in-sub-framework-openssl-swift' class='heading'><code>../Sources/AVS/AVSCmsEncrypter.swift:17</code>:  RSAES-OAEP with MGF1 implemented in sub-framework OpenSSL-swift</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_Krypt:GS-A_4390] RSAES-OAEP with MGF1 implemented in sub-framework OpenSSL-swift
// https://github.com/gematik/OpenSSL-Swift/blob/3c1ea91ba5abfefecfe3588815cb928d777e29ad/Sources/OpenSSL/CMS/CMSContentInfo.swift#L88
// swiftlint:disable:previous line_length
let cms = try CMSContentInfo.encryptPartial(data: data)
</code></pre>
<h3 id='gs-a_5322' class='heading'>GS-A_5322</h3>
<h4 id='code-sources-httpclient-defaulthttpclient-swift-37-code-todo-check-if-limiting-ssl-sessions-is-possible-check-for-renegotiation' class='heading'><code>../Sources/HTTPClient/DefaultHTTPClient.swift:37</code>:  TODO: Check if limiting SSL Sessions is possible, check for renegotiation</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_Krypt:GS-A_4385,A_18467,A_18464,GS-A_4387]
// [REQ:gemSpec_Krypt:GS-A_5322] TODO: Check if limiting SSL Sessions is possible, check for renegotiation
// swiftlint:disable:previous todo
// [REQ:gemSpec_IDP_Frontend:A_20606] Live URLs not present in NSAppTransportSecurity exception list for allowed
// HTTP communication
// [REQ:gemSpec_eRp_FdV:A_20206]
// [REQ:BSI-eRp-ePA:O.Sess_1#2,O.Ntwk_2#2,O.Ntwk_3#2] URLSession is used as Network Framework

</code></pre>
<h3 id='gs-a_5035' class='heading'>GS−A_5035</h3>
<h4 id='code-doc-manual-requirement-notes-md-11-code-we-use-https-only-see-code-defaulthttpclient-swift-code-ats-forbidds-other-connections' class='heading'><code>../doc/manual/requirement-notes.md:11</code>:  We use https only, see <code>DefaultHTTPClient.swift</code>. ATS forbidds other connections.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:gemSpec_Krypt:GS−A_5035,A_19215,A_20607] We use https only, see `DefaultHTTPClient.swift`. ATS forbidds other connections.
</code></pre>
<h3 id='gs-a_5322' class='heading'>GS−A_5322</h3>
<h4 id='code-doc-manual-requirement-notes-md-12-code-there-is-no-api-to-control-the-session-length-developer-forums-suggest-it-is-10-minutes-for-ios' class='heading'><code>../doc/manual/requirement-notes.md:12</code>:  There is no API to control the session length, developer forums suggest it is 10 minutes for iOS.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:gemSpec_Krypt:GS−A_5322] There is no API to control the session length, developer forums suggest it is 10 minutes for iOS.
</code></pre>
<h3 id='gs-a_5339' class='heading'>GS−A_5339</h3>
<h4 id='code-doc-manual-requirement-notes-md-10-code-we-cannot-interfere-with-cipher-suite-lists-see-a-href-https-developer-apple-com-library-archive-documentation-general-reference-infoplistkeyreference-articles-cocoakeys-html-requirements-for-connecting-using-ats-a-for-actual-order' class='heading'><code>../doc/manual/requirement-notes.md:10</code>:  We cannot interfere with cipher suite lists, see <a href="https://developer.apple.com/library/archive/documentation/General/Reference/InfoPlistKeyReference/Articles/CocoaKeys.html">Requirements for Connecting Using ATS</a> for actual order.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:gemSpec_Krypt:A_17775,GS−A_5339] We cannot interfere with cipher suite lists, see [Requirements for Connecting Using ATS](https://developer.apple.com/library/archive/documentation/General/Reference/InfoPlistKeyReference/Articles/CocoaKeys.html) for actual order.
</code></pre>
<h3 id='gs-a_5526' class='heading'>GS−A_5526</h3>
<h4 id='code-doc-manual-requirement-notes-md-13-code-we-use-the-recommended-nsurlsession-for-best-network-security-a-href-https-developer-apple-com-documentation-security-preventing_insecure_network_connections-preventing-insecure-network-connections-a' class='heading'><code>../doc/manual/requirement-notes.md:13</code>:  We use the recommended NSURLSession for best network security <a href="https://developer.apple.com/documentation/security/preventing_insecure_network_connections">Preventing insecure network connections</a></h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:gemSpec_Krypt:GS−A_5526,GS−A_5542] We use the recommended NSURLSession for best network security [Preventing insecure network connections](https://developer.apple.com/documentation/security/preventing_insecure_network_connections)
</code></pre>
<h3 id='gs-a_5542' class='heading'>GS−A_5542</h3>
<h4 id='code-doc-manual-requirement-notes-md-13-code-we-use-the-recommended-nsurlsession-for-best-network-security-a-href-https-developer-apple-com-documentation-security-preventing_insecure_network_connections-preventing-insecure-network-connections-a' class='heading'><code>../doc/manual/requirement-notes.md:13</code>:  We use the recommended NSURLSession for best network security <a href="https://developer.apple.com/documentation/security/preventing_insecure_network_connections">Preventing insecure network connections</a></h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:gemSpec_Krypt:GS−A_5526,GS−A_5542] We use the recommended NSURLSession for best network security [Preventing insecure network connections](https://developer.apple.com/documentation/security/preventing_insecure_network_connections)
</code></pre>
<h2 id='gemspec_erp_apovzd' class='heading'>gemSpec_eRp_APOVZD</h2>
<h3 id='a_21154' class='heading'>A_21154</h3>
<h4 id='code-sources-erpapp-screens-pharmacy-search-pharmacysearchdomain-swift-268-code-if-user-defined-filters-contain-location-element-ask-for-permission' class='heading'><code>../Sources/eRpApp/Screens/Pharmacy/Search/PharmacySearchDomain.swift:268</code>:  If user defined filters contain location element, ask for permission</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_eRp_APOVZD:A_21154] If user defined filters contain location element, ask for permission
if filterOptions.contains(.currentLocation) {
</code></pre>
<h3 id='a_21779' class='heading'>A_21779</h3>
<h4 id='code-sources-pharmacy-modelsr4-bundle-location-swift-137-code-delivery-pharmacy' class='heading'><code>../Sources/Pharmacy/ModelsR4.Bundle+Location.swift:137</code>:  delivery pharmacy</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [[REQ:gemSpec_eRp_APOVZD:A_21779] delivery pharmacy
case "498":
</code></pre>
<h4 id='code-sources-pharmacy-modelsr4-bundle-location-swift-194-code-map-pickup-pharmacy' class='heading'><code>../Sources/Pharmacy/ModelsR4.Bundle+Location.swift:194</code>:  Map pickup pharmacy</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [[REQ:gemSpec_eRp_APOVZD:A_21779] Map pickup pharmacy
case "OUTPHARM":
</code></pre>
<h4 id='code-sources-pharmacy-modelsr4-bundle-location-swift-199-code-map-shipping-pharmacy' class='heading'><code>../Sources/Pharmacy/ModelsR4.Bundle+Location.swift:199</code>:  Map shipping pharmacy</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [[REQ:gemSpec_eRp_APOVZD:A_21779] Map shipping pharmacy
case "MOBL":
</code></pre>
<h2 id='gemspec_erp_fdv' class='heading'>gemSpec_eRp_FdV</h2>
<h3 id='a_19086' class='heading'>A_19086</h3>
<h4 id='code-doc-manual-requirement-notes-md-27-code-tracking-is-only-implemented-for-the-purpose-of-usability-tracking-sessions-are-not-persisted-session-ids-are-recreated-each-app-startup' class='heading'><code>../doc/manual/requirement-notes.md:27</code>:  Tracking is only implemented for the purpose of Usability-Tracking. Sessions are not persisted, session ids are recreated each app startup.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:gemSpec_eRp_FdV:A_19086,A_19087#1] Tracking is only implemented for the purpose of Usability-Tracking. Sessions are not persisted, session ids are recreated each app startup.
</code></pre>
<h3 id='a_19087' class='heading'>A_19087</h3>
<h4 id='code-doc-manual-requirement-notes-md-27-code-tracking-is-only-implemented-for-the-purpose-of-usability-tracking-sessions-are-not-persisted-session-ids-are-recreated-each-app-startup' class='heading'><code>../doc/manual/requirement-notes.md:27</code>:  Tracking is only implemented for the purpose of Usability-Tracking. Sessions are not persisted, session ids are recreated each app startup.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:gemSpec_eRp_FdV:A_19086,A_19087#1] Tracking is only implemented for the purpose of Usability-Tracking. Sessions are not persisted, session ids are recreated each app startup.
</code></pre>
<h4 id='code-sources-erpapp-tracking-contentsquareanalyticsadapter-swift-13-code-implementation-of-the-opt-in-usability-tracker' class='heading'><code>../Sources/eRpApp/Tracking/ContentSquareAnalyticsAdapter.swift:13</code>:  Implementation of the opt-in usability-tracker.</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_eRp_FdV:A_19087#2] Implementation of the opt-in usability-tracker.
final class ContentSquareAnalyticsAdapter: NSObject, Tracker {
</code></pre>
<h3 id='a_19088' class='heading'>A_19088</h3>
<h4 id='code-sources-erpapp-screens-onboarding-onboardingdomain-swift-180-code-show-comply-route-to-display-analytics-usage-within' class='heading'><code>../Sources/eRpApp/Screens/Onboarding/OnboardingDomain.swift:180</code>:  Show comply route to display analytics usage within</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_eRp_FdV:A_19088,A_19091#1,A_19092] Show comply route to display analytics usage within
// onboarding
// [REQ:BSI-eRp-ePA:O.Purp_3#5] Show comply route to display analytics usage within onboarding
case .showTrackingAlert:
</code></pre>
<h3 id='a_19089' class='heading'>A_19089</h3>
<h4 id='code-sources-erpapp-screens-settings-settingsview-swift-270-code-user-info-for-usage-tracking' class='heading'><code>../Sources/eRpApp/Screens/Settings/SettingsView.swift:270</code>:  User info for usage tracking</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_eRp_FdV:A_19089] User info for usage tracking
Label(title: { Text(L10n.stgTrkTxtExplanation) }, icon: {})
</code></pre>
<h3 id='a_19090' class='heading'>A_19090</h3>
<h4 id='code-sources-erpapp-scenedelegate-swift-221-code-activate-after-optin-is-granted' class='heading'><code>../Sources/eRpApp/SceneDelegate.swift:221</code>:  activate after optIn is granted</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_eRp_FdV:A_19090] activate after optIn is granted
tracker.stopTracking()
</code></pre>
<h4 id='code-sources-erpapp-screens-onboarding-onboardingdomain-swift-185-code-user-confirms-the-opt-in-within-settings' class='heading'><code>../Sources/eRpApp/Screens/Onboarding/OnboardingDomain.swift:185</code>:  User confirms the opt in within settings</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_eRp_FdV:A_19090,A_19091#2] User confirms the opt in within settings
// [REQ:BSI-eRp-ePA:O.Purp_3#6] Accept usage analytics
case .allowTracking:
</code></pre>
<h4 id='code-sources-erpapp-screens-settings-settingsdomain-swift-206-code-user-confirms-the-opt-in-within-settings' class='heading'><code>../Sources/eRpApp/Screens/Settings/SettingsDomain.swift:206</code>:  User confirms the opt in within settings</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_eRp_FdV:A_19090,A_19091#4] User confirms the opt in within settings
// [REQ:BSI-eRp-ePA:O.Purp_5#4] User confirms the opt in within settings
case .confirmedOptInTracking:
</code></pre>
<h4 id='code-sources-erpapp-tracking-contentsquareanalyticsadapter-swift-42-code-activate-after-optin-is-granted' class='heading'><code>../Sources/eRpApp/Tracking/ContentSquareAnalyticsAdapter.swift:42</code>:  activate after optIn is granted</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_eRp_FdV:A_19090] activate after optIn is granted
Contentsquare.start()
</code></pre>
<h4 id='code-sources-erpapp-tracking-contentsquareanalyticsadapter-swift-60-code-activate-tracking-only-if-permitted' class='heading'><code>../Sources/eRpApp/Tracking/ContentSquareAnalyticsAdapter.swift:60</code>:  activate tracking only if permitted</h4>

<p>code</p>
<pre class="highlight plaintext"><code>/// Starts tracking and calls `optIn` if permission is granted by the user.
/// Calling this method after calling `resetSessionID()` will create a new `sessionID`
// [REQ:gemSpec_eRp_FdV:A_19090] activate tracking only if permitted
private func startIfPermitted() {
</code></pre>
<h3 id='a_19091' class='heading'>A_19091</h3>
<h4 id='code-sources-erpapp-screens-onboarding-onboardingdomain-swift-180-code-show-comply-route-to-display-analytics-usage-within' class='heading'><code>../Sources/eRpApp/Screens/Onboarding/OnboardingDomain.swift:180</code>:  Show comply route to display analytics usage within</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_eRp_FdV:A_19088,A_19091#1,A_19092] Show comply route to display analytics usage within
// onboarding
// [REQ:BSI-eRp-ePA:O.Purp_3#5] Show comply route to display analytics usage within onboarding
case .showTrackingAlert:
</code></pre>
<h4 id='code-sources-erpapp-screens-onboarding-onboardingdomain-swift-185-code-user-confirms-the-opt-in-within-settings' class='heading'><code>../Sources/eRpApp/Screens/Onboarding/OnboardingDomain.swift:185</code>:  User confirms the opt in within settings</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_eRp_FdV:A_19090,A_19091#2] User confirms the opt in within settings
// [REQ:BSI-eRp-ePA:O.Purp_3#6] Accept usage analytics
case .allowTracking:
</code></pre>
<h4 id='code-sources-erpapp-screens-settings-settingsdomain-swift-197-code-show-comply-route-to-display-analytics-usage-within-settings' class='heading'><code>../Sources/eRpApp/Screens/Settings/SettingsDomain.swift:197</code>:  Show comply route to display analytics usage within settings</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_eRp_FdV:A_19091#3] Show comply route to display analytics usage within settings
state.destination = .complyTracking
</code></pre>
<h4 id='code-sources-erpapp-screens-settings-settingsdomain-swift-206-code-user-confirms-the-opt-in-within-settings' class='heading'><code>../Sources/eRpApp/Screens/Settings/SettingsDomain.swift:206</code>:  User confirms the opt in within settings</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_eRp_FdV:A_19090,A_19091#4] User confirms the opt in within settings
// [REQ:BSI-eRp-ePA:O.Purp_5#4] User confirms the opt in within settings
case .confirmedOptInTracking:
</code></pre>
<h3 id='a_19092' class='heading'>A_19092</h3>
<h4 id='code-sources-erpapp-screens-onboarding-onboardingdomain-swift-180-code-show-comply-route-to-display-analytics-usage-within' class='heading'><code>../Sources/eRpApp/Screens/Onboarding/OnboardingDomain.swift:180</code>:  Show comply route to display analytics usage within</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_eRp_FdV:A_19088,A_19091#1,A_19092] Show comply route to display analytics usage within
// onboarding
// [REQ:BSI-eRp-ePA:O.Purp_3#5] Show comply route to display analytics usage within onboarding
case .showTrackingAlert:
</code></pre>
<h4 id='code-sources-erpapp-screens-onboarding-onboardingdomain-swift-190-code-user-may-choose-to-not-accept-analytics' class='heading'><code>../Sources/eRpApp/Screens/Onboarding/OnboardingDomain.swift:190</code>:  User may choose to not accept analytics</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_eRp_FdV:A_19092] User may choose to not accept analytics
// [REQ:BSI-eRp-ePA:O.Purp_3#7] Deny usage analytics
case .dismissAlert:
</code></pre>
<h3 id='a_19093' class='heading'>A_19093</h3>
<h4 id='code-doc-manual-requirement-notes-md-28-code-usage-tracking-is-called-very-sparse-and-boils-down-to-one-place-where-all-visited-screens-are-recorded-see-usage-of-code-dependency-tracker-code-for-all-cases-where-the-actual-analytics-framework-is-used' class='heading'><code>../doc/manual/requirement-notes.md:28</code>:  Usage Tracking is called very sparse and boils down to one place where all visited screens are recorded. See usage of <code>@Dependency(\.tracker)</code> for all cases where the actual analytics framework is used.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:gemSpec_eRp_FdV:A_19093#1,A_19094] Usage Tracking is called very sparse and boils down to one place where all visited screens are recorded. See usage of `@Dependency(\.tracker)` for all cases where the actual analytics framework is used.
</code></pre>
<h4 id='code-sources-erpapp-tracking-analyticsreducer-swift-38-code-very-sparse-usage-of-actual-tracking-boils-down-to-this-call-where' class='heading'><code>../Sources/eRpApp/Tracking/AnalyticsReducer.swift:38</code>:  Very sparse usage of actual tracking boils down to this call where</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_eRp_FdV:A_19093#2] Very sparse usage of actual tracking boils down to this call where
// only displayed screens are tracked
tracker.track(screen: newRoute)
</code></pre>
<h3 id='a_19094' class='heading'>A_19094</h3>
<h4 id='code-doc-manual-requirement-notes-md-28-code-usage-tracking-is-called-very-sparse-and-boils-down-to-one-place-where-all-visited-screens-are-recorded-see-usage-of-code-dependency-tracker-code-for-all-cases-where-the-actual-analytics-framework-is-used' class='heading'><code>../doc/manual/requirement-notes.md:28</code>:  Usage Tracking is called very sparse and boils down to one place where all visited screens are recorded. See usage of <code>@Dependency(\.tracker)</code> for all cases where the actual analytics framework is used.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:gemSpec_eRp_FdV:A_19093#1,A_19094] Usage Tracking is called very sparse and boils down to one place where all visited screens are recorded. See usage of `@Dependency(\.tracker)` for all cases where the actual analytics framework is used.
</code></pre>
<h3 id='a_19095' class='heading'>A_19095</h3>
<h4 id='code-sources-erpapp-tracking-contentsquareanalyticsadapter-swift-72-code-resets-sessionid-so-that-on-next-app-start-a-new-sessionid-will-be-created' class='heading'><code>../Sources/eRpApp/Tracking/ContentSquareAnalyticsAdapter.swift:72</code>:  resets sessionID so that on next app start a new sessionID will be created</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_eRp_FdV:A_19095] resets sessionID so that on next app start a new sessionID will be created
Contentsquare.optOut()
</code></pre>
<h3 id='a_19096' class='heading'>A_19096</h3>
<h4 id='code-sources-erpapp-tracking-contentsquareanalyticsadapter-swift-61-code-remove-existing-sessions-while-starting-the-framework' class='heading'><code>../Sources/eRpApp/Tracking/ContentSquareAnalyticsAdapter.swift:61</code>:  Remove existing sessions while starting the framework</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_eRp_FdV:A_19096] Remove existing sessions while starting the framework
Contentsquare.start()
</code></pre>
<h3 id='a_19097' class='heading'>A_19097</h3>
<h4 id='code-sources-erpapp-screens-settings-settingsview-swift-248-code-toggle-within-settings-to-enable-and-disable-usage-tracking' class='heading'><code>../Sources/eRpApp/Screens/Settings/SettingsView.swift:248</code>:  Toggle within Settings to enable and disable usage tracking</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_eRp_FdV:A_19097] Toggle within Settings to enable and disable usage tracking
// [REQ:BSI-eRp-ePA:O.Purp_5#1] Toggle within Settings to enable and disable usage tracking
// [REQ:BSI-eRp-ePA:O.Purp_6#1] Current Analytics state is inspectable by the user
Toggle(isOn: viewStore.binding(
</code></pre>
<h3 id='a_19177' class='heading'>A_19177</h3>
<h4 id='code-sources-erpapp-screens-settings-profiles-protocol-auditeventsview-swift-10-code-view-displaying-the-audit-events' class='heading'><code>../Sources/eRpApp/Screens/Settings/Profiles/Protocol/AuditEventsView.swift:10</code>:  View displaying the audit events</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_eRp_FdV:A_19177#1] View displaying the audit events
// [REQ:BSI-eRp-ePA:O.Auth_5#3] View displaying the audit events
struct AuditEventsView: View {
</code></pre>
<h4 id='code-sources-erpapp-screens-settings-profiles-edit-editprofileview-swift-493-code-actual-button-to-open-the-audit-events' class='heading'><code>../Sources/eRpApp/Screens/Settings/Profiles/Edit/EditProfileView.swift:493</code>:  Actual Button to open the audit events</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_eRp_FdV:A_19177#2] Actual Button to open the audit events
// [REQ:BSI-eRp-ePA:O.Auth_5#2] Actual Button to open the audit events
NavigationLink(
</code></pre>
<h3 id='a_19183' class='heading'>A_19183</h3>
<h4 id='code-doc-manual-requirement-notes-md-14-code-no-erp-fd-data-is-forwarded-to-other-systems-besides-erp-fd-itself' class='heading'><code>../doc/manual/requirement-notes.md:14</code>:  No eRp-FD Data is forwarded to other systems besides eRp-FD itself.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:gemSpec_eRp_FdV:A_19183] No eRp-FD Data is forwarded to other systems besides eRp-FD itself.
</code></pre>
<h3 id='a_19184' class='heading'>A_19184</h3>
<h4 id='code-sources-erpapp-screens-onboarding-onboardinganalyticsview-swift-19-code-information-for-the-user-what-is-collected' class='heading'><code>../Sources/eRpApp/Screens/Onboarding/OnboardingAnalyticsView.swift:19</code>:  Information for the user what is collected</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_eRp_FdV:A_19184] Information for the user what is collected
VStack(alignment: .leading, spacing: 16) {
</code></pre>
<h4 id='code-sources-erpapp-screens-onboarding-onboardingdomain-swift-198-code-alert-for-the-user-to-choose' class='heading'><code>../Sources/eRpApp/Screens/Onboarding/OnboardingDomain.swift:198</code>:  Alert for the user to choose.</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_eRp_FdV:A_19184] Alert for the user to choose.
static let trackingAlertState: AlertState&lt;Action&gt; = {
</code></pre>
<h3 id='a_19186' class='heading'>A_19186</h3>
<h4 id='code-sources-erpapp-session-keychainstorage-swift-18-code' class='heading'><code>../Sources/eRpApp/Session/KeychainStorage.swift:18</code>:</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_eRp_FdV:A_19186]
// [REQ:gemSpec_eRp_FdV:A_19188] Deletion of data saved here is managed by the OS.
// [REQ:gemSpec_IDP_Frontend:A_21322] Storage implementation uses iOS Keychain
// [REQ:gemF_Tokenverschlüsselung:A_21322] Storage implementation uses iOS Keychain
// [REQ:gemSpec_IDP_Frontend:A_21595] Storage Implementation
// [REQ:BSI-eRp-ePA:O.Purp_8#1,O.Arch_2#4,O.Arch_4#3,O.Source_7#2,O.Data_2#2] Implementation of data storage that is
// persisted via keychain
class KeychainStorage: SecureUserDataStore, IDPStorage, SecureEGKCertificateStorage {
</code></pre>
<h3 id='a_19187' class='heading'>A_19187</h3>
<h4 id='code-sources-vau-vauinterceptor-swift-37-code-vau-bearer-must-be-set-to-trigger-a-request' class='heading'><code>../Sources/VAU/VAUInterceptor.swift:37</code>:  VAU Bearer must be set to trigger a request</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_eRp_FdV:A_19187] VAU Bearer must be set to trigger a request
return vauAccessTokenProvider.vauBearerToken
</code></pre>
<h3 id='a_19188' class='heading'>A_19188</h3>
<h4 id='code-doc-manual-requirement-notes-md-6-code-session-data-access_token-id_token-sso_token-can-is-saved-in-the-keychain-its-deletion-is-managed-by-the-os-the-key-chain-is-sandboxed-and-can-only-be-shared-with-other-apps-by-the-same-vendor-when-explicitly-set-all-other-mentioned-data-is-deleted' class='heading'><code>../doc/manual/requirement-notes.md:6</code>:  session data (ACCESS_TOKEN, ID_TOKEN, SSO_TOKEN, CAN) is saved in the keychain. Its deletion is managed by the OS. The key chain is sandboxed and can only be shared with other apps by the same vendor when explicitly set. All other mentioned data is deleted.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:gemSpec_eRp_FdV:A_19188] session data (ACCESS_TOKEN, ID_TOKEN, SSO_TOKEN, CAN) is saved in the keychain. Its deletion is managed by the OS. The key chain is sandboxed and can only be shared with other apps by the same vendor when explicitly set. All other mentioned data is deleted.
</code></pre>
<h4 id='code-sources-erpapp-session-keychainstorage-swift-19-code-deletion-of-data-saved-here-is-managed-by-the-os' class='heading'><code>../Sources/eRpApp/Session/KeychainStorage.swift:19</code>:  Deletion of data saved here is managed by the OS.</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_eRp_FdV:A_19186]
// [REQ:gemSpec_eRp_FdV:A_19188] Deletion of data saved here is managed by the OS.
// [REQ:gemSpec_IDP_Frontend:A_21322] Storage implementation uses iOS Keychain
// [REQ:gemF_Tokenverschlüsselung:A_21322] Storage implementation uses iOS Keychain
// [REQ:gemSpec_IDP_Frontend:A_21595] Storage Implementation
// [REQ:BSI-eRp-ePA:O.Purp_8#1,O.Arch_2#4,O.Arch_4#3,O.Source_7#2,O.Data_2#2] Implementation of data storage that is
// persisted via keychain
class KeychainStorage: SecureUserDataStore, IDPStorage, SecureEGKCertificateStorage {
</code></pre>
<h3 id='a_19229' class='heading'>A_19229</h3>
<h4 id='code-doc-manual-requirement-notes-md-7-code-audit-events-will-be-deleted-when-the-referencing-task-is-deleted-cascading-relationship-quot-task-gt-audit-event-quot-is-defined-in-sources-erplocalstorage-prescriptions-erxtask-xcdatamodeld-erxtask-xcdatamodel-contents' class='heading'><code>../doc/manual/requirement-notes.md:7</code>:  Audit events will be deleted when the referencing task is deleted. Cascading relationship &ldquo;task -&gt; audit event&rdquo; is defined in Sources/eRpLocalStorage/Prescriptions/ErxTask.xcdatamodeld/ErxTask.xcdatamodel/contents</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:gemSpec_eRp_FdV:A_19229] Audit events will be deleted when the referencing task is deleted. Cascading relationship "task -&gt; audit event" is defined in Sources/eRpLocalStorage/Prescriptions/ErxTask.xcdatamodeld/ErxTask.xcdatamodel/contents
</code></pre>
<h4 id='code-sources-erpapp-screens-main-prescriptiondetail-prescriptiondetaildomain-swift-127-code' class='heading'><code>../Sources/eRpApp/Screens/Main/PrescriptionDetail/PrescriptionDetailDomain.swift:127</code>:</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// Delete
// [REQ:gemSpec_eRp_FdV:A_19229]
case .delete:
</code></pre>
<h4 id='code-sources-erpapp-screens-main-prescriptiondetail-prescriptiondetaildomain-swift-134-code' class='heading'><code>../Sources/eRpApp/Screens/Main/PrescriptionDetail/PrescriptionDetailDomain.swift:134</code>:</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_eRp_FdV:A_19229]
case .confirmedDelete:
</code></pre>
<h3 id='a_19480' class='heading'>A_19480</h3>
<h4 id='code-sources-idp-idpsession-swift-26-code-usage-of-this-token-is-limited-to-fd-idp-access' class='heading'><code>../Sources/IDP/IDPSession.swift:26</code>:  usage of this token is limited to FD/IDP Access.</h4>

<p>code</p>
<pre class="highlight plaintext"><code>/// Subscribe to the session's IDPToken and receive the latest (session) token through this Publisher
///
/// [REQ:gemSpec_eRp_FdV:A_19480] usage of this token is limited to FD/IDP Access.
var autoRefreshedToken: AnyPublisher&lt;IDPToken?, IDPError&gt; { get }
</code></pre>
<h4 id='code-sources-idp-idpstorage-swift-34-code-usage-of-this-token-is-limited-to-fd-idp-access' class='heading'><code>../Sources/IDP/IDPStorage.swift:34</code>:  usage of this token is limited to FD/IDP Access.</h4>

<p>code</p>
<pre class="highlight plaintext"><code>/// Retrieve and set an IDP Token
/// [REQ:gemSpec_eRp_FdV:A_19480] usage of this token is limited to FD/IDP Access.
var token: AnyPublisher&lt;IDPToken?, Never&gt; { get }
</code></pre>
<h3 id='a_19739' class='heading'>A_19739</h3>
<h4 id='code-doc-manual-requirement-notes-md-26-code-implemented-with-ats-within-code-info-plist-code-path-code-nsapptransportsecurity-nspinneddomains-code' class='heading'><code>../doc/manual/requirement-notes.md:26</code>:  Implemented with ATS within <code>Info.plist</code>, path: <code>NSAppTransportSecurity.NSPinnedDomains</code></h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:gemSpec_eRp_FdV:A_20033,A_19739] Implemented with ATS within `Info.plist`, path: `NSAppTransportSecurity.NSPinnedDomains`
</code></pre>
<h4 id='code-sources-truststore-truststoresession-swift-19-code' class='heading'><code>../Sources/TrustStore/TrustStoreSession.swift:19</code>:</h4>

<p>code</p>
<pre class="highlight plaintext"><code>/// Request and validate the VAU certificate
///
/// [REQ:gemSpec_eRp_FdV:A_19739]
///
/// - Returns: A publisher that emits a validated VAU certificate or an error
func loadVauCertificate() -&gt; AnyPublisher&lt;X509, TrustStoreError&gt;
</code></pre>
<h4 id='code-sources-truststore-truststoresession-swift-29-code' class='heading'><code>../Sources/TrustStore/TrustStoreSession.swift:29</code>:</h4>

<p>code</p>
<pre class="highlight plaintext"><code>/// Try to validate a given certificate against the underlying truststore.
/// An OCSP response will also be requested and checked against
///
/// [REQ:gemSpec_eRp_FdV:A_19739]
///
/// - Parameter certificate: the certificate to be validated
/// - Returns: A publisher that emits a Boolean stating whether or not the certificate could be validated.
func validate(certificate: X509) -&gt; AnyPublisher&lt;Bool, TrustStoreError&gt;
</code></pre>
<h3 id='a_19984' class='heading'>A_19984</h3>
<h4 id='code-sources-pharmacy-fhirclient-pharmacyoperation-swift-24-code-validate-pharmacy-data-format-conforming-to-fhir' class='heading'><code>../Sources/Pharmacy/FHIRClient+PharmacyOperation.swift:24</code>:  validate pharmacy data format conforming to FHIR</h4>

<p>code</p>
<pre class="highlight plaintext"><code>/// Convenience function for searching for pharmacies
///
/// [REQ:gemSpec_eRp_FdV:A_19984] validate pharmacy data format conforming to FHIR
///
/// - Parameters:
///   - searchTerm: Search term
///   - position: Pharmacy position (latitude and longitude)
/// - Returns: `AnyPublisher` that emits a list of `PharmacyLocation`s or is empty when not found
public func searchPharmacies(by searchTerm: String,
</code></pre>
<h4 id='code-sources-erpkit-scannederxtask-swift-48-code-parse-task-id-and-access-code' class='heading'><code>../Sources/eRpKit/ScannedErxTask.swift:48</code>:  parse task id and access code</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_eRp_FdV:A_19984] parse task id and access code
guard let taskId = taskString.match(pattern: Self.taskIdRegex) else {
</code></pre>
<h4 id='code-sources-erpkit-scannederxtask-swift-103-code-validate-data-matrix-code-structure' class='heading'><code>../Sources/eRpKit/ScannedErxTask.swift:103</code>:  validate data matrix code structure</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_eRp_FdV:A_19984] validate data matrix code structure
// [REQ:BSI-eRp-ePA:O.Source_1#4] actual validation by decoding into predefined structure
erxToken = try jsonDecoder.decode(ErxToken.self, from: jsonData)
</code></pre>
<h3 id='a_20032-01' class='heading'>A_20032-01</h3>
<h4 id='code-doc-manual-requirement-notes-md-4-code-note-grace-period-for-ocsp-responses-is-12h' class='heading'><code>../doc/manual/requirement-notes.md:4</code>:  Note: grace period for OCSP responses is 12h</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:gemSpec_eRp_FdV:A_20032-01] Note: grace period for OCSP responses is 12h
</code></pre>
<h4 id='code-sources-truststore-x509truststore-swift-14-code' class='heading'><code>../Sources/TrustStore/X509TrustStore.swift:14</code>:</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_Krypt:A_21218]
// [REQ:gemSpec_eRp_FdV:A_20032-01]
// Category A: Cross root certificates
private let rootCa: X509
</code></pre>
<h3 id='a_20033' class='heading'>A_20033</h3>
<h4 id='code-doc-manual-requirement-notes-md-26-code-implemented-with-ats-within-code-info-plist-code-path-code-nsapptransportsecurity-nspinneddomains-code' class='heading'><code>../doc/manual/requirement-notes.md:26</code>:  Implemented with ATS within <code>Info.plist</code>, path: <code>NSAppTransportSecurity.NSPinnedDomains</code></h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:gemSpec_eRp_FdV:A_20033,A_19739] Implemented with ATS within `Info.plist`, path: `NSAppTransportSecurity.NSPinnedDomains`
</code></pre>
<h3 id='a_20167' class='heading'>A_20167</h3>
<h4 id='code-sources-idp-idpinterceptor-swift-61-code-no-token-available-bailout' class='heading'><code>../Sources/IDP/IDPInterceptor.swift:61</code>:  no token available, bailout</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_eRp_FdV:A_20167] no token available, bailout
.authentication(error)
</code></pre>
<h4 id='code-sources-idp-idpinterceptor-swift-71-code-invalidate-delete-unauthorized-token' class='heading'><code>../Sources/IDP/IDPInterceptor.swift:71</code>:  invalidate/delete unauthorized token</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_eRp_FdV:A_20167] invalidate/delete unauthorized token
// [REQ:BSI-eRp-ePA:O.Source_5#2] invalidate/delete unauthorized token
self.session.invalidateAccessToken()
</code></pre>
<h4 id='code-sources-erpapp-data-prescriptionrepository-swift-133-code-no-token-not-authorized-show-authenticator-module' class='heading'><code>../Sources/eRpApp/Data/PrescriptionRepository.swift:133</code>:  no token/not authorized, show authenticator module</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_eRp_FdV:A_20167,A_20172] no token/not authorized, show authenticator module
if Result.success(false) == isAuthenticated {
</code></pre>
<h4 id='code-sources-erpapp-screens-pharmacy-redeemservice-redeemservice-swift-144-code-no-token-not-authorized-show-authenticator-module' class='heading'><code>../Sources/eRpApp/Screens/Pharmacy/RedeemService/RedeemService.swift:144</code>:  no token/not authorized, show authenticator module</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_eRp_FdV:A_20167,A_20172] no token/not authorized, show authenticator module
if Result.success(false) == authenticated {
</code></pre>
<h3 id='a_20172' class='heading'>A_20172</h3>
<h4 id='code-sources-erpapp-data-prescriptionrepository-swift-133-code-no-token-not-authorized-show-authenticator-module' class='heading'><code>../Sources/eRpApp/Data/PrescriptionRepository.swift:133</code>:  no token/not authorized, show authenticator module</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_eRp_FdV:A_20167,A_20172] no token/not authorized, show authenticator module
if Result.success(false) == isAuthenticated {
</code></pre>
<h4 id='code-sources-erpapp-screens-cardwall-readcard-cardwallreadcarddomain-swift-356-code' class='heading'><code>../Sources/eRpApp/Screens/CardWall/ReadCard/CardWallReadCardDomain.swift:356</code>:</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_eRp_FdV:A_20172]
func idpChallengePublisher(for profileID: UUID) -&gt; EffectTask&lt;CardWallReadCardDomain.Action&gt; {
</code></pre>
<h4 id='code-sources-erpapp-screens-cardwall-readcard-cardwallreadcarddomain-swift-377-code' class='heading'><code>../Sources/eRpApp/Screens/CardWall/ReadCard/CardWallReadCardDomain.swift:377</code>:</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_eRp_FdV:A_20172]
// [REQ:gemSpec_IDP_Frontend:A_20526-01] sign and verify with idp
func signChallengeWithNFCCard(can: String,
</code></pre>
<h4 id='code-sources-erpapp-screens-cardwall-readcard-cardwallreadcarddomain-swift-406-code' class='heading'><code>../Sources/eRpApp/Screens/CardWall/ReadCard/CardWallReadCardDomain.swift:406</code>:</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_eRp_FdV:A_20172]
// [REQ:gemSpec_IDP_Frontend:A_20526-01] verify with idp
private func verifyResultWithIDP(_ signedChallenge: SignedChallenge,
</code></pre>
<h4 id='code-sources-erpapp-screens-pharmacy-redeemservice-redeemservice-swift-144-code-no-token-not-authorized-show-authenticator-module' class='heading'><code>../Sources/eRpApp/Screens/Pharmacy/RedeemService/RedeemService.swift:144</code>:  no token/not authorized, show authenticator module</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_eRp_FdV:A_20167,A_20172] no token/not authorized, show authenticator module
if Result.success(false) == authenticated {
</code></pre>
<h3 id='a_20183' class='heading'>A_20183</h3>
<h4 id='code-sources-pharmacy-pharmacyfhirdatasource-swift-31-code' class='heading'><code>../Sources/Pharmacy/PharmacyFHIRDataSource.swift:31</code>:</h4>

<p>code</p>
<pre class="highlight plaintext"><code>/// API for requesting pharmacies with the passed search term
///
/// [REQ:gemSpec_eRp_FdV:A_20183]
///
/// - Parameter searchTerm: String that send to the server for filtering the pharmacies response
/// - Parameter position: Position (latitude and longitude) of pharmacy
/// - Parameter filter: further filter parameters for pharmacies
/// - Returns: `AnyPublisher` that emits all `PharmacyLocation`s for the given `searchTerm`
public func searchPharmacies(by searchTerm: String,
</code></pre>
<h4 id='code-sources-pharmacy-pharmacyremotedatastore-swift-22-code' class='heading'><code>../Sources/Pharmacy/PharmacyRemoteDataStore.swift:22</code>:</h4>

<p>code</p>
<pre class="highlight plaintext"><code>/// API for requesting pharmacies with the passed search term
///
/// [REQ:gemSpec_eRp_FdV:A_20183]
///
/// - Parameter searchTerm: String that send to the server for filtering the pharmacies response
/// - Parameter position: Position (latitude and longitude) of pharmacy
/// - Parameter filter: further filter parameters for pharmacies
/// - Returns: `AnyPublisher` that emits all `PharmacyLocation`s for the given `searchTerm`
func searchPharmacies(by searchTerm: String,
</code></pre>
<h4 id='code-sources-erpapp-screens-pharmacy-search-pharmacysearchdomain-swift-175-code-search-results-mirrored-verbatim-no-sorting-no-highlighting' class='heading'><code>../Sources/eRpApp/Screens/Pharmacy/Search/PharmacySearchDomain.swift:175</code>:  search results mirrored verbatim, no sorting, no highlighting</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_eRp_FdV:A_20183] search results mirrored verbatim, no sorting, no highlighting
state.searchState = .searchRunning
</code></pre>
<h3 id='a_20184' class='heading'>A_20184</h3>
<h4 id='code-sources-erpapp-session-keychainstorage-swift-124-code' class='heading'><code>../Sources/eRpApp/Session/KeychainStorage.swift:124</code>:</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_eRp_FdV:A_20184]
// [REQ:BSI-eRp-ePA:O.Tokn_1#4] KeychainStorage implementation
let success: Bool
</code></pre>
<h4 id='code-sources-erpapp-session-standardsessioncontainer-swift-89-code-keychain-storage-encrypts-session-ssl-tokens' class='heading'><code>../Sources/eRpApp/Session/StandardSessionContainer.swift:89</code>:  Keychain storage encrypts session/ssl tokens</h4>

<p>code</p>
<pre class="highlight plaintext"><code>storage: secureUserStore, // [REQ:gemSpec_eRp_FdV:A_20184] Keychain storage encrypts session/ssl tokens
schedulers: schedulers,
</code></pre>
<h4 id='code-sources-erpapp-session-standardsessioncontainer-swift-107-code-no-persistent-storage-for-idp-biometrics-session' class='heading'><code>../Sources/eRpApp/Session/StandardSessionContainer.swift:107</code>:  No persistent storage for idp biometrics session</h4>

<p>code</p>
<pre class="highlight plaintext"><code>storage: MemoryStorage(), // [REQ:gemSpec_eRp_FdV:A_20184] No persistent storage for idp biometrics session
schedulers: schedulers,
</code></pre>
<h3 id='a_20185' class='heading'>A_20185</h3>
<h4 id='code-sources-erpapp-screens-settings-settingsdomain-swift-200-code-optout-for-user' class='heading'><code>../Sources/eRpApp/Screens/Settings/SettingsDomain.swift:200</code>:  OptOut for user</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_eRp_FdV:A_20185,A_20187] OptOut for user
state.trackerOptIn = false
</code></pre>
<h3 id='a_20186' class='heading'>A_20186</h3>
<h4 id='code-sources-erpapp-session-keychainstorage-swift-248-code-deletion-of-sso_token-id_token-auth_token' class='heading'><code>../Sources/eRpApp/Session/KeychainStorage.swift:248</code>:  Deletion of SSO_TOKEN, ID_TOKEN, AUTH_TOKEN</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_20499,A_20499-1#3] Deletion of SSO_TOKEN, ID_TOKEN, AUTH_TOKEN
// [REQ:gemSpec_eRp_FdV:A_20186] Deletion of SSO_TOKEN, ID_TOKEN, AUTH_TOKEN
set(can: nil)
</code></pre>
<h4 id='code-sources-erpapp-session-profilesecuredatawiper-swift-39-code-deletion-of-sso_token-id_token-auth_token' class='heading'><code>../Sources/eRpApp/Session/ProfileSecureDataWiper.swift:39</code>:  Deletion of SSO_TOKEN, ID_TOKEN, AUTH_TOKEN</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_IDP_Frontend:A_20499,A_20499-01#2] Deletion of SSO_TOKEN, ID_TOKEN, AUTH_TOKEN
// [REQ:gemSpec_eRp_FdV:A_20186] Deletion of SSO_TOKEN, ID_TOKEN, AUTH_TOKEN
// [REQ:gemSpec_IDP_Frontend:A_21603] Certificate
storage.wipe()
</code></pre>
<h3 id='a_20187' class='heading'>A_20187</h3>
<h4 id='code-sources-erpapp-screens-settings-settingsdomain-swift-200-code-optout-for-user' class='heading'><code>../Sources/eRpApp/Screens/Settings/SettingsDomain.swift:200</code>:  OptOut for user</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_eRp_FdV:A_20185,A_20187] OptOut for user
state.trackerOptIn = false
</code></pre>
<h3 id='a_20193' class='heading'>A_20193</h3>
<h4 id='code-doc-manual-requirement-notes-md-29-code-camera-is-only-used-for-scanning-recipes-and-avatar-setup-corelocation-is-used-for-pharmacy-search-usage-is-requested-before-actual-first-usage-the-user-is-asked-for-permission-this-is-also-enforced-by-the-os' class='heading'><code>../doc/manual/requirement-notes.md:29</code>:  Camera is only used for scanning recipes and avatar setup. CoreLocation is used for pharmacy search. Usage is requested before actual first usage, the user is asked for permission. This is also enforced by the OS.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:gemSpec_eRp_FdV:A_20193,A_20194] Camera is only used for scanning recipes and avatar setup. CoreLocation is used for pharmacy search. Usage is requested before actual first usage, the user is asked for permission. This is also enforced by the OS.
</code></pre>
<h3 id='a_20194' class='heading'>A_20194</h3>
<h4 id='code-doc-manual-requirement-notes-md-29-code-camera-is-only-used-for-scanning-recipes-and-avatar-setup-corelocation-is-used-for-pharmacy-search-usage-is-requested-before-actual-first-usage-the-user-is-asked-for-permission-this-is-also-enforced-by-the-os' class='heading'><code>../doc/manual/requirement-notes.md:29</code>:  Camera is only used for scanning recipes and avatar setup. CoreLocation is used for pharmacy search. Usage is requested before actual first usage, the user is asked for permission. This is also enforced by the OS.</h4>

<p>intro</p>
<pre class="highlight plaintext"><code>[REQ:gemSpec_eRp_FdV:A_20193,A_20194] Camera is only used for scanning recipes and avatar setup. CoreLocation is used for pharmacy search. Usage is requested before actual first usage, the user is asked for permission. This is also enforced by the OS.
</code></pre>
<h3 id='a_20206' class='heading'>A_20206</h3>
<h4 id='code-sources-httpclient-defaulthttpclient-swift-41-code' class='heading'><code>../Sources/HTTPClient/DefaultHTTPClient.swift:41</code>:</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_Krypt:GS-A_4385,A_18467,A_18464,GS-A_4387]
// [REQ:gemSpec_Krypt:GS-A_5322] TODO: Check if limiting SSL Sessions is possible, check for renegotiation
// swiftlint:disable:previous todo
// [REQ:gemSpec_IDP_Frontend:A_20606] Live URLs not present in NSAppTransportSecurity exception list for allowed
// HTTP communication
// [REQ:gemSpec_eRp_FdV:A_20206]
// [REQ:BSI-eRp-ePA:O.Sess_1#2,O.Ntwk_2#2,O.Ntwk_3#2] URLSession is used as Network Framework

</code></pre>
<h3 id='a_20208' class='heading'>A_20208</h3>
<h4 id='code-sources-pharmacy-pharmacyfhiroperation-swift-14-code' class='heading'><code>../Sources/Pharmacy/PharmacyFHIROperation.swift:14</code>:</h4>

<p>code</p>
<pre class="highlight plaintext"><code>/// Search for pharmacies by name
/// [REQ:gemSpec_eRp_FdV:A_20208]
case searchPharmacies(searchTerm: String, position: Position?, filter: [String: String], handler: Handler)
</code></pre>
<h3 id='a_20285' class='heading'>A_20285</h3>
<h4 id='code-sources-erpapp-screens-pharmacy-search-pharmacysearchdomain-swift-186-code-pharmacy-order-is-resolved-on-server-side' class='heading'><code>../Sources/eRpApp/Screens/Pharmacy/Search/PharmacySearchDomain.swift:186</code>:  pharmacy order is resolved on server side</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_eRp_FdV:A_20285] pharmacy order is resolved on server side
state.pharmacies = pharmacies.map {
</code></pre>
<h3 id='a_20603' class='heading'>A_20603</h3>
<h4 id='code-sources-erpapp-screens-main-prescriptiondetail-prescriptiondetaildomain-swift-81-code-usages-of-matrixcodegenerator-for-code-generation-userprofile-is-neither-part-of' class='heading'><code>../Sources/eRpApp/Screens/Main/PrescriptionDetail/PrescriptionDetailDomain.swift:81</code>:  Usages of matrixCodeGenerator for code generation. UserProfile is neither part of</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_eRp_FdV:A_20603] Usages of matrixCodeGenerator for code generation. UserProfile is neither part of
// the screen nor the state.
@Dependency(\.erxTaskMatrixCodeGenerator) var matrixCodeGenerator: ErxTaskMatrixCodeGenerator
</code></pre>
<h4 id='code-sources-erpapp-screens-main-redeem-redeemmatrixcode-redeemmatrixcodedomain-swift-56-code-usages-of-matrixcodegenerator-for-code-generation-userprofile-is-neither-part-of' class='heading'><code>../Sources/eRpApp/Screens/Main/Redeem/RedeemMatrixCode/RedeemMatrixCodeDomain.swift:56</code>:  Usages of matrixCodeGenerator for code generation. UserProfile is neither part of</h4>

<p>code</p>
<pre class="highlight plaintext"><code>// [REQ:gemSpec_eRp_FdV:A_20603] Usages of matrixCodeGenerator for code generation. UserProfile is neither part of
// the screen nor the state.
@Dependency(\.erxTaskMatrixCodeGenerator) var matrixCodeGenerator: ErxTaskMatrixCodeGenerator
</code></pre>
<h2 id='gemspec_erp_fdv' class='heading'>gemSpec_eRp_Fdv</h2>
<h3 id='a_20032-01' class='heading'>A_20032-01</h3>
<h4 id='code-sources-truststore-x509truststore-swift-106-code' class='heading'><code>../Sources/TrustStore/X509TrustStore.swift:106</code>:</h4>

<p>code</p>
<pre class="highlight plaintext"><code>/// Match a collection of `OCSPResponse`s with the end entity certificates of this `X509TrustStore`.
/// Checks response status, revocation status for each certificate and validates the signer certificates of
///   the responses itself.
///
/// [REQ:gemSpec_Krypt:A_21218]
/// [REQ:gemSpec_eRp_Fdv:A_20032-01]
///
/// - Note: This function assumes that up-to-dateness of the responses itself has already been checked.
///
/// - Returns: true on successful matching/validation, false if not successful or error
func checkEeCertificatesStatus(with ocspResponses: [OCSPResponse]) throws -&gt; Bool {
</code></pre>

          </div>
        </section>


      </article>
    </div>
    <section class="footer">
      <p>&copy; 2023 <a class="link" href="https://www.gematik.de" target="_blank" rel="external noopener">gematik GmbH</a>. All rights reserved. (Last updated: 2023-08-22)</p>
      <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external noopener">jazzy ♪♫ v0.14.3</a>, a <a class="link" href="https://realm.io" target="_blank" rel="external noopener">Realm</a> project.</p>
    </section>
  </body>
</html>
